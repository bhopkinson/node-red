[
    {
       "id":"98e70926.543948",
       "type":"tab",
       "label":"Home Assistant",
       "disabled":false,
       "info":""
    },
    {
       "id":"257e9eaf.a9d202",
       "type":"tab",
       "label":"Brad",
       "disabled":false,
       "info":""
    },
    {
       "id":"6076e8bd.b0fe58",
       "type":"tab",
       "label":"Tado",
       "disabled":false,
       "info":""
    },
    {
       "id":"3e06a286.f1fcfe",
       "type":"tab",
       "label":"Sandbox",
       "disabled":false,
       "info":""
    },
    {
       "id":"98bf1f56.6da51",
       "type":"tab",
       "label":"Lights",
       "disabled":false,
       "info":""
    },
    {
       "id":"9943920f.042cc",
       "type":"tab",
       "label":"Emails",
       "disabled":false,
       "info":""
    },
    {
       "id":"7bb31cb3.9db904",
       "type":"tab",
       "label":"PickMyPostcode",
       "disabled":false,
       "info":""
    },
    {
       "id":"a127b200.23554",
       "type":"tab",
       "label":"State Machines",
       "disabled":false,
       "info":""
    },
    {
       "id":"2c5b3241.37838e",
       "type":"tab",
       "label":"Flow 1",
       "disabled":false,
       "info":""
    },
    {
       "id":"8f5573e3.e52df",
       "type":"subflow",
       "name":"AutoRemote",
       "info":"",
       "category":"",
       "in":[
          {
             "x":48,
             "y":61,
             "wires":[
                {
                   "id":"85c3663c.2deeb8"
                }
             ]
          }
       ],
       "out":[
          {
             "x":1649,
             "y":59,
             "wires":[
                {
                   "id":"36f8aac7.5a44f6",
                   "port":0
                },
                {
                   "id":"86433a5c.eb5228",
                   "port":0
                }
             ]
          }
       ]
    },
    {
       "id":"12d32bdb.3c9804",
       "type":"subflow",
       "name":"Set Tasker Variable",
       "info":"",
       "category":"",
       "in":[
          {
             "x":71,
             "y":68,
             "wires":[
                {
                   "id":"cc4dda7c.021558"
                }
             ]
          }
       ],
       "out":[
          {
             "x":570,
             "y":68,
             "wires":[
                {
                   "id":"565c25d.7e677dc",
                   "port":0
                }
             ]
          }
       ],
       "env":[
 
       ]
    },
    {
       "id":"c26c68e9.a7fd88",
       "type":"subflow",
       "name":"Enable Status",
       "info":"",
       "category":"",
       "in":[
          {
             "x":44,
             "y":256,
             "wires":[
                {
                   "id":"cbbb64af.32dd18"
                }
             ]
          }
       ],
       "out":[
          {
             "x":1734,
             "y":234,
             "wires":[
                {
                   "id":"c5447f3c.01585",
                   "port":0
                },
                {
                   "id":"76084fd2.b061",
                   "port":1
                },
                {
                   "id":"35d84bb9.f1c014",
                   "port":0
                },
                {
                   "id":"4ccf8e7b.8482c",
                   "port":0
                }
             ]
          }
       ],
       "env":[
 
       ]
    },
    {
       "id":"94dca4da.a92a08",
       "type":"subflow",
       "name":"Start MQTT Timer",
       "info":"",
       "category":"",
       "in":[
          {
             "x":68,
             "y":53,
             "wires":[
                {
                   "id":"620a2cff.9f70e4"
                }
             ]
          }
       ],
       "out":[
 
       ],
       "env":[
 
       ]
    },
    {
       "id":"2837753f.46f60a",
       "type":"subflow",
       "name":"Canopy lights",
       "info":"",
       "category":"",
       "in":[
          {
             "x":80,
             "y":216,
             "wires":[
                {
                   "id":"10d93d0e.21a2b3"
                }
             ]
          }
       ],
       "out":[
          {
             "x":1367,
             "y":217,
             "wires":[
                {
                   "id":"2f41a89a.ac8d08",
                   "port":0
                }
             ]
          }
       ],
       "env":[
 
       ]
    },
    {
       "id":"5806b60f.c2e778",
       "type":"server",
       "z":"",
       "name":"Home Assistant",
       "legacy":false,
       "rejectUnauthorizedCerts":true,
       "ha_boolean":"y|yes|true|on|home|open"
    },
    {
       "id":"ab404be4.584f18",
       "type":"mqtt-broker",
       "z":"",
       "name":"mosquitto",
       "broker":"192.168.0.10",
       "port":"1883",
       "clientid":"node-red",
       "usetls":false,
       "compatmode":true,
       "keepalive":"60",
       "cleansession":true,
       "birthTopic":"",
       "birthQos":"0",
       "birthPayload":"",
       "closeTopic":"",
       "closeQos":"0",
       "closePayload":"",
       "willTopic":"",
       "willQos":"0",
       "willPayload":""
    },
    {
       "id":"94e0b6b5.722ed8",
       "type":"key-value-store",
       "z":"",
       "filepath":"store.json",
       "namespace":"",
       "name":"key-value store"
    },
    {
       "id":"753061fa.2f051",
       "type":"mqtt-broker",
       "z":"",
       "broker":"localhost",
       "port":"1883",
       "clientid":"NodeRedUI",
       "usetls":false,
       "compatmode":true,
       "keepalive":"15",
       "cleansession":true,
       "birthTopic":"",
       "birthQos":"0",
       "birthPayload":"",
       "willTopic":"",
       "willQos":"0",
       "willPayload":""
    },
    {
       "id":"3ea4e394.b186ec",
       "type":"mqtt-broker",
       "z":"",
       "name":"hass",
       "broker":"10.10.0.152",
       "port":"1883",
       "clientid":"nr-docker",
       "usetls":false,
       "compatmode":false,
       "keepalive":"60",
       "cleansession":true,
       "birthTopic":"",
       "birthQos":"0",
       "birthPayload":"",
       "closeTopic":"",
       "closeQos":"0",
       "closePayload":"",
       "willTopic":"",
       "willQos":"0",
       "willPayload":""
    },
    {
       "id":"b7b614a.22dc4e8",
       "type":"server-state-changed",
       "z":"98e70926.543948",
       "name":"Travis CI passed",
       "server":"5806b60f.c2e778",
       "version":0,
       "entityidfilter":"sensor.bhopkinson_home_assistant_config_state",
       "entityidfiltertype":"exact",
       "outputinitially":false,
       "state_type":"str",
       "haltifstate":"",
       "halt_if_type":"str",
       "halt_if_compare":"is",
       "outputs":1,
       "output_only_on_state_change":false,
       "x":132.50008392333984,
       "y":79.7500810623169,
       "wires":[
          [
             "91f6432.8213ac"
          ]
       ]
    },
    {
       "id":"85c3663c.2deeb8",
       "type":"switch",
       "z":"8f5573e3.e52df",
       "name":"device switch",
       "property":"payload.autoremote.devices",
       "propertyType":"msg",
       "rules":[
          {
             "t":"cont",
             "v":"all",
             "vt":"str"
          },
          {
             "t":"cont",
             "v":"brad",
             "vt":"str"
          },
          {
             "t":"cont",
             "v":"heather",
             "vt":"str"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":3,
       "x":177.5,
       "y":61,
       "wires":[
          [
             "ab669dc4.44ee8",
             "f29cbe54.442f4"
          ],
          [
             "ab669dc4.44ee8"
          ],
          [
             "f29cbe54.442f4"
          ]
       ]
    },
    {
       "id":"36f8aac7.5a44f6",
       "type":"http request",
       "z":"8f5573e3.e52df",
       "name":"Send notification",
       "method":"GET",
       "ret":"txt",
       "url":"https://autoremotejoaomgcd.appspot.com/sendnotification?{{{payload}}}",
       "tls":"",
       "x":1447.5,
       "y":40,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"93abf424.a7e898",
       "type":"inject",
       "z":"98e70926.543948",
       "name":"",
       "topic":"",
       "payload":"created",
       "payloadType":"str",
       "repeat":"",
       "crontab":"",
       "once":false,
       "onceDelay":0.1,
       "x":168.50008392333984,
       "y":139.7500810623169,
       "wires":[
          [
             "91f6432.8213ac"
          ]
       ]
    },
    {
       "id":"ab669dc4.44ee8",
       "type":"delay",
       "z":"8f5573e3.e52df",
       "name":"",
       "pauseType":"timed",
       "timeout":"5",
       "timeoutUnits":"seconds",
       "rate":"1",
       "nbRateUnits":"1",
       "rateUnits":"second",
       "randomFirst":"1",
       "randomLast":"5",
       "randomUnits":"seconds",
       "drop":true,
       "x":401,
       "y":42,
       "wires":[
          [
             "a00146e.1235fb8"
          ]
       ]
    },
    {
       "id":"a00146e.1235fb8",
       "type":"credentials",
       "z":"8f5573e3.e52df",
       "name":"Set AutoRemote Credentials for Brad",
       "props":[
          {
             "value":"payload.autoremote.key",
             "type":"msg"
          },
          {
             "value":"payload.autoremote.password",
             "type":"msg"
          }
       ],
       "x":687,
       "y":41,
       "wires":[
          [
             "9c121cf5.aa789",
             "113a7204.3de1ae"
          ]
       ]
    },
    {
       "id":"e0247ece.0def8",
       "type":"credentials",
       "z":"8f5573e3.e52df",
       "name":"Set AutoRemote Credentials for Heather",
       "props":[
          {
             "value":"payload.autoremote.key",
             "type":"msg"
          },
          {
             "value":"payload.autoremote.password",
             "type":"msg"
          }
       ],
       "x":679,
       "y":78,
       "wires":[
          [
             "9c121cf5.aa789",
             "113a7204.3de1ae"
          ]
       ]
    },
    {
       "id":"f29cbe54.442f4",
       "type":"delay",
       "z":"8f5573e3.e52df",
       "name":"",
       "pauseType":"timed",
       "timeout":"5",
       "timeoutUnits":"seconds",
       "rate":"1",
       "nbRateUnits":"1",
       "rateUnits":"second",
       "randomFirst":"1",
       "randomLast":"5",
       "randomUnits":"seconds",
       "drop":true,
       "x":401,
       "y":78,
       "wires":[
          [
             "e0247ece.0def8"
          ]
       ]
    },
    {
       "id":"91f6432.8213ac",
       "type":"switch",
       "z":"98e70926.543948",
       "name":"",
       "property":"payload",
       "propertyType":"msg",
       "rules":[
          {
             "t":"cont",
             "v":"created",
             "vt":"str"
          },
          {
             "t":"cont",
             "v":"started",
             "vt":"str"
          },
          {
             "t":"cont",
             "v":"passed",
             "vt":"str"
          }
       ],
       "checkall":"false",
       "repair":false,
       "outputs":3,
       "x":317.50008392333984,
       "y":79.7500810623169,
       "wires":[
          [
             "4932781a.217888"
          ],
          [
             "30b66512.22915a"
          ],
          [
             "1dab0a2.0c4cff6"
          ]
       ],
       "outputLabels":[
          "created",
          "started",
          "passed"
       ]
    },
    {
       "id":"6d8cfe.b1d35304",
       "type":"change",
       "z":"8f5573e3.e52df",
       "name":"Set Query String Parameters",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"\"key=\" & payload.autoremote.key &\t\"&password=\" & payload.autoremote.password &\t\"&\" &\t$join(\t   $each(\t       payload.autoremote.notification,\t       function($v, $k){\t            $k & \"=\" & ($v != null ? $v : \"\")\t       }\t   ),\t   \"&\"\t)",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":1193.5,
       "y":40,
       "wires":[
          [
             "36f8aac7.5a44f6"
          ]
       ]
    },
    {
       "id":"66b46068.4f9ed",
       "type":"change",
       "z":"98e70926.543948",
       "name":"Set travis created message",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"(\t   $notificationId := $flowContext(\"notificationId\");\t   {\t       \"autoremote\":{\t           \"notification\":{\t               \"id\": $notificationId,\t               \"title\":\"Home Assistant\",\t               \"text\":\"Travis CI Created\",\t               \"icon\":\"https://www.home-assistant.io/images/components/alexa/alexa-108x108.png\",\t               \"action1name\":\"Cancel restart\",\t               \"action1\":\"cancelrestart id=:=\" & $notificationId\t           },\t           \"devices\":[\"brad\"]\t \t       }\t\t   }\t\t)",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":688.0000839233398,
       "y":32.750081062316895,
       "wires":[
          [
             "46bcb02f.25bf6"
          ]
       ]
    },
    {
       "id":"4932781a.217888",
       "type":"uuid",
       "z":"98e70926.543948",
       "uuidVersion":"v4",
       "namespaceType":"",
       "namespace":"",
       "namespaceCustom":"",
       "name":"",
       "field":"notificationId",
       "fieldType":"flow",
       "x":470.00008392333984,
       "y":32.750081062316895,
       "wires":[
          [
             "66b46068.4f9ed"
          ]
       ]
    },
    {
       "id":"46bcb02f.25bf6",
       "type":"subflow:8f5573e3.e52df",
       "z":"98e70926.543948",
       "name":"",
       "x":927.0000839233398,
       "y":32.750081062316895,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"30b66512.22915a",
       "type":"change",
       "z":"98e70926.543948",
       "name":"Set travis started message",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"(\t   $notifcationId := $flowContext(\"notificationId\");\t   $canellationToken := $flowContext(\"cancellationToken\");\t   $cancelled := $notifcationId = $canellationToken;\t   {\t       \"autoremote\":{\t           \"notification\":{\t               \"id\": $notifcationId,\t               \"title\": \"Home Assistant\",\t               \"text\": \"Travis CI Started\",\t               \"icon\": \"https://www.home-assistant.io/images/components/alexa/alexa-108x108.png\",\t               \"indeterminateprogress\": true,\t               \"action1name\": $cancelled ? \"Cancel restart\" : null,\t               \"action1\": $cancelled ? \"cancelrestart id=\" & $notifcationId : null\t   \t   \t       \t           },\t           \"devices\":[\"brad\"]\t\t   \t       }\t\t\t   }\t\t)",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":540.0000839233398,
       "y":78.7500810623169,
       "wires":[
          [
             "d5019e5c.b32eb"
          ]
       ]
    },
    {
       "id":"d5019e5c.b32eb",
       "type":"subflow:8f5573e3.e52df",
       "z":"98e70926.543948",
       "name":"",
       "x":777.0000839233398,
       "y":78.7500810623169,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"1dab0a2.0c4cff6",
       "type":"change",
       "z":"98e70926.543948",
       "name":"Set travis passed message",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"(\t$notificationId := $flowContext(\"notificationId\");\t$canellationToken := $flowContext(\"cancellationToken\");\t$cancelled := $notifcationId = $canellationToken;\t{\t   \"autoremote\":{\t       \"notification\":{\t           \"id\": $notificationId,\t           \"title\": \"Home Assistant\",\t           \"text\": \"Travis CI Passed\",\t           \"icon\": \"https://www.home-assistant.io/images/components/alexa/alexa-108x108.png\",\t           \"indeterminateprogress\": $cancelled ? true : null\t  \t       },\t       \"devices\":[\"brad\"]\t\t   }\t\t}\t)",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":541.0000839233398,
       "y":132.7500810623169,
       "wires":[
          [
             "1aae6511.0daf9b"
          ]
       ]
    },
    {
       "id":"1aae6511.0daf9b",
       "type":"subflow:8f5573e3.e52df",
       "z":"98e70926.543948",
       "name":"",
       "x":778.0000839233398,
       "y":132.7500810623169,
       "wires":[
          [
             "da50b0fd.ca3fd"
          ]
       ]
    },
    {
       "id":"da50b0fd.ca3fd",
       "type":"http request",
       "z":"98e70926.543948",
       "name":"Pull Config",
       "method":"GET",
       "ret":"txt",
       "paytoqs":false,
       "url":"http://192.168.0.10:9002/hooks/git-pull?folder=hass-config",
       "tls":"",
       "proxy":"",
       "x":954.0000839233398,
       "y":132.7500810623169,
       "wires":[
          [
             "cc85c102.81e67"
          ]
       ]
    },
    {
       "id":"cc85c102.81e67",
       "type":"switch",
       "z":"98e70926.543948",
       "name":"OK?",
       "property":"statusCode",
       "propertyType":"msg",
       "rules":[
          {
             "t":"eq",
             "v":"200",
             "vt":"str"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":1,
       "x":1112.0000839233398,
       "y":132.7500810623169,
       "wires":[
          [
             "f5e45848.39b8d8"
          ]
       ]
    },
    {
       "id":"f5e45848.39b8d8",
       "type":"switch",
       "z":"98e70926.543948",
       "name":"cancelled?",
       "property":"cancellationToken",
       "propertyType":"flow",
       "rules":[
          {
             "t":"eq",
             "v":"notificationId",
             "vt":"flow"
          },
          {
             "t":"else"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":2,
       "x":1275.5000839233398,
       "y":132.7500810623169,
       "wires":[
          [
             "8e39ad25.a4c72"
          ],
          [
             "82a169f9.1288b8"
          ]
       ]
    },
    {
       "id":"8e39ad25.a4c72",
       "type":"change",
       "z":"98e70926.543948",
       "name":"Set manual restart message",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"{\t   \"autoremote\":{\t       \"notification\":{\t           \"id\": $flowContext(\"notificationId\"),\t           \"title\": \"Home Assistant\",\t           \"text\": \"Config updated. Please restart manually.\",\t           \"icon\": \"https://www.home-assistant.io/images/components/alexa/alexa-108x108.png\"\t          },\t       \"devices\":[\"brad\"]\t\t   }\t\t}",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":1514.0000839233398,
       "y":101.7500810623169,
       "wires":[
          [
             "57c6a06e.97e97"
          ]
       ]
    },
    {
       "id":"57c6a06e.97e97",
       "type":"subflow:8f5573e3.e52df",
       "z":"98e70926.543948",
       "name":"",
       "x":1750.0000839233398,
       "y":101.7500810623169,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"82a169f9.1288b8",
       "type":"change",
       "z":"98e70926.543948",
       "name":"Set config updated message",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"{\t   \"autoremote\":{\t       \"notification\":{\t           \"id\": $flowContext(\"notificationId\"),\t           \"title\": \"Home Assistant\",\t           \"text\": \"Config updated\",\t           \"icon\": \"https://www.home-assistant.io/images/components/alexa/alexa-108x108.png\"\t       },\t       \"devices\":[\"brad\"]\t\t   }\t\t}",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":1516.0000839233398,
       "y":154.7500810623169,
       "wires":[
          [
             "c7d3946d.c52c68"
          ]
       ]
    },
    {
       "id":"c7d3946d.c52c68",
       "type":"subflow:8f5573e3.e52df",
       "z":"98e70926.543948",
       "name":"",
       "x":1750.0000839233398,
       "y":154.7500810623169,
       "wires":[
          [
             "1e050fea.b2ba2"
          ]
       ]
    },
    {
       "id":"7dbe6af.1c7ec94",
       "type":"api-call-service",
       "z":"98e70926.543948",
       "name":"Restart",
       "server":"5806b60f.c2e778",
       "service_domain":"homeassistant",
       "service":"restart",
       "data":"",
       "mergecontext":"",
       "output_location":"payload",
       "output_location_type":"msg",
       "x":2127.00008392334,
       "y":154.7500810623169,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"57be8d4b.de3454",
       "type":"inject",
       "z":"98e70926.543948",
       "name":"",
       "topic":"",
       "payload":"started",
       "payloadType":"str",
       "repeat":"",
       "crontab":"",
       "once":false,
       "onceDelay":0.1,
       "x":168.00008392333984,
       "y":174.7500810623169,
       "wires":[
          [
             "91f6432.8213ac"
          ]
       ]
    },
    {
       "id":"43058c12.66eeb4",
       "type":"inject",
       "z":"98e70926.543948",
       "name":"",
       "topic":"",
       "payload":"passed",
       "payloadType":"str",
       "repeat":"",
       "crontab":"",
       "once":false,
       "onceDelay":0.1,
       "x":168.00008392333984,
       "y":210.7500810623169,
       "wires":[
          [
             "91f6432.8213ac"
          ]
       ]
    },
    {
       "id":"1e050fea.b2ba2",
       "type":"change",
       "z":"98e70926.543948",
       "name":"Set restarted flag",
       "rules":[
          {
             "t":"set",
             "p":"restarted",
             "pt":"flow",
             "to":"true",
             "tot":"bool"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":1945.5000839233398,
       "y":154.7500810623169,
       "wires":[
          [
             "7dbe6af.1c7ec94"
          ]
       ]
    },
    {
       "id":"a1daca7e.1b4ad8",
       "type":"mqtt in",
       "z":"98e70926.543948",
       "name":"Cancel restart token",
       "topic":"orchardhouse/homeassistant/restart/cancel",
       "qos":"1",
       "broker":"ab404be4.584f18",
       "x":361.50008392333984,
       "y":187.7500810623169,
       "wires":[
          [
             "acfd340a.28bda8"
          ]
       ]
    },
    {
       "id":"97dfd900.4cc2b8",
       "type":"change",
       "z":"98e70926.543948",
       "name":"",
       "rules":[
          {
             "t":"set",
             "p":"cancellationToken",
             "pt":"flow",
             "to":"payload.token",
             "tot":"msg"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":728.5000839233398,
       "y":187.7500810623169,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"acfd340a.28bda8",
       "type":"json",
       "z":"98e70926.543948",
       "name":"",
       "property":"payload",
       "action":"obj",
       "pretty":false,
       "x":528.5000839233398,
       "y":187.7500810623169,
       "wires":[
          [
             "97dfd900.4cc2b8"
          ]
       ]
    },
    {
       "id":"113a7204.3de1ae",
       "type":"switch",
       "z":"8f5573e3.e52df",
       "name":"Notifcation?",
       "property":"payload.autoremote.notification",
       "propertyType":"msg",
       "rules":[
          {
             "t":"nnull"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":1,
       "x":980.5,
       "y":40,
       "wires":[
          [
             "6d8cfe.b1d35304"
          ]
       ]
    },
    {
       "id":"9c121cf5.aa789",
       "type":"switch",
       "z":"8f5573e3.e52df",
       "name":"Message?",
       "property":"payload.autoremote.message",
       "propertyType":"msg",
       "rules":[
          {
             "t":"nnull"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":1,
       "x":980,
       "y":78,
       "wires":[
          [
             "a0f3224c.67cb6"
          ]
       ]
    },
    {
       "id":"a0f3224c.67cb6",
       "type":"change",
       "z":"8f5573e3.e52df",
       "name":"Set Query String Parameters",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"\"key=\" & payload.autoremote.key &\t\"&password=\" & payload.autoremote.password &\t\"&\" &\t$join(\t   $each(\t       payload.autoremote.message,\t       function($v, $k){\t            $k & \"=\" & ($v != null ? $v : \"\")\t       }\t   ),\t   \"&\"\t)",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":1195,
       "y":79,
       "wires":[
          [
             "86433a5c.eb5228"
          ]
       ]
    },
    {
       "id":"86433a5c.eb5228",
       "type":"http request",
       "z":"8f5573e3.e52df",
       "name":"Send message",
       "method":"GET",
       "ret":"txt",
       "url":"https://autoremotejoaomgcd.appspot.com/sendmessage?{{{payload}}}",
       "tls":"",
       "x":1439,
       "y":79,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"a3cdedc2.de645",
       "type":"server-state-changed",
       "z":"257e9eaf.a9d202",
       "name":"In office sensor",
       "server":"5806b60f.c2e778",
       "version":0,
       "entityidfilter":"binary_sensor.brad_in_office",
       "entityidfiltertype":"substring",
       "outputinitially":false,
       "state_type":"str",
       "haltifstate":"",
       "halt_if_type":"str",
       "halt_if_compare":"is",
       "outputs":1,
       "x":106.5,
       "y":211,
       "wires":[
          [
             "5d7c6637.090738",
             "1cdfff07.0728b1"
          ]
       ]
    },
    {
       "id":"12efefef.33632",
       "type":"comment",
       "z":"98e70926.543948",
       "name":"Home assistant config build & restart",
       "info":"",
       "x":163.50008392333984,
       "y":26.750081062316895,
       "wires":[
 
       ]
    },
    {
       "id":"4d92cd5d.b20464",
       "type":"http in",
       "z":"257e9eaf.a9d202",
       "name":"",
       "url":"/api/enable/status",
       "method":"get",
       "upload":false,
       "swaggerDoc":"",
       "x":649.5,
       "y":472,
       "wires":[
          [
             "496ad26e.7314cc"
          ]
       ]
    },
    {
       "id":"128530b6.a7587f",
       "type":"http response",
       "z":"257e9eaf.a9d202",
       "name":"response",
       "statusCode":"",
       "headers":{
 
       },
       "x":1453.4998092651367,
       "y":517.9999914169312,
       "wires":[
 
       ]
    },
    {
       "id":"6da8f4a1.cee32c",
       "type":"http request",
       "z":"c26c68e9.a7fd88",
       "name":"",
       "method":"use",
       "ret":"obj",
       "paytoqs":false,
       "url":"http://orchardhouse-functions/api/enable/status?username={{{enable.username}}}&passwordBase={{{enable.passwordBase}}}&currentInteger={{{currentInteger}}}&totpSecret={{{enable.totpSecret}}}",
       "tls":"",
       "proxy":"",
       "authType":"",
       "x":446,
       "y":225,
       "wires":[
          [
             "76084fd2.b061",
             "d458071.bfec2f8"
          ]
       ]
    },
    {
       "id":"e47d55aa.5af588",
       "type":"credentials",
       "z":"c26c68e9.a7fd88",
       "name":"Enable Credentials",
       "props":[
          {
             "value":"enable.username",
             "type":"msg"
          },
          {
             "value":"enable.passwordBase",
             "type":"msg"
          },
          {
             "value":"enable.totpSecret",
             "type":"msg"
          }
       ],
       "x":259,
       "y":253,
       "wires":[
          [
             "6da8f4a1.cee32c",
             "c7d84542.3cb668"
          ]
       ]
    },
    {
       "id":"ddbf2335.1ecbc",
       "type":"api-current-state",
       "z":"257e9eaf.a9d202",
       "name":"Current Password Integer",
       "server":"5806b60f.c2e778",
       "version":0,
       "outputs":1,
       "halt_if":"",
       "halt_if_type":"str",
       "halt_if_compare":"is",
       "override_topic":true,
       "entity_id":"input_number.enable_current_password_integer",
       "state_type":"num",
       "state_location":"currentInteger",
       "override_payload":"msg",
       "entity_location":"data",
       "override_data":"msg",
       "x":1014.5,
       "y":490,
       "wires":[
          [
             "a8a26d9b.4a055"
          ]
       ]
    },
    {
       "id":"c5447f3c.01585",
       "type":"change",
       "z":"c26c68e9.a7fd88",
       "name":"set status response",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"actualstatus",
             "tot":"msg"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":1559,
       "y":174,
       "wires":[
          [
             "9238ad73.06261"
          ]
       ]
    },
    {
       "id":"1d233293.0bf51d",
       "type":"switch",
       "z":"c26c68e9.a7fd88",
       "name":"New integer?",
       "property":"payload.currentInteger",
       "propertyType":"msg",
       "rules":[
          {
             "t":"neq",
             "v":"data.state",
             "vt":"msg"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":1,
       "x":826,
       "y":196,
       "wires":[
          [
             "85d490f.155c07"
          ]
       ]
    },
    {
       "id":"735f46c0.686328",
       "type":"api-call-service",
       "z":"c26c68e9.a7fd88",
       "name":"Set Current Password Integer",
       "server":"5806b60f.c2e778",
       "service_domain":"input_number",
       "service":"set_value",
       "data":"{\"entity_id\":\"input_number.enable_current_password_integer\"}",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "x":1294,
       "y":196,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"85d490f.155c07",
       "type":"change",
       "z":"c26c68e9.a7fd88",
       "name":"New current integer value",
       "rules":[
          {
             "t":"set",
             "p":"payload.data.value",
             "pt":"msg",
             "to":"payload.currentInteger",
             "tot":"msg"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":1029,
       "y":196,
       "wires":[
          [
             "735f46c0.686328"
          ]
       ]
    },
    {
       "id":"868ad6cf.999298",
       "type":"http in",
       "z":"257e9eaf.a9d202",
       "name":"",
       "url":"/api/enable/status",
       "method":"put",
       "upload":false,
       "swaggerDoc":"",
       "x":650,
       "y":512,
       "wires":[
          [
             "7576aa68.0aeff4"
          ]
       ]
    },
    {
       "id":"7576aa68.0aeff4",
       "type":"change",
       "z":"257e9eaf.a9d202",
       "name":"PUT",
       "rules":[
          {
             "t":"set",
             "p":"method",
             "pt":"msg",
             "to":"PUT",
             "tot":"str"
          },
          {
             "t":"set",
             "p":"headers",
             "pt":"msg",
             "to":"{\"Content-Type\":\"application/json\"}",
             "tot":"json"
          },
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"{\"status\":payload}",
             "tot":"jsonata"
          },
          {
             "t":"set",
             "p":"retry",
             "pt":"msg",
             "to":"0",
             "tot":"num"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":821.5,
       "y":512,
       "wires":[
          [
             "ddbf2335.1ecbc"
          ]
       ]
    },
    {
       "id":"496ad26e.7314cc",
       "type":"change",
       "z":"257e9eaf.a9d202",
       "name":"GET",
       "rules":[
          {
             "t":"set",
             "p":"method",
             "pt":"msg",
             "to":"GET",
             "tot":"str"
          },
          {
             "t":"set",
             "p":"retry",
             "pt":"msg",
             "to":"0",
             "tot":"num"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":821,
       "y":472,
       "wires":[
          [
             "ddbf2335.1ecbc"
          ]
       ]
    },
    {
       "id":"5f18f13a.52f1",
       "type":"api-call-service",
       "z":"257e9eaf.a9d202",
       "name":"Enable Status switch on",
       "server":"5806b60f.c2e778",
       "version":0,
       "service_domain":"switch",
       "service":"turn_on",
       "data":"{\"entity_id\":\"switch.enable_status\"}",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "x":541.5,
       "y":149,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"5d7c6637.090738",
       "type":"switch",
       "z":"257e9eaf.a9d202",
       "name":"In office?",
       "property":"payload",
       "propertyType":"msg",
       "rules":[
          {
             "t":"eq",
             "v":"on",
             "vt":"str"
          },
          {
             "t":"else"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":2,
       "x":283.5,
       "y":173.8800048828125,
       "wires":[
          [
             "5f18f13a.52f1"
          ],
          [
             "6820f743.d91ec8"
          ]
       ]
    },
    {
       "id":"6820f743.d91ec8",
       "type":"api-call-service",
       "z":"257e9eaf.a9d202",
       "name":"Enable Status switch off",
       "server":"5806b60f.c2e778",
       "service_domain":"switch",
       "service":"turn_off",
       "data":"{\"entity_id\":\"switch.enable_status\"}",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "x":540,
       "y":199,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"76084fd2.b061",
       "type":"switch",
       "z":"c26c68e9.a7fd88",
       "name":"StatusCode",
       "property":"statusCode",
       "propertyType":"msg",
       "rules":[
          {
             "t":"eq",
             "v":"200",
             "vt":"str"
          },
          {
             "t":"eq",
             "v":"403",
             "vt":"str"
          },
          {
             "t":"eq",
             "v":"500",
             "vt":"str"
          },
          {
             "t":"else"
          }
       ],
       "checkall":"false",
       "repair":false,
       "outputs":4,
       "x":617,
       "y":225,
       "wires":[
          [
             "a1c65825.2e1fc8",
             "1d233293.0bf51d"
          ],
          [
 
          ],
          [
             "35d84bb9.f1c014"
          ],
          [
             "35d84bb9.f1c014"
          ]
       ],
       "outputLabels":[
          "200",
          "403",
          "500",
          "Other"
       ]
    },
    {
       "id":"46f502a2.0241ec",
       "type":"switch",
       "z":"c26c68e9.a7fd88",
       "name":"Does actual status match?",
       "property":"actualstatus",
       "propertyType":"msg",
       "rules":[
          {
             "t":"neq",
             "v":"expectedstatus ? 1 : 0",
             "vt":"jsonata"
          },
          {
             "t":"else"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":2,
       "x":1303,
       "y":148,
       "wires":[
          [
             "f18b6049.21688"
          ],
          [
             "c5447f3c.01585"
          ]
       ],
       "outputLabels":[
          "no",
          "yes"
       ]
    },
    {
       "id":"a1c65825.2e1fc8",
       "type":"change",
       "z":"c26c68e9.a7fd88",
       "name":"Set actual status",
       "rules":[
          {
             "t":"move",
             "p":"payload.status",
             "pt":"msg",
             "to":"actualstatus",
             "tot":"msg"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":844,
       "y":148,
       "wires":[
          [
             "80a57e32.9d226"
          ]
       ]
    },
    {
       "id":"80a57e32.9d226",
       "type":"api-current-state",
       "z":"c26c68e9.a7fd88",
       "name":"Get expected status",
       "server":"5806b60f.c2e778",
       "version":0,
       "outputs":1,
       "halt_if":"",
       "halt_if_type":"str",
       "halt_if_compare":"is",
       "override_topic":false,
       "entity_id":"binary_sensor.brad_in_office",
       "state_type":"habool",
       "state_location":"expectedstatus",
       "override_payload":"msg",
       "entity_location":"data",
       "override_data":"msg",
       "x":1057,
       "y":148,
       "wires":[
          [
             "46f502a2.0241ec",
             "a72051a6.f03b6"
          ]
       ]
    },
    {
       "id":"f18b6049.21688",
       "type":"change",
       "z":"c26c68e9.a7fd88",
       "name":"Set payload to expected status",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"{\"status\": expectedstatus ? 1 : 0}",
             "tot":"jsonata"
          },
          {
             "t":"set",
             "p":"method",
             "pt":"msg",
             "to":"PUT",
             "tot":"str"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":552,
       "y":85,
       "wires":[
          [
             "6da8f4a1.cee32c",
             "c6336576.216a98"
          ]
       ]
    },
    {
       "id":"35d84bb9.f1c014",
       "type":"switch",
       "z":"c26c68e9.a7fd88",
       "name":"retry?",
       "property":"retry",
       "propertyType":"msg",
       "rules":[
          {
             "t":"gt",
             "v":"0",
             "vt":"num"
          },
          {
             "t":"else"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":2,
       "x":807,
       "y":248,
       "wires":[
          [
 
          ],
          [
             "d4e526e7.48e878"
          ]
       ],
       "outputLabels":[
          "> 0",
          "<= 0"
       ]
    },
    {
       "id":"ef3780a8.b8d5d",
       "type":"delay",
       "z":"c26c68e9.a7fd88",
       "name":"",
       "pauseType":"delay",
       "timeout":"10",
       "timeoutUnits":"seconds",
       "rate":"1",
       "nbRateUnits":"1",
       "rateUnits":"second",
       "randomFirst":"1",
       "randomLast":"5",
       "randomUnits":"seconds",
       "drop":false,
       "x":618,
       "y":306,
       "wires":[
          [
             "a1c65825.2e1fc8",
             "26498ff5.5e3fb"
          ]
       ]
    },
    {
       "id":"d4e526e7.48e878",
       "type":"change",
       "z":"c26c68e9.a7fd88",
       "name":"",
       "rules":[
          {
             "t":"set",
             "p":"retry",
             "pt":"msg",
             "to":"1",
             "tot":"num"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":470,
       "y":306,
       "wires":[
          [
             "ef3780a8.b8d5d"
          ]
       ]
    },
    {
       "id":"26498ff5.5e3fb",
       "type":"debug",
       "z":"c26c68e9.a7fd88",
       "name":"",
       "active":false,
       "tosidebar":true,
       "console":false,
       "tostatus":false,
       "complete":"true",
       "x":776,
       "y":306,
       "wires":[
 
       ]
    },
    {
       "id":"d458071.bfec2f8",
       "type":"debug",
       "z":"c26c68e9.a7fd88",
       "name":"",
       "active":false,
       "tosidebar":true,
       "console":false,
       "tostatus":false,
       "complete":"true",
       "x":597,
       "y":168,
       "wires":[
 
       ]
    },
    {
       "id":"a72051a6.f03b6",
       "type":"debug",
       "z":"c26c68e9.a7fd88",
       "name":"",
       "active":false,
       "tosidebar":true,
       "console":false,
       "tostatus":false,
       "complete":"true",
       "x":1225,
       "y":80,
       "wires":[
 
       ]
    },
    {
       "id":"9238ad73.06261",
       "type":"debug",
       "z":"c26c68e9.a7fd88",
       "name":"",
       "active":false,
       "tosidebar":true,
       "console":false,
       "tostatus":false,
       "complete":"true",
       "x":1763,
       "y":174,
       "wires":[
 
       ]
    },
    {
       "id":"c6336576.216a98",
       "type":"debug",
       "z":"c26c68e9.a7fd88",
       "name":"",
       "active":false,
       "tosidebar":true,
       "console":false,
       "tostatus":false,
       "complete":"true",
       "x":786,
       "y":85,
       "wires":[
 
       ]
    },
    {
       "id":"c7d84542.3cb668",
       "type":"debug",
       "z":"c26c68e9.a7fd88",
       "name":"",
       "active":false,
       "tosidebar":true,
       "console":false,
       "tostatus":false,
       "complete":"true",
       "x":426,
       "y":260,
       "wires":[
 
       ]
    },
    {
       "id":"e6f0b254.c1d7a",
       "type":"comment",
       "z":"257e9eaf.a9d202",
       "name":"In the office status",
       "info":"",
       "x":98.5,
       "y":163,
       "wires":[
 
       ]
    },
    {
       "id":"13320b57.601375",
       "type":"mqtt in",
       "z":"3e06a286.f1fcfe",
       "name":"",
       "topic":"shellies/#",
       "qos":"2",
       "datatype":"auto",
       "broker":"ab404be4.584f18",
       "x":172.5,
       "y":95,
       "wires":[
          [
             "dfdcad47.9b728"
          ]
       ]
    },
    {
       "id":"dfdcad47.9b728",
       "type":"debug",
       "z":"3e06a286.f1fcfe",
       "name":"",
       "active":false,
       "tosidebar":true,
       "console":false,
       "tostatus":false,
       "complete":"true",
       "x":486.5,
       "y":96,
       "wires":[
 
       ]
    },
    {
       "id":"ef1bbf33.8bf2e",
       "type":"mqtt out",
       "z":"3e06a286.f1fcfe",
       "name":"",
       "topic":"shellies/command",
       "qos":"0",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":303.5,
       "y":221,
       "wires":[
 
       ]
    },
    {
       "id":"c03bf481.29e5f8",
       "type":"inject",
       "z":"3e06a286.f1fcfe",
       "name":"",
       "topic":"",
       "payload":"update",
       "payloadType":"str",
       "repeat":"",
       "crontab":"",
       "once":false,
       "onceDelay":0.1,
       "x":107.5,
       "y":227,
       "wires":[
          [
             "ef1bbf33.8bf2e"
          ]
       ]
    },
    {
       "id":"9b228951.643b18",
       "type":"inject",
       "z":"98e70926.543948",
       "name":"HASS Connected?",
       "topic":"",
       "payload":"homeassistant.homeAssistant.isConnected",
       "payloadType":"global",
       "repeat":"1",
       "crontab":"",
       "once":false,
       "onceDelay":0.1,
       "x":140.00008392333984,
       "y":310.7500810623169,
       "wires":[
          [
             "66fa41bf.6137d"
          ]
       ]
    },
    {
       "id":"66fa41bf.6137d",
       "type":"rbe",
       "z":"98e70926.543948",
       "name":"",
       "func":"rbei",
       "gap":"",
       "start":"",
       "inout":"out",
       "property":"payload",
       "x":310.00008392333984,
       "y":310.7500810623169,
       "wires":[
          [
             "75873d45.3d76e4"
          ]
       ]
    },
    {
       "id":"75873d45.3d76e4",
       "type":"switch",
       "z":"98e70926.543948",
       "name":"",
       "property":"payload",
       "propertyType":"msg",
       "rules":[
          {
             "t":"true"
          },
          {
             "t":"else"
          }
       ],
       "checkall":"false",
       "repair":false,
       "outputs":2,
       "x":430.00008392333984,
       "y":310.7500810623169,
       "wires":[
          [
             "fe37facc.60fd58"
          ],
          [
             "6e7af992.aebe38"
          ]
       ]
    },
    {
       "id":"b3056446.849858",
       "type":"change",
       "z":"98e70926.543948",
       "name":"Set home assistant online message",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"(\t   $restarted := $flowContext(\"restarted\");\t   $notificationId := $restarted ? $flowContext(\"notificationId\") : msg.topic;\t   {\t       \"autoremote\":{\t           \"notification\":{\t               \"id\": $notificationId,\t               \"title\":\"Home Assistant\",\t               \"text\":$restarted ? \"Restart complete\" : \"Online\",\t               \"icon\":\"https://www.home-assistant.io/images/components/alexa/alexa-108x108.png\"\t           },\t           \"devices\":[\"brad\"]\t \t       }\t\t   }\t\t)",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":1051.0000839233398,
       "y":284.7500810623169,
       "wires":[
          [
             "f26e1718.360828",
             "f1d01ae2.4271a8"
          ]
       ]
    },
    {
       "id":"f26e1718.360828",
       "type":"change",
       "z":"98e70926.543948",
       "name":"set restarted flag = false",
       "rules":[
          {
             "t":"set",
             "p":"restarted",
             "pt":"flow",
             "to":"false",
             "tot":"bool"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":1339.0000839233398,
       "y":284.7500810623169,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"6e851f70.6d24a",
       "type":"subflow:8f5573e3.e52df",
       "z":"98e70926.543948",
       "name":"",
       "x":1304.0000839233398,
       "y":556.7500810623169,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"c58e6d67.db875",
       "type":"change",
       "z":"98e70926.543948",
       "name":"Set home assistant offline message",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"(\t   $restarted := $flowContext(\"restarted\");\t   $notificationId := $restarted ? $flowContext(\"notificationId\") : msg.topic;\t   {\t       \"autoremote\":{\t           \"notification\":{\t               \"id\": $notificationId,\t               \"title\":\"Home Assistant\",\t               \"text\":$restarted ? \"Restarting\" : \"Offline\",\t               \"icon\":$restarted ? \"https://www.home-assistant.io/images/components/alexa/alexa-108x108.png\" : \"https://cdn2.iconfinder.com/data/icons/freecns-cumulus/32/519791-101_Warning-128.png\",\t               \"indeterminateprogress\": $restarted ? true : null\t           },\t           \"devices\":[\"brad\"]\t \t       }\t\t   }\t\t)",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":1054.0000839233398,
       "y":556.7500810623169,
       "wires":[
          [
             "6e851f70.6d24a"
          ]
       ]
    },
    {
       "id":"f1d01ae2.4271a8",
       "type":"subflow:8f5573e3.e52df",
       "z":"98e70926.543948",
       "name":"",
       "x":1299.0000839233398,
       "y":246.7500810623169,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"412b7377.77d51c",
       "type":"comment",
       "z":"98e70926.543948",
       "name":"Home assistant monitor",
       "info":"",
       "x":115.50008392333984,
       "y":270.7500810623169,
       "wires":[
 
       ]
    },
    {
       "id":"62181223.1ff0fc",
       "type":"comment",
       "z":"98e70926.543948",
       "name":"Home assistant online",
       "info":"",
       "x":750.5000839233398,
       "y":246.7500810623169,
       "wires":[
 
       ]
    },
    {
       "id":"c98da19.af3726",
       "type":"comment",
       "z":"98e70926.543948",
       "name":"AutoRemote",
       "info":"",
       "x":780.5000839233398,
       "y":285.7500810623169,
       "wires":[
 
       ]
    },
    {
       "id":"4375922b.14a33c",
       "type":"comment",
       "z":"98e70926.543948",
       "name":"Shelly update",
       "info":"",
       "x":780.5000839233398,
       "y":330.7500810623169,
       "wires":[
 
       ]
    },
    {
       "id":"10261aa0.105e25",
       "type":"mqtt out",
       "z":"98e70926.543948",
       "name":"Update shellies",
       "topic":"shellies/command",
       "qos":"0",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":1177.5000839233398,
       "y":330.7500810623169,
       "wires":[
 
       ]
    },
    {
       "id":"92d3e50f.f48db8",
       "type":"change",
       "z":"98e70926.543948",
       "name":"",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"update",
             "tot":"str"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":991.5000839233398,
       "y":330.7500810623169,
       "wires":[
          [
             "10261aa0.105e25"
          ]
       ]
    },
    {
       "id":"a62147c6.2ac208",
       "type":"comment",
       "z":"98e70926.543948",
       "name":"Home assistant offline",
       "info":"",
       "x":750.0000839233398,
       "y":516.7500810623169,
       "wires":[
 
       ]
    },
    {
       "id":"e6d3d7e4.e07368",
       "type":"comment",
       "z":"98e70926.543948",
       "name":"AutoRemote",
       "info":"",
       "x":781.0000839233398,
       "y":556.7500810623169,
       "wires":[
 
       ]
    },
    {
       "id":"fe37facc.60fd58",
       "type":"link out",
       "z":"98e70926.543948",
       "name":"HASS online",
       "links":[
          "37e73b94.cbdf24",
          "77e01aee.53c9c4",
          "a694c7f4.abe498",
          "1fa9db6a.744ce5",
          "5a4cc5b0.aec0cc",
          "bbe1bd76.e0083"
       ],
       "x":530.5000839233398,
       "y":289.7500810623169,
       "wires":[
 
       ]
    },
    {
       "id":"6e7af992.aebe38",
       "type":"link out",
       "z":"98e70926.543948",
       "name":"HASS offline",
       "links":[
          "62bd77df.ed9f48"
       ],
       "x":530.5000839233398,
       "y":328.7500810623169,
       "wires":[
 
       ]
    },
    {
       "id":"7bba1fd0.3c189",
       "type":"comment",
       "z":"98e70926.543948",
       "name":"Online",
       "info":"",
       "x":600.0000839233398,
       "y":288.7500810623169,
       "wires":[
 
       ]
    },
    {
       "id":"ca6cf3a1.04f25",
       "type":"comment",
       "z":"98e70926.543948",
       "name":"Offline",
       "info":"",
       "x":601.0000839233398,
       "y":328.7500810623169,
       "wires":[
 
       ]
    },
    {
       "id":"a694c7f4.abe498",
       "type":"link in",
       "z":"98e70926.543948",
       "name":"HASS online AutoRemote",
       "links":[
          "fe37facc.60fd58"
       ],
       "x":871.5000839233398,
       "y":284.7500810623169,
       "wires":[
          [
             "b3056446.849858"
          ]
       ]
    },
    {
       "id":"1fa9db6a.744ce5",
       "type":"link in",
       "z":"98e70926.543948",
       "name":"HASS online Shelly update",
       "links":[
          "fe37facc.60fd58"
       ],
       "x":872.0000839233398,
       "y":330.7500810623169,
       "wires":[
          [
             "92d3e50f.f48db8"
          ]
       ]
    },
    {
       "id":"62bd77df.ed9f48",
       "type":"link in",
       "z":"98e70926.543948",
       "name":"HASS offline AutoRemote",
       "links":[
          "6e7af992.aebe38"
       ],
       "x":873.0000839233398,
       "y":556.7500810623169,
       "wires":[
          [
             "c58e6d67.db875"
          ]
       ]
    },
    {
       "id":"119104b2.ab794b",
       "type":"mqtt out",
       "z":"3e06a286.f1fcfe",
       "name":"",
       "topic":"shellies/shelly1-943C58/relay/0/command",
       "qos":"0",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":377,
       "y":301,
       "wires":[
 
       ]
    },
    {
       "id":"2113e6fd.a8312a",
       "type":"inject",
       "z":"3e06a286.f1fcfe",
       "name":"",
       "topic":"",
       "payload":"on",
       "payloadType":"str",
       "repeat":"",
       "crontab":"",
       "once":false,
       "onceDelay":0.1,
       "x":109,
       "y":283,
       "wires":[
          [
             "119104b2.ab794b"
          ]
       ]
    },
    {
       "id":"da18f77f.3b36c8",
       "type":"inject",
       "z":"3e06a286.f1fcfe",
       "name":"",
       "topic":"",
       "payload":"off",
       "payloadType":"str",
       "repeat":"",
       "crontab":"",
       "once":false,
       "onceDelay":0.1,
       "x":108,
       "y":322,
       "wires":[
          [
             "119104b2.ab794b"
          ]
       ]
    },
    {
       "id":"dc87f8cf.cb9578",
       "type":"server-state-changed",
       "z":"257e9eaf.a9d202",
       "name":"MQTT Timestamp",
       "server":"5806b60f.c2e778",
       "entityidfilter":"sensor.brad_mobile_mqtt_send_timestamp",
       "entityidfiltertype":"exact",
       "outputinitially":false,
       "state_type":"str",
       "haltifstate":"",
       "halt_if_type":"str",
       "halt_if_compare":"is",
       "outputs":1,
       "output_only_on_state_change":true,
       "x":115.5,
       "y":769,
       "wires":[
          [
             "dee4b35.eff6d5"
          ]
       ]
    },
    {
       "id":"dee4b35.eff6d5",
       "type":"change",
       "z":"257e9eaf.a9d202",
       "name":"Set MQTT_RCV_TIMESTAMP to payload",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"{\t    \"taskerVariable\": {\t        \"name\": \"MQTT_RCV_TIMESTAMP\",\t        \"value\": payload,\t        \"devices\": [\"brad\"]\t    }\t}",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":393,
       "y":769,
       "wires":[
          [
             "752fe7f.d1c7318"
          ]
       ]
    },
    {
       "id":"cc4dda7c.021558",
       "type":"change",
       "z":"12d32bdb.3c9804",
       "name":"Set variable message",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"{\t   \"autoremote\":{\t       \"message\":{\t           \"message\": \"setvar \" & payload.taskerVariable.name & \"=:=\" & payload.taskerVariable.value,\t           \"collapseKey\": payload.taskerVariable.name\t       },\t       \"devices\": payload.taskerVariable.devices\t   }\t}",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":232,
       "y":68,
       "wires":[
          [
             "565c25d.7e677dc"
          ]
       ]
    },
    {
       "id":"565c25d.7e677dc",
       "type":"subflow:8f5573e3.e52df",
       "z":"12d32bdb.3c9804",
       "name":"",
       "x":438.5,
       "y":68,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"752fe7f.d1c7318",
       "type":"subflow:12d32bdb.3c9804",
       "z":"257e9eaf.a9d202",
       "name":"",
       "x":674.5,
       "y":769,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"1cdfff07.0728b1",
       "type":"change",
       "z":"257e9eaf.a9d202",
       "name":"Set INOFFICE to payload",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"{\t   \"taskerVariable\":{\t       \"name\":\"INOFFICE\",\t       \"value\":payload = \"on\" ? true : false,\t       \"devices\":[\"brad\"]\t   }\t}",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":540,
       "y":247,
       "wires":[
          [
             "5b57ffb0.c0ff5"
          ]
       ]
    },
    {
       "id":"5b57ffb0.c0ff5",
       "type":"subflow:12d32bdb.3c9804",
       "z":"257e9eaf.a9d202",
       "name":"",
       "x":769,
       "y":247,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"4880d837.dfe3a8",
       "type":"change",
       "z":"257e9eaf.a9d202",
       "name":"Extract door access code",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"{\t   \"data\":{\t        \"entity_id\": \"input_text.enable_door\",\t       \"value\":$match(html, /\\d{4}E/).match\t   }\t}",
             "tot":"jsonata"
          },
          {
             "t":"set",
             "p":"#:(file)::door_access_code",
             "pt":"flow",
             "to":"$match(html, /\\d{4}E/).match",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":307.5,
       "y":615,
       "wires":[
          [
             "217394d2.4a1e1c"
          ]
       ]
    },
    {
       "id":"a8a26d9b.4a055",
       "type":"subflow:c26c68e9.a7fd88",
       "z":"257e9eaf.a9d202",
       "name":"",
       "env":[
 
       ],
       "x":1262,
       "y":490,
       "wires":[
          [
             "128530b6.a7587f",
             "4e4da1b0.4ca63"
          ]
       ]
    },
    {
       "id":"d7804aa1.653658",
       "type":"inject",
       "z":"257e9eaf.a9d202",
       "name":"On",
       "topic":"",
       "payload":"true",
       "payloadType":"bool",
       "repeat":"",
       "crontab":"",
       "once":true,
       "onceDelay":0.1,
       "x":85.5,
       "y":480,
       "wires":[
          [
             "f42617e8.545b48"
          ]
       ]
    },
    {
       "id":"6a86d692.24d238",
       "type":"inject",
       "z":"257e9eaf.a9d202",
       "name":"Off",
       "topic":"",
       "payload":"false",
       "payloadType":"bool",
       "repeat":"",
       "crontab":"",
       "once":false,
       "onceDelay":0.1,
       "x":86,
       "y":515,
       "wires":[
          [
             "f42617e8.545b48"
          ]
       ]
    },
    {
       "id":"f42617e8.545b48",
       "type":"change",
       "z":"257e9eaf.a9d202",
       "name":"Set update_enable_status",
       "rules":[
          {
             "t":"set",
             "p":"update_enable_status",
             "pt":"global",
             "to":"payload",
             "tot":"msg"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":270.5,
       "y":495,
       "wires":[
          [
             "98e87584.c7e4c8"
          ]
       ]
    },
    {
       "id":"cbbb64af.32dd18",
       "type":"switch",
       "z":"c26c68e9.a7fd88",
       "name":"Update enable status?",
       "property":"update_enable_status",
       "propertyType":"global",
       "rules":[
          {
             "t":"true"
          },
          {
             "t":"else"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":2,
       "x":145.5,
       "y":315,
       "wires":[
          [
             "e47d55aa.5af588"
          ],
          [
             "4ccf8e7b.8482c"
          ]
       ]
    },
    {
       "id":"4ccf8e7b.8482c",
       "type":"change",
       "z":"c26c68e9.a7fd88",
       "name":"set status response (503 - unavailable)",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"503",
             "tot":"num"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":616,
       "y":362,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"98e87584.c7e4c8",
       "type":"debug",
       "z":"257e9eaf.a9d202",
       "name":"Enabled?",
       "active":true,
       "tosidebar":false,
       "console":false,
       "tostatus":true,
       "complete":"payload",
       "targetType":"msg",
       "x":467.5,
       "y":495,
       "wires":[
 
       ]
    },
    {
       "id":"2da1871e.f123b8",
       "type":"e-mail in",
       "z":"9943920f.042cc",
       "name":"Receive emails from node-red folder",
       "protocol":"IMAP",
       "server":"outlook.office365.com",
       "useSSL":true,
       "port":"993",
       "box":"node-red",
       "disposition":"Read",
       "criteria":"UNSEEN",
       "repeat":"900",
       "fetch":"auto",
       "inputs":0,
       "x":165,
       "y":123,
       "wires":[
          [
             "1024b9c5.c7bdd6"
          ]
       ]
    },
    {
       "id":"1024b9c5.c7bdd6",
       "type":"switch",
       "z":"9943920f.042cc",
       "name":"Subject",
       "property":"topic",
       "propertyType":"msg",
       "rules":[
          {
             "t":"regex",
             "v":"(door|access) (code)",
             "vt":"str",
             "case":true
          },
          {
             "t":"regex",
             "v":"Draw Alert",
             "vt":"str",
             "case":true
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":2,
       "x":409,
       "y":123,
       "wires":[
          [
             "93f1b564.0e3898"
          ],
          [
             "f44e984d.7457b8"
          ]
       ],
       "outputLabels":[
          "Door access codes",
          "PickMyPostcode"
       ]
    },
    {
       "id":"93f1b564.0e3898",
       "type":"link out",
       "z":"9943920f.042cc",
       "name":"Recieved door access code email",
       "links":[
          "ccb51aef.783a38"
       ],
       "x":569.5,
       "y":109,
       "wires":[
 
       ]
    },
    {
       "id":"ccb51aef.783a38",
       "type":"link in",
       "z":"257e9eaf.a9d202",
       "name":"Process door access code email",
       "links":[
          "93f1b564.0e3898"
       ],
       "x":45.5,
       "y":615,
       "wires":[
          [
             "4880d837.dfe3a8"
          ]
       ]
    },
    {
       "id":"8fe7e8e7.4577d8",
       "type":"comment",
       "z":"257e9eaf.a9d202",
       "name":"Door access code",
       "info":"",
       "x":98,
       "y":574,
       "wires":[
 
       ]
    },
    {
       "id":"9480a405.5bc4e8",
       "type":"comment",
       "z":"257e9eaf.a9d202",
       "name":"Enable status",
       "info":"",
       "x":81,
       "y":437,
       "wires":[
 
       ]
    },
    {
       "id":"27ccc027.359e9",
       "type":"comment",
       "z":"257e9eaf.a9d202",
       "name":"MQTT timestamp",
       "info":"",
       "x":91,
       "y":724,
       "wires":[
 
       ]
    },
    {
       "id":"9da6293d.5d6f48",
       "type":"server-state-changed",
       "z":"257e9eaf.a9d202",
       "name":"INOFFICE",
       "server":"5806b60f.c2e778",
       "version":0,
       "entityidfilter":"sensor.brad_mobile_tasker_variable_inoffice",
       "entityidfiltertype":"exact",
       "outputinitially":false,
       "state_type":"str",
       "haltifstate":"",
       "halt_if_type":"str",
       "halt_if_compare":"is",
       "outputs":1,
       "output_only_on_state_change":true,
       "x":85.5,
       "y":267,
       "wires":[
          [
             "761adb7d.2ac574"
          ]
       ]
    },
    {
       "id":"761adb7d.2ac574",
       "type":"api-current-state",
       "z":"257e9eaf.a9d202",
       "name":"Check in office sensor",
       "server":"5806b60f.c2e778",
       "version":0,
       "outputs":2,
       "halt_if":"payload",
       "halt_if_type":"msg",
       "halt_if_compare":"is",
       "override_topic":false,
       "entity_id":"binary_sensor.brad_in_office",
       "state_type":"str",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"data",
       "override_data":"msg",
       "x":274,
       "y":267,
       "wires":[
          [
             "1cdfff07.0728b1"
          ],
          [
 
          ]
       ]
    },
    {
       "id":"1f5b4072.825fb",
       "type":"http in",
       "z":"6076e8bd.b0fe58",
       "name":"",
       "url":"/api/tado/hotwater",
       "method":"get",
       "upload":false,
       "swaggerDoc":"",
       "x":133,
       "y":229,
       "wires":[
          [
             "4dd2b039.fc86e"
          ]
       ]
    },
    {
       "id":"9f76374f.0a8258",
       "type":"http request",
       "z":"6076e8bd.b0fe58",
       "name":"GET",
       "method":"GET",
       "ret":"obj",
       "paytoqs":false,
       "url":"{{{tado.url}}}",
       "tls":"",
       "proxy":"",
       "authType":"basic",
       "x":797.5,
       "y":229,
       "wires":[
          [
             "ba3aecb7.31d8a"
          ]
       ]
    },
    {
       "id":"4dd2b039.fc86e",
       "type":"credentials",
       "z":"6076e8bd.b0fe58",
       "name":"Tado Credentials",
       "props":[
          {
             "value":"tado.homeid",
             "type":"msg"
          },
          {
             "value":"tado.username",
             "type":"msg"
          },
          {
             "value":"tado.password",
             "type":"msg"
          }
       ],
       "x":350.5,
       "y":229,
       "wires":[
          [
             "3587dec4.a9aad2"
          ]
       ]
    },
    {
       "id":"3587dec4.a9aad2",
       "type":"change",
       "z":"6076e8bd.b0fe58",
       "name":"Get Hot Water State URL",
       "rules":[
          {
             "t":"set",
             "p":"tado.url",
             "pt":"msg",
             "to":"\"https://my.tado.com/api/v2/homes/\" & tado.homeid & \"/zones/\" & \"0/state\" & \"?username=\" & tado.username & \"&password=\" & tado.password",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":590.5,
       "y":229,
       "wires":[
          [
             "9f76374f.0a8258"
          ]
       ]
    },
    {
       "id":"e400bcad.aafb2",
       "type":"http response",
       "z":"6076e8bd.b0fe58",
       "name":"",
       "statusCode":"",
       "headers":{
 
       },
       "x":1148.5,
       "y":229,
       "wires":[
 
       ]
    },
    {
       "id":"ba3aecb7.31d8a",
       "type":"change",
       "z":"6076e8bd.b0fe58",
       "name":"Get Power",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"payload.setting.power",
             "tot":"msg"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":968.5,
       "y":229,
       "wires":[
          [
             "e400bcad.aafb2"
          ]
       ]
    },
    {
       "id":"1528abf3.7d4294",
       "type":"http in",
       "z":"6076e8bd.b0fe58",
       "name":"",
       "url":"/api/tado/hotwater",
       "method":"put",
       "upload":false,
       "swaggerDoc":"",
       "x":132,
       "y":324,
       "wires":[
          [
             "5c89e632.2d1078"
          ]
       ]
    },
    {
       "id":"5c89e632.2d1078",
       "type":"credentials",
       "z":"6076e8bd.b0fe58",
       "name":"Tado Credentials",
       "props":[
          {
             "value":"tado.homeid",
             "type":"msg"
          },
          {
             "value":"tado.username",
             "type":"msg"
          },
          {
             "value":"tado.password",
             "type":"msg"
          }
       ],
       "x":351,
       "y":324,
       "wires":[
          [
             "8bf03ebd.7e056"
          ]
       ]
    },
    {
       "id":"49f42cb0.49c834",
       "type":"change",
       "z":"6076e8bd.b0fe58",
       "name":"Put Hot Water State URL & payload",
       "rules":[
          {
             "t":"set",
             "p":"tado.url",
             "pt":"msg",
             "to":"\"https://my.tado.com/api/v2/homes/\" & tado.homeid & \"/zones/\" & \"0/overlay\" & \"?username=\" & tado.username & \"&password=\" & tado.password",
             "tot":"jsonata"
          },
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"{\t    \"type\": \"MANUAL\",\t    \"setting\": {\t        \"type\": \"HOT_WATER\",\t        \"power\": \"ON\",\t        \"temperature\": null\t    },\t    \"termination\": {\t        \"type\": \"TADO_MODE\",\t        \"typeSkillBasedApp\": \"TADO_MODE\"\t    }\t}",
             "tot":"jsonata"
          },
          {
             "t":"set",
             "p":"method",
             "pt":"msg",
             "to":"PUT",
             "tot":"str"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":779,
       "y":291,
       "wires":[
          [
             "bfc56836.0f5e88"
          ]
       ]
    },
    {
       "id":"bfc56836.0f5e88",
       "type":"http request",
       "z":"6076e8bd.b0fe58",
       "name":"request",
       "method":"use",
       "ret":"obj",
       "paytoqs":false,
       "url":"{{{tado.url}}}",
       "tls":"",
       "proxy":"",
       "authType":"basic",
       "x":1047,
       "y":315,
       "wires":[
          [
             "10e60ac0.6fc455"
          ]
       ]
    },
    {
       "id":"10e60ac0.6fc455",
       "type":"http response",
       "z":"6076e8bd.b0fe58",
       "name":"",
       "statusCode":"",
       "headers":{
 
       },
       "x":1195,
       "y":315,
       "wires":[
 
       ]
    },
    {
       "id":"8bf03ebd.7e056",
       "type":"switch",
       "z":"6076e8bd.b0fe58",
       "name":"",
       "property":"payload",
       "propertyType":"msg",
       "rules":[
          {
             "t":"eq",
             "v":"ON",
             "vt":"str"
          },
          {
             "t":"eq",
             "v":"OFF",
             "vt":"str"
          }
       ],
       "checkall":"false",
       "repair":false,
       "outputs":2,
       "x":532.5,
       "y":324,
       "wires":[
          [
             "49f42cb0.49c834"
          ],
          [
             "2666cfae.daedf"
          ]
       ]
    },
    {
       "id":"2666cfae.daedf",
       "type":"change",
       "z":"6076e8bd.b0fe58",
       "name":"Delete Hot Water Overlay URL",
       "rules":[
          {
             "t":"set",
             "p":"tado.url",
             "pt":"msg",
             "to":"\"https://my.tado.com/api/v2/homes/\" & tado.homeid & \"/zones/\" & \"0/overlay\" & \"?username=\" & tado.username & \"&password=\" & tado.password",
             "tot":"jsonata"
          },
          {
             "t":"set",
             "p":"method",
             "pt":"msg",
             "to":"DELETE",
             "tot":"str"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":780,
       "y":347,
       "wires":[
          [
             "bfc56836.0f5e88"
          ]
       ]
    },
    {
       "id":"84fa231c.8ef37",
       "type":"server-state-changed",
       "z":"6076e8bd.b0fe58",
       "name":"Hot water timer",
       "server":"5806b60f.c2e778",
       "entityidfilter":"timer.hotwater",
       "entityidfiltertype":"exact",
       "outputinitially":false,
       "state_type":"str",
       "haltifstate":"active,idle",
       "halt_if_type":"str",
       "halt_if_compare":"does_not_include",
       "outputs":2,
       "output_only_on_state_change":true,
       "x":111.5,
       "y":131,
       "wires":[
          [
             "ad495224.90b9a"
          ],
          [
 
          ]
       ]
    },
    {
       "id":"348dcc4d.6b2574",
       "type":"api-call-service",
       "z":"6076e8bd.b0fe58",
       "name":"Hotwater switch",
       "server":"5806b60f.c2e778",
       "service_domain":"switch",
       "service":"",
       "data":"{\"entity_id\":\"switch.hotwater\"}",
       "mergecontext":"",
       "output_location":"payload",
       "output_location_type":"msg",
       "x":487.5,
       "y":130.2699966430664,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"ad495224.90b9a",
       "type":"change",
       "z":"6076e8bd.b0fe58",
       "name":"Set service call",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"{\t    \"service\": payload = \"active\" ? \"turn_on\" : \"turn_off\"\t}",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":301.5,
       "y":130,
       "wires":[
          [
             "348dcc4d.6b2574"
          ]
       ]
    },
    {
       "id":"8e06ae2a.f3fb7",
       "type":"comment",
       "z":"6076e8bd.b0fe58",
       "name":"Timer",
       "info":"",
       "x":62.5,
       "y":90,
       "wires":[
 
       ]
    },
    {
       "id":"f8e45bba.6a8638",
       "type":"comment",
       "z":"6076e8bd.b0fe58",
       "name":"API",
       "info":"",
       "x":64.5,
       "y":191,
       "wires":[
 
       ]
    },
    {
       "id":"d38fbe26.bc9c8",
       "type":"debug",
       "z":"3e06a286.f1fcfe",
       "name":"",
       "active":true,
       "tosidebar":true,
       "console":false,
       "tostatus":false,
       "complete":"false",
       "x":447.5,
       "y":509,
       "wires":[
 
       ]
    },
    {
       "id":"2274cbbb.7b4234",
       "type":"time-range-switch",
       "z":"3e06a286.f1fcfe",
       "name":"",
       "lat":"",
       "lon":"",
       "startTime":"22:50",
       "endTime":"23:05",
       "startOffset":0,
       "endOffset":0,
       "x":261.5,
       "y":509,
       "wires":[
          [
             "d38fbe26.bc9c8"
          ],
          [
 
          ]
       ]
    },
    {
       "id":"1d0da822.042668",
       "type":"inject",
       "z":"3e06a286.f1fcfe",
       "name":"",
       "topic":"",
       "payload":"",
       "payloadType":"date",
       "repeat":"",
       "crontab":"",
       "once":false,
       "onceDelay":0.1,
       "x":80.5,
       "y":514,
       "wires":[
          [
             "2274cbbb.7b4234"
          ]
       ]
    },
    {
       "id":"9aa22996.40e848",
       "type":"mqtt in",
       "z":"98e70926.543948",
       "name":"zigbee2mqtt",
       "topic":"zigbee2mqtt/+",
       "qos":"0",
       "datatype":"auto",
       "broker":"ab404be4.584f18",
       "x":75,
       "y":630.5001583099365,
       "wires":[
          [
             "56599e1a.f7a3b"
          ]
       ]
    },
    {
       "id":"56599e1a.f7a3b",
       "type":"json",
       "z":"98e70926.543948",
       "name":"",
       "property":"payload",
       "action":"",
       "pretty":false,
       "x":239.5001220703125,
       "y":630.7501220703125,
       "wires":[
          [
             "e21c93fe.7b26a"
          ]
       ]
    },
    {
       "id":"2b20f320.21bdac",
       "type":"split",
       "z":"98e70926.543948",
       "name":"",
       "splt":"\\n",
       "spltType":"str",
       "arraySplt":1,
       "arraySpltType":"len",
       "stream":false,
       "addname":"key",
       "x":540.2501220703125,
       "y":600.0001831054688,
       "wires":[
          [
             "9911336a.a4e2d"
          ]
       ]
    },
    {
       "id":"b0040182.93fae",
       "type":"mqtt out",
       "z":"98e70926.543948",
       "name":"",
       "topic":"",
       "qos":"",
       "retain":"",
       "broker":"ab404be4.584f18",
       "x":878.5,
       "y":625,
       "wires":[
 
       ]
    },
    {
       "id":"9911336a.a4e2d",
       "type":"change",
       "z":"98e70926.543948",
       "name":"Set topic",
       "rules":[
          {
             "t":"set",
             "p":"topic",
             "pt":"msg",
             "to":"topic & '/' & key",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":727.5,
       "y":600,
       "wires":[
          [
             "b0040182.93fae"
          ]
       ]
    },
    {
       "id":"eb048ad8.8f6688",
       "type":"api-call-service",
       "z":"98bf1f56.6da51",
       "name":"Turn on hall light",
       "server":"5806b60f.c2e778",
       "version":0,
       "service_domain":"light",
       "service":"turn_on",
       "data":"{\"entity_id\":\"light.hall\"}",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "x":542,
       "y":467,
       "wires":[
          [
             "4db58b2b.54a334"
          ]
       ]
    },
    {
       "id":"d900bef7.910d7",
       "type":"api-call-service",
       "z":"98bf1f56.6da51",
       "name":"Turn off hall light",
       "server":"5806b60f.c2e778",
       "service_domain":"light",
       "service":"turn_off",
       "data":"{\"entity_id\":\"light.hall\"}",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "x":1128,
       "y":530,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"6608b5a6.1c0fcc",
       "type":"server-state-changed",
       "z":"98bf1f56.6da51",
       "name":"Hall Light Switch",
       "server":"5806b60f.c2e778",
       "entityidfilter":"binary_sensor.hall_light_switch",
       "entityidfiltertype":"exact",
       "outputinitially":false,
       "state_type":"habool",
       "haltifstate":"",
       "halt_if_type":"str",
       "halt_if_compare":"is",
       "outputs":1,
       "output_only_on_state_change":true,
       "x":314,
       "y":423,
       "wires":[
          [
             "eb048ad8.8f6688"
          ]
       ]
    },
    {
       "id":"1ae1c9f0.9d5ae6",
       "type":"mqtt out",
       "z":"94dca4da.a92a08",
       "name":"mqtt",
       "topic":"",
       "qos":"1",
       "retain":"true",
       "broker":"ab404be4.584f18",
       "x":439.5,
       "y":53,
       "wires":[
 
       ]
    },
    {
       "id":"620a2cff.9f70e4",
       "type":"change",
       "z":"94dca4da.a92a08",
       "name":"Set payload",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"(\t   $milliseconds := $millis() + payload * 1000;\t   $seconds := $substring($string($milliseconds), 0, 10);\t   {\t    \"triggerTimeSeconds\": $seconds,\t    \"responsePayload\": responsePayload\t   }\t)",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":218.5,
       "y":53,
       "wires":[
          [
             "1ae1c9f0.9d5ae6"
          ]
       ]
    },
    {
       "id":"87e1795a.480eb8",
       "type":"server-state-changed",
       "z":"98bf1f56.6da51",
       "name":"Hall Motion 1 trigger",
       "server":"5806b60f.c2e778",
       "entityidfilter":"binary_sensor.hall_motion_1_occupancy",
       "entityidfiltertype":"exact",
       "outputinitially":false,
       "state_type":"habool",
       "haltifstate":"false",
       "halt_if_type":"bool",
       "halt_if_compare":"is",
       "outputs":2,
       "output_only_on_state_change":true,
       "x":133,
       "y":474,
       "wires":[
          [
             "daac813b.42161"
          ],
          [
 
          ]
       ]
    },
    {
       "id":"daac813b.42161",
       "type":"api-current-state",
       "z":"98bf1f56.6da51",
       "name":"Illuminance",
       "server":"5806b60f.c2e778",
       "version":0,
       "outputs":2,
       "halt_if":"6",
       "halt_if_type":"num",
       "halt_if_compare":"gte",
       "override_topic":false,
       "entity_id":"sensor.hall_motion_1_illuminance",
       "state_type":"num",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"data",
       "override_data":"msg",
       "x":322,
       "y":474,
       "wires":[
          [
             "eb048ad8.8f6688"
          ],
          [
             "f865e99.4b67a18"
          ]
       ]
    },
    {
       "id":"3049e4ac.5cabac",
       "type":"server-state-changed",
       "z":"98bf1f56.6da51",
       "name":"Hall Motion 2 trigger",
       "server":"5806b60f.c2e778",
       "version":0,
       "entityidfilter":"binary_sensor.hall_motion_2_occupancy",
       "entityidfiltertype":"exact",
       "outputinitially":false,
       "state_type":"habool",
       "haltifstate":"false",
       "halt_if_type":"bool",
       "halt_if_compare":"is",
       "outputs":2,
       "output_only_on_state_change":true,
       "x":132,
       "y":529,
       "wires":[
          [
             "6a29b5c0.38e9dc"
          ],
          [
 
          ]
       ]
    },
    {
       "id":"6a29b5c0.38e9dc",
       "type":"api-current-state",
       "z":"98bf1f56.6da51",
       "name":"Illuminance",
       "server":"5806b60f.c2e778",
       "version":"1",
       "outputs":2,
       "halt_if":"9",
       "halt_if_type":"num",
       "halt_if_compare":"gte",
       "override_topic":false,
       "entity_id":"sensor.hall_motion_2_illuminance",
       "state_type":"num",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"data",
       "override_data":"msg",
       "blockInputOverrides":false,
       "x":321,
       "y":528,
       "wires":[
          [
             "f865e99.4b67a18"
          ],
          [
             "eb048ad8.8f6688"
          ]
       ]
    },
    {
       "id":"36edf93c.9b5426",
       "type":"server-state-changed",
       "z":"98bf1f56.6da51",
       "name":"Sun",
       "server":"5806b60f.c2e778",
       "entityidfilter":"sun.sun",
       "entityidfiltertype":"exact",
       "outputinitially":true,
       "state_type":"str",
       "haltifstate":"",
       "halt_if_type":"str",
       "halt_if_compare":"is",
       "outputs":1,
       "output_only_on_state_change":true,
       "x":980.5,
       "y":2381,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"a10fce59.539a2",
       "type":"switch",
       "z":"98bf1f56.6da51",
       "name":"",
       "property":"payload",
       "propertyType":"msg",
       "rules":[
          {
             "t":"eq",
             "v":"below_horizon",
             "vt":"str"
          },
          {
             "t":"eq",
             "v":"above_horizon",
             "vt":"str"
          }
       ],
       "checkall":"false",
       "repair":false,
       "outputs":2,
       "x":1116.5,
       "y":2381,
       "wires":[
          [
             "b652def.f49902"
          ],
          [
 
          ]
       ],
       "outputLabels":[
          "below_horizon",
          "above_horizon"
       ]
    },
    {
       "id":"b652def.f49902",
       "type":"api-call-service",
       "z":"98bf1f56.6da51",
       "name":"Turn on sign light",
       "server":"5806b60f.c2e778",
       "service_domain":"light",
       "service":"turn_on",
       "data":"{\"entity_id\":\"light.sign\",\"brightness_pct\":75}",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "x":1290,
       "y":2357,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"e4568621.78c058",
       "type":"api-call-service",
       "z":"98bf1f56.6da51",
       "name":"Turn off sign light",
       "server":"5806b60f.c2e778",
       "service_domain":"light",
       "service":"turn_off",
       "data":"{\"entity_id\":\"light.sign\",\"transition\":15}",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "x":565,
       "y":924,
       "wires":[
          [
             "d8a88d08.cb456"
          ]
       ]
    },
    {
       "id":"4383983c.528db8",
       "type":"server-state-changed",
       "z":"98bf1f56.6da51",
       "name":"Hall Motion 3 trigger",
       "server":"5806b60f.c2e778",
       "entityidfilter":"binary_sensor.hall_motion_3_occupancy",
       "entityidfiltertype":"exact",
       "outputinitially":false,
       "state_type":"habool",
       "haltifstate":"false",
       "halt_if_type":"bool",
       "halt_if_compare":"is",
       "outputs":2,
       "output_only_on_state_change":true,
       "x":131,
       "y":581,
       "wires":[
          [
             "be38fe16.9d13f"
          ],
          [
 
          ]
       ]
    },
    {
       "id":"be38fe16.9d13f",
       "type":"api-current-state",
       "z":"98bf1f56.6da51",
       "name":"Illuminance",
       "server":"5806b60f.c2e778",
       "version":0,
       "outputs":2,
       "halt_if":"6",
       "halt_if_type":"num",
       "halt_if_compare":"gte",
       "override_topic":false,
       "entity_id":"sensor.hall_motion_3_illuminance",
       "state_type":"num",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"data",
       "override_data":"msg",
       "x":321,
       "y":579,
       "wires":[
          [
             "eb048ad8.8f6688"
          ],
          [
             "f865e99.4b67a18",
             "162f30b1.058e0f"
          ]
       ]
    },
    {
       "id":"f865e99.4b67a18",
       "type":"api-current-state",
       "z":"98bf1f56.6da51",
       "name":"Light on?",
       "server":"5806b60f.c2e778",
       "version":0,
       "outputs":2,
       "halt_if":"false",
       "halt_if_type":"bool",
       "halt_if_compare":"is",
       "override_topic":false,
       "entity_id":"light.hall",
       "state_type":"habool",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"data",
       "override_data":"msg",
       "x":565,
       "y":535,
       "wires":[
          [
             "4db58b2b.54a334"
          ],
          [
 
          ]
       ]
    },
    {
       "id":"4db58b2b.54a334",
       "type":"change",
       "z":"98bf1f56.6da51",
       "name":"hall_light timer: 2.5min",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"150",
             "tot":"json"
          },
          {
             "t":"set",
             "p":"topic",
             "pt":"msg",
             "to":"mqtttimer/hall_light/start",
             "tot":"str"
          },
          {
             "t":"set",
             "p":"responsePayload",
             "pt":"msg",
             "to":"off",
             "tot":"str"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":797.5,
       "y":467,
       "wires":[
          [
             "87287e27.4ed88"
          ]
       ]
    },
    {
       "id":"87287e27.4ed88",
       "type":"subflow:94dca4da.a92a08",
       "z":"98bf1f56.6da51",
       "name":"Start timer",
       "env":[
 
       ],
       "x":1039.5,
       "y":467,
       "wires":[
 
       ]
    },
    {
       "id":"8edcc373.b9603",
       "type":"mqtt in",
       "z":"98bf1f56.6da51",
       "name":"",
       "topic":"mqtttimer/hall_light",
       "qos":"1",
       "datatype":"auto",
       "broker":"ab404be4.584f18",
       "x":787.5,
       "y":530,
       "wires":[
          [
             "edd43eff.7dce8"
          ]
       ]
    },
    {
       "id":"c98f0e6e.4ab44",
       "type":"inject",
       "z":"98bf1f56.6da51",
       "name":"8pm-midnight - Randomise hall lights",
       "topic":"",
       "payload":"",
       "payloadType":"date",
       "repeat":"",
       "crontab":"*/10 20-23 * * *",
       "once":false,
       "onceDelay":0.1,
       "x":454.5,
       "y":304,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"786657f.803f5a8",
       "type":"api-current-state",
       "z":"98bf1f56.6da51",
       "name":"Light on?",
       "server":"5806b60f.c2e778",
       "outputs":2,
       "halt_if":"true",
       "halt_if_type":"bool",
       "halt_if_compare":"is",
       "override_topic":false,
       "entity_id":"light.hall",
       "state_type":"habool",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"data",
       "override_data":"msg",
       "x":701,
       "y":304,
       "wires":[
          [
 
          ],
          [
 
          ]
       ]
    },
    {
       "id":"ce177bd0.0bb518",
       "type":"change",
       "z":"98bf1f56.6da51",
       "name":"hall_light timer",
       "rules":[
          {
             "t":"set",
             "p":"topic",
             "pt":"msg",
             "to":"mqtttimer/hall_light/start",
             "tot":"str"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":1109,
       "y":304,
       "wires":[
          [
             "87287e27.4ed88",
             "9119ece0.dff89"
          ]
       ]
    },
    {
       "id":"8e327eca.45a9b",
       "type":"api-call-service",
       "z":"98bf1f56.6da51",
       "name":"Turn on canopy light",
       "server":"5806b60f.c2e778",
       "version":0,
       "service_domain":"light",
       "service":"turn_on",
       "data":"{\"entity_id\":\"light.canopy_group\",\"brightness\":60,\"transition\":15}",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "x":1121,
       "y":921,
       "wires":[
          [
             "1de2b0e0.de6f4f"
          ]
       ]
    },
    {
       "id":"1de2b0e0.de6f4f",
       "type":"api-call-service",
       "z":"98bf1f56.6da51",
       "name":"Turn on porch light",
       "server":"5806b60f.c2e778",
       "service_domain":"light",
       "service":"turn_on",
       "data":"{\"entity_id\":\"light.porch_group\",\"brightness\":60,\"transition\":15}",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "x":1339,
       "y":921,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"7ebe08cc.e5c128",
       "type":"inject",
       "z":"98bf1f56.6da51",
       "name":"10:30pm",
       "topic":"",
       "payload":"",
       "payloadType":"date",
       "repeat":"",
       "crontab":"30 22 * * *",
       "once":false,
       "onceDelay":0.1,
       "x":158.5,
       "y":1010,
       "wires":[
          [
             "84337193.ebef9"
          ]
       ]
    },
    {
       "id":"986e3476.9915c8",
       "type":"api-call-service",
       "z":"98bf1f56.6da51",
       "name":"Turn off canopy light",
       "server":"5806b60f.c2e778",
       "version":0,
       "service_domain":"light",
       "service":"turn_off",
       "data":"{\"entity_id\":\"light.canopy_group\",\"transition\":15}",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "x":1122,
       "y":866,
       "wires":[
          [
             "c12575b6.125908"
          ]
       ]
    },
    {
       "id":"c12575b6.125908",
       "type":"api-call-service",
       "z":"98bf1f56.6da51",
       "name":"Turn off porch light",
       "server":"5806b60f.c2e778",
       "service_domain":"light",
       "service":"turn_off",
       "data":"{\"entity_id\":\"light.porch_group\",\"transition\":15}",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "x":1338,
       "y":866,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"9119ece0.dff89",
       "type":"api-call-service",
       "z":"98bf1f56.6da51",
       "name":"Turn on hall light",
       "server":"5806b60f.c2e778",
       "service_domain":"light",
       "service":"turn_on",
       "data":"{\"entity_id\":\"light.hall\"}",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "x":1328,
       "y":305,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"43bc8f94.29cfd",
       "type":"server-state-changed",
       "z":"98bf1f56.6da51",
       "name":"Utility motion trigger",
       "server":"5806b60f.c2e778",
       "entityidfilter":"binary_sensor.utility_motion_occupancy",
       "entityidfiltertype":"exact",
       "outputinitially":false,
       "state_type":"habool",
       "haltifstate":"false",
       "halt_if_type":"bool",
       "halt_if_compare":"is",
       "outputs":2,
       "output_only_on_state_change":true,
       "x":432,
       "y":2292,
       "wires":[
          [
 
          ],
          [
 
          ]
       ]
    },
    {
       "id":"45a76dd5.3cc0d4",
       "type":"api-call-service",
       "z":"98bf1f56.6da51",
       "name":"Toggle utility light",
       "server":"5806b60f.c2e778",
       "service_domain":"light",
       "service":"toggle",
       "data":"{\"entity_id\":\"light.utility\"}",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "x":631,
       "y":2290,
       "wires":[
          [
             "ed146aa3.2ed6b8"
          ]
       ]
    },
    {
       "id":"ed146aa3.2ed6b8",
       "type":"delay",
       "z":"98bf1f56.6da51",
       "name":"",
       "pauseType":"delay",
       "timeout":"250",
       "timeoutUnits":"milliseconds",
       "rate":"1",
       "nbRateUnits":"1",
       "rateUnits":"second",
       "randomFirst":"1",
       "randomLast":"5",
       "randomUnits":"seconds",
       "drop":false,
       "x":818,
       "y":2287,
       "wires":[
          [
             "7771db2.882fe24"
          ]
       ]
    },
    {
       "id":"7771db2.882fe24",
       "type":"api-call-service",
       "z":"98bf1f56.6da51",
       "name":"Toggle utility light",
       "server":"5806b60f.c2e778",
       "service_domain":"light",
       "service":"toggle",
       "data":"{\"entity_id\":\"light.utility\"}",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "x":1007,
       "y":2290,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"5f772d7d.df8744",
       "type":"server-state-changed",
       "z":"98bf1f56.6da51",
       "name":"Utility motion trigger",
       "server":"5806b60f.c2e778",
       "entityidfilter":"binary_sensor.utility_motion_occupancy",
       "entityidfiltertype":"exact",
       "outputinitially":false,
       "state_type":"habool",
       "haltifstate":"false",
       "halt_if_type":"bool",
       "halt_if_compare":"is",
       "outputs":2,
       "output_only_on_state_change":true,
       "x":131,
       "y":731,
       "wires":[
          [
             "faef63c6.8f91b"
          ],
          [
 
          ]
       ]
    },
    {
       "id":"faef63c6.8f91b",
       "type":"api-current-state",
       "z":"98bf1f56.6da51",
       "name":"Illuminance",
       "server":"5806b60f.c2e778",
       "outputs":2,
       "halt_if":"16",
       "halt_if_type":"num",
       "halt_if_compare":"gte",
       "override_topic":false,
       "entity_id":"sensor.utility_motion_illuminance",
       "state_type":"num",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"data",
       "override_data":"msg",
       "x":321,
       "y":729,
       "wires":[
          [
             "f30bc5e2.0b0508"
          ],
          [
             "e1bc81b2.e915d"
          ]
       ]
    },
    {
       "id":"f30bc5e2.0b0508",
       "type":"api-call-service",
       "z":"98bf1f56.6da51",
       "name":"Turn on utility light",
       "server":"5806b60f.c2e778",
       "version":0,
       "service_domain":"light",
       "service":"turn_on",
       "data":"{\"entity_id\":\"light.utility_group\"}",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "x":518,
       "y":705,
       "wires":[
          [
             "13ec566e.1a744a"
          ]
       ]
    },
    {
       "id":"e1bc81b2.e915d",
       "type":"api-current-state",
       "z":"98bf1f56.6da51",
       "name":"Light on?",
       "server":"5806b60f.c2e778",
       "outputs":2,
       "halt_if":"false",
       "halt_if_type":"bool",
       "halt_if_compare":"is",
       "override_topic":false,
       "entity_id":"light.utility",
       "state_type":"habool",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"data",
       "override_data":"msg",
       "x":516,
       "y":755,
       "wires":[
          [
             "13ec566e.1a744a"
          ],
          [
 
          ]
       ]
    },
    {
       "id":"13ec566e.1a744a",
       "type":"change",
       "z":"98bf1f56.6da51",
       "name":"utility_light timer: 2.5min",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"150",
             "tot":"json"
          },
          {
             "t":"set",
             "p":"topic",
             "pt":"msg",
             "to":"mqtttimer/utility_light/start",
             "tot":"str"
          },
          {
             "t":"set",
             "p":"responsePayload",
             "pt":"msg",
             "to":"off",
             "tot":"str"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":817,
       "y":679,
       "wires":[
          [
             "f1faedd.7c0c61",
             "42844648.61be88"
          ]
       ]
    },
    {
       "id":"f1faedd.7c0c61",
       "type":"subflow:94dca4da.a92a08",
       "z":"98bf1f56.6da51",
       "name":"Start timer",
       "env":[
 
       ],
       "x":1043,
       "y":679,
       "wires":[
 
       ]
    },
    {
       "id":"32f6b23a.3b6fde",
       "type":"api-call-service",
       "z":"98bf1f56.6da51",
       "name":"Turn off utility light",
       "server":"5806b60f.c2e778",
       "service_domain":"light",
       "service":"turn_off",
       "data":"{\"entity_id\":\"light.utility_group\"}",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "x":1245,
       "y":776,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"e3d3fddc.648bd",
       "type":"mqtt in",
       "z":"98bf1f56.6da51",
       "name":"",
       "topic":"mqtttimer/utility_light",
       "qos":"1",
       "datatype":"auto",
       "broker":"ab404be4.584f18",
       "x":704.5,
       "y":776,
       "wires":[
          [
             "70620d7c.3a2f54"
          ]
       ]
    },
    {
       "id":"f9fc80e6.dc89f",
       "type":"comment",
       "z":"98bf1f56.6da51",
       "name":"Hall lights",
       "info":"",
       "x":74,
       "y":421,
       "wires":[
 
       ]
    },
    {
       "id":"25c319.526a4ce8",
       "type":"comment",
       "z":"98bf1f56.6da51",
       "name":"Utility lights",
       "info":"",
       "x":81,
       "y":675,
       "wires":[
 
       ]
    },
    {
       "id":"217394d2.4a1e1c",
       "type":"change",
       "z":"257e9eaf.a9d202",
       "name":"Set DOOR_CODE to payload",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"{\t   \"taskerVariable\":{\t       \"name\":\"DOOR_CODE\",\t       \"value\":$flowContext(\"door_access_code\", \"file\"),\t       \"devices\":[\"brad\"]\t   }\t}",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":601.0000305175781,
       "y":630.0000019073486,
       "wires":[
          [
             "be65aacf.e1e2e8"
          ]
       ]
    },
    {
       "id":"be65aacf.e1e2e8",
       "type":"subflow:12d32bdb.3c9804",
       "z":"257e9eaf.a9d202",
       "name":"",
       "x":856.0000457763672,
       "y":630.0000019073486,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"ddafd472.c74478",
       "type":"server-state-changed",
       "z":"257e9eaf.a9d202",
       "name":"DOOR_CODE",
       "server":"5806b60f.c2e778",
       "version":1,
       "entityidfilter":"sensor.brad_mobile_tasker_variable_door_code",
       "entityidfiltertype":"exact",
       "outputinitially":false,
       "state_type":"str",
       "haltifstate":"",
       "halt_if_type":"str",
       "halt_if_compare":"is",
       "outputs":1,
       "output_only_on_state_change":false,
       "x":100.00001525878906,
       "y":656.0000038146973,
       "wires":[
          [
             "9ec03763.e0b548"
          ]
       ]
    },
    {
       "id":"4f40b870.148c48",
       "type":"comment",
       "z":"98bf1f56.6da51",
       "name":"Outside front lights",
       "info":"",
       "x":105,
       "y":862,
       "wires":[
 
       ]
    },
    {
       "id":"42844648.61be88",
       "type":"traffic",
       "z":"98bf1f56.6da51",
       "name":"",
       "property_allow":"topic",
       "filter_allow":"mqtttimer/utility_light$",
       "ignore_case_allow":false,
       "negate_allow":false,
       "send_allow":false,
       "property_stop":"topic",
       "filter_stop":"mqtttimer/utility_light/start",
       "ignore_case_stop":false,
       "negate_stop":false,
       "send_stop":false,
       "default_start":false,
       "differ":false,
       "x":1044.5,
       "y":728,
       "wires":[
          [
             "32f6b23a.3b6fde"
          ]
       ]
    },
    {
       "id":"17e814bd.b9f32b",
       "type":"inject",
       "z":"98bf1f56.6da51",
       "name":"every 1.5 minutes",
       "topic":"",
       "payload":"",
       "payloadType":"date",
       "repeat":"90",
       "crontab":"",
       "once":false,
       "onceDelay":0.1,
       "x":839.5,
       "y":728,
       "wires":[
          [
             "42844648.61be88"
          ]
       ]
    },
    {
       "id":"edd43eff.7dce8",
       "type":"switch",
       "z":"98bf1f56.6da51",
       "name":"off?",
       "property":"payload",
       "propertyType":"msg",
       "rules":[
          {
             "t":"eq",
             "v":"off",
             "vt":"str"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":1,
       "x":962.5,
       "y":530,
       "wires":[
          [
             "d900bef7.910d7"
          ]
       ]
    },
    {
       "id":"70620d7c.3a2f54",
       "type":"switch",
       "z":"98bf1f56.6da51",
       "name":"off?",
       "property":"payload",
       "propertyType":"msg",
       "rules":[
          {
             "t":"eq",
             "v":"off",
             "vt":"str"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":1,
       "x":882,
       "y":776,
       "wires":[
          [
             "32f6b23a.3b6fde",
             "42844648.61be88"
          ]
       ]
    },
    {
       "id":"8aa61cfb.3833a",
       "type":"inject",
       "z":"98bf1f56.6da51",
       "name":"every 2.5 minutes",
       "topic":"",
       "payload":"",
       "payloadType":"date",
       "repeat":"150",
       "crontab":"",
       "once":false,
       "onceDelay":0.1,
       "x":128,
       "y":960,
       "wires":[
          [
             "84337193.ebef9"
          ]
       ]
    },
    {
       "id":"84337193.ebef9",
       "type":"api-current-state",
       "z":"98bf1f56.6da51",
       "name":"sun?",
       "server":"5806b60f.c2e778",
       "outputs":2,
       "halt_if":"below_horizon",
       "halt_if_type":"str",
       "halt_if_compare":"is",
       "override_topic":false,
       "entity_id":"sun.sun",
       "state_type":"str",
       "state_location":"",
       "override_payload":"none",
       "entity_location":"data",
       "override_data":"msg",
       "x":353,
       "y":959,
       "wires":[
          [
             "e4568621.78c058"
          ],
          [
             "a1e1aa5a.3c7b58",
             "addab1e8.8ec15"
          ]
       ]
    },
    {
       "id":"addab1e8.8ec15",
       "type":"timecheck",
       "z":"98bf1f56.6da51",
       "name":"",
       "time":"22:30",
       "x":567.5,
       "y":1024,
       "wires":[
          [
             "d8a88d08.cb456",
             "7d0872bf.fa7b0c"
          ],
          [
             "583c0dea.db5804"
          ]
       ]
    },
    {
       "id":"a1e1aa5a.3c7b58",
       "type":"timecheck",
       "z":"98bf1f56.6da51",
       "name":"",
       "time":"09:00",
       "x":568,
       "y":982,
       "wires":[
          [
 
          ],
          [
             "d8a88d08.cb456"
          ]
       ]
    },
    {
       "id":"7d0872bf.fa7b0c",
       "type":"api-call-service",
       "z":"98bf1f56.6da51",
       "name":"Dim sign light",
       "server":"5806b60f.c2e778",
       "service_domain":"light",
       "service":"turn_on",
       "data":"{\"entity_id\":\"light.sign\",\"brightness\":1,\"transition\":15}",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "x":859,
       "y":976,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"e21c93fe.7b26a",
       "type":"switch",
       "z":"98e70926.543948",
       "name":"Topic filter",
       "property":"topic",
       "propertyType":"msg",
       "rules":[
          {
             "t":"regex",
             "v":"zigbee2mqtt/\\w+_((motion)|(door))(_\\d$)?",
             "vt":"str",
             "case":false
          },
          {
             "t":"regex",
             "v":"zigbee2mqtt/\\w+_bulb(_\\d$)?",
             "vt":"str",
             "case":false
          }
       ],
       "checkall":"false",
       "repair":false,
       "outputs":2,
       "x":393,
       "y":631,
       "wires":[
          [
             "2b20f320.21bdac"
          ],
          [
             "3cf13b27.85ea54"
          ]
       ],
       "outputLabels":[
          "motion",
          "bulb"
       ]
    },
    {
       "id":"3cf13b27.85ea54",
       "type":"switch",
       "z":"98e70926.543948",
       "name":"Has state?",
       "property":"payload.state",
       "propertyType":"msg",
       "rules":[
          {
             "t":"nnull"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":1,
       "x":559.5,
       "y":656,
       "wires":[
          [
             "a65980c9.66d2"
          ]
       ]
    },
    {
       "id":"a65980c9.66d2",
       "type":"change",
       "z":"98e70926.543948",
       "name":"Set topic",
       "rules":[
          {
             "t":"set",
             "p":"topic",
             "pt":"msg",
             "to":"topic & '/ha_state'",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":727,
       "y":656,
       "wires":[
          [
             "b0040182.93fae"
          ]
       ]
    },
    {
       "id":"6f9e63c2.ac625c",
       "type":"debug",
       "z":"257e9eaf.a9d202",
       "name":"",
       "active":true,
       "tosidebar":true,
       "console":false,
       "tostatus":false,
       "complete":"true",
       "targetType":"full",
       "x":665.5,
       "y":845,
       "wires":[
 
       ]
    },
    {
       "id":"e6b6519f.8e3f5",
       "type":"inject",
       "z":"257e9eaf.a9d202",
       "name":"",
       "topic":"",
       "payload":"",
       "payloadType":"date",
       "repeat":"",
       "crontab":"",
       "once":false,
       "onceDelay":0.1,
       "x":90.5,
       "y":848,
       "wires":[
          [
             "d4b954c3.e26108"
          ]
       ]
    },
    {
       "id":"a491bece.76dba",
       "type":"http request",
       "z":"257e9eaf.a9d202",
       "name":"login",
       "method":"POST",
       "ret":"obj",
       "paytoqs":false,
       "url":"https://pickmypostcode.com/api/index.php/login/from/main",
       "tls":"",
       "proxy":"",
       "authType":"basic",
       "x":487.5,
       "y":841,
       "wires":[
          [
             "6f9e63c2.ac625c"
          ]
       ]
    },
    {
       "id":"d4b954c3.e26108",
       "type":"change",
       "z":"257e9eaf.a9d202",
       "name":"Set headers & body",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"email=bradley.hopkinson%40live.com&postcode=cv35%200pg",
             "tot":"str"
          },
          {
             "t":"set",
             "p":"headers",
             "pt":"msg",
             "to":"{\"host\":\"pickmypostcode.com\",\"connection\":\"keep-alive\",\"accept\":\"application/json, text/javascript, */*; q=0.01\",\"origin\":\"https://pickmypostcode.com\",\"x-requested-with\":\"XMLHttpRequest\",\"user-agent\":\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36\",\"content-type\":\"application/x-www-form-urlencoded; charset=UTF-8\",\"referer\":\"https://pickmypostcode.com/\",\"accept-encoding\":\"gzip, deflate, br\",\"accept-language\":\"en-GB,en-US;q=0.9,en;q=0.8\"}",
             "tot":"json"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":266.5,
       "y":848,
       "wires":[
          [
             "a491bece.76dba"
          ]
       ]
    },
    {
       "id":"10d93d0e.21a2b3",
       "type":"switch",
       "z":"2837753f.46f60a",
       "name":"Direction",
       "property":"payload.direction",
       "propertyType":"msg",
       "rules":[
          {
             "t":"eq",
             "v":"gate>door",
             "vt":"str"
          }
       ],
       "checkall":"false",
       "repair":false,
       "outputs":1,
       "x":203,
       "y":217,
       "wires":[
          [
             "1f0b2667.4329aa"
          ]
       ],
       "outputLabels":[
          "on:gate>door"
       ]
    },
    {
       "id":"1f0b2667.4329aa",
       "type":"api-call-service",
       "z":"2837753f.46f60a",
       "name":"Canopy bulb 3",
       "server":"5806b60f.c2e778",
       "service_domain":"light",
       "service":"",
       "data":"{\"entity_id\":\"light.canopy_bulb_3\",\"brightness\":255,\"transition\":2}",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "x":406.5,
       "y":217,
       "wires":[
          [
             "75a0ecac.157f14"
          ]
       ]
    },
    {
       "id":"97529dbc.98d96",
       "type":"api-call-service",
       "z":"2837753f.46f60a",
       "name":"Canopy bulb 2",
       "server":"5806b60f.c2e778",
       "service_domain":"light",
       "service":"",
       "data":"{\"entity_id\":\"light.canopy_bulb_2\",\"brightness\":255,\"transition\":2}",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "x":812.5,
       "y":217,
       "wires":[
          [
             "21987578.88d2ba"
          ]
       ]
    },
    {
       "id":"2f41a89a.ac8d08",
       "type":"api-call-service",
       "z":"2837753f.46f60a",
       "name":"Canopy bulb 1",
       "server":"5806b60f.c2e778",
       "service_domain":"light",
       "service":"",
       "data":"{\"entity_id\":\"light.canopy_bulb_1\",\"brightness\":255,\"transition\":2}",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "x":1218.5,
       "y":217,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"75a0ecac.157f14",
       "type":"delay",
       "z":"2837753f.46f60a",
       "name":"",
       "pauseType":"delay",
       "timeout":"250",
       "timeoutUnits":"milliseconds",
       "rate":"1",
       "nbRateUnits":"1",
       "rateUnits":"second",
       "randomFirst":"1",
       "randomLast":"5",
       "randomUnits":"seconds",
       "drop":false,
       "x":608,
       "y":217,
       "wires":[
          [
             "97529dbc.98d96"
          ]
       ]
    },
    {
       "id":"21987578.88d2ba",
       "type":"delay",
       "z":"2837753f.46f60a",
       "name":"",
       "pauseType":"delay",
       "timeout":"250",
       "timeoutUnits":"milliseconds",
       "rate":"1",
       "nbRateUnits":"1",
       "rateUnits":"second",
       "randomFirst":"1",
       "randomLast":"5",
       "randomUnits":"seconds",
       "drop":false,
       "x":1016.5,
       "y":217,
       "wires":[
          [
             "2f41a89a.ac8d08"
          ]
       ]
    },
    {
       "id":"b287f27b.ff7fd",
       "type":"inject",
       "z":"98bf1f56.6da51",
       "name":"",
       "topic":"",
       "payload":"{\"direction\":\"gate>door\",\"service\":\"turn_on\"}",
       "payloadType":"json",
       "repeat":"",
       "crontab":"",
       "once":false,
       "onceDelay":0.1,
       "x":163.5,
       "y":2354,
       "wires":[
          [
             "902c90c2.c56f2"
          ]
       ]
    },
    {
       "id":"902c90c2.c56f2",
       "type":"subflow:2837753f.46f60a",
       "z":"98bf1f56.6da51",
       "name":"",
       "x":371.5,
       "y":2353,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"807f741c.5d0c18",
       "type":"debug",
       "z":"98bf1f56.6da51",
       "name":"",
       "active":true,
       "tosidebar":true,
       "console":false,
       "tostatus":false,
       "complete":"true",
       "targetType":"full",
       "x":271.5,
       "y":2245,
       "wires":[
 
       ]
    },
    {
       "id":"21cc061e.995d0a",
       "type":"server-state-changed",
       "z":"98bf1f56.6da51",
       "name":"Canopy motion trigger",
       "server":"5806b60f.c2e778",
       "entityidfilter":"binary_sensor.canopy_motion_occupancy",
       "entityidfiltertype":"exact",
       "outputinitially":false,
       "state_type":"habool",
       "haltifstate":"false",
       "halt_if_type":"bool",
       "halt_if_compare":"is",
       "outputs":2,
       "output_only_on_state_change":true,
       "x":123,
       "y":1058,
       "wires":[
          [
             "7a255266.e1bb5c"
          ],
          [
 
          ]
       ]
    },
    {
       "id":"7d2e5a9d.a5cdf4",
       "type":"change",
       "z":"98bf1f56.6da51",
       "name":"set payload to turn_on",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"{\"direction\":\"gate>door\",\"service\":\"turn_on\"}",
             "tot":"json"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":578.5,
       "y":1109,
       "wires":[
          [
             "29935eda.82eba2"
          ]
       ]
    },
    {
       "id":"29935eda.82eba2",
       "type":"subflow:2837753f.46f60a",
       "z":"98bf1f56.6da51",
       "name":"Turn on outside lights",
       "env":[
 
       ],
       "x":877.5,
       "y":1109,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"a71f5c91.d8d49",
       "type":"change",
       "z":"98bf1f56.6da51",
       "name":"outside_lights timer: 2.5min",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"150",
             "tot":"json"
          },
          {
             "t":"set",
             "p":"topic",
             "pt":"msg",
             "to":"mqtttimer/outside_lights/start",
             "tot":"str"
          },
          {
             "t":"set",
             "p":"responsePayload",
             "pt":"msg",
             "to":"off",
             "tot":"str"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":598,
       "y":1069,
       "wires":[
          [
             "ab2a9add.bf9df8",
             "d8a88d08.cb456"
          ]
       ]
    },
    {
       "id":"ab2a9add.bf9df8",
       "type":"subflow:94dca4da.a92a08",
       "z":"98bf1f56.6da51",
       "name":"Start timer",
       "env":[
 
       ],
       "x":848,
       "y":1069,
       "wires":[
 
       ]
    },
    {
       "id":"d8a88d08.cb456",
       "type":"traffic",
       "z":"98bf1f56.6da51",
       "name":"",
       "property_allow":"topic",
       "filter_allow":"mqtttimer/outside_lights$",
       "ignore_case_allow":false,
       "negate_allow":false,
       "send_allow":false,
       "property_stop":"topic",
       "filter_stop":"mqtttimer/outside_lights/start",
       "ignore_case_stop":false,
       "negate_stop":false,
       "send_stop":false,
       "default_start":false,
       "differ":false,
       "x":849,
       "y":924,
       "wires":[
          [
             "986e3476.9915c8"
          ]
       ]
    },
    {
       "id":"a4247b76.c07758",
       "type":"mqtt in",
       "z":"98bf1f56.6da51",
       "name":"",
       "topic":"mqtttimer/outside_lights",
       "qos":"1",
       "datatype":"auto",
       "broker":"ab404be4.584f18",
       "x":432,
       "y":873,
       "wires":[
          [
             "34c2eb2c.0d0194"
          ]
       ]
    },
    {
       "id":"34c2eb2c.0d0194",
       "type":"switch",
       "z":"98bf1f56.6da51",
       "name":"off?",
       "property":"payload",
       "propertyType":"msg",
       "rules":[
          {
             "t":"eq",
             "v":"off",
             "vt":"str"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":1,
       "x":602.5,
       "y":873,
       "wires":[
          [
             "d8a88d08.cb456",
             "ba6ebad1.dedfb8"
          ]
       ]
    },
    {
       "id":"ba6ebad1.dedfb8",
       "type":"timecheck",
       "z":"98bf1f56.6da51",
       "name":"",
       "time":"22:30",
       "x":868,
       "y":873,
       "wires":[
          [
             "986e3476.9915c8"
          ],
          [
             "8e327eca.45a9b"
          ]
       ]
    },
    {
       "id":"c62aedef.d95f3",
       "type":"api-call-service",
       "z":"98bf1f56.6da51",
       "name":"Turn on sign light",
       "server":"5806b60f.c2e778",
       "version":0,
       "service_domain":"light",
       "service":"turn_on",
       "data":"{\"entity_id\":\"light.sign\",\"brightness_pct\":75,\"transition\":15}",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "x":1088,
       "y":1023,
       "wires":[
          [
             "8e327eca.45a9b"
          ]
       ]
    },
    {
       "id":"c6e96190.a3277",
       "type":"server-state-changed",
       "z":"98bf1f56.6da51",
       "name":"Sun",
       "server":"5806b60f.c2e778",
       "entityidfilter":"sun.sun",
       "entityidfiltertype":"exact",
       "outputinitially":true,
       "state_type":"str",
       "haltifstate":"",
       "halt_if_type":"str",
       "halt_if_compare":"is",
       "outputs":1,
       "output_only_on_state_change":true,
       "x":164,
       "y":904,
       "wires":[
          [
             "84337193.ebef9"
          ]
       ]
    },
    {
       "id":"f44e984d.7457b8",
       "type":"link out",
       "z":"9943920f.042cc",
       "name":"Recieved PickMyPostcode draw alert email",
       "links":[
          "8369ca3.2be1f38",
          "384f46ab.3c937a"
       ],
       "x":570,
       "y":143,
       "wires":[
 
       ]
    },
    {
       "id":"583c0dea.db5804",
       "type":"timecheck",
       "z":"98bf1f56.6da51",
       "name":"",
       "time":"09:00",
       "x":869,
       "y":1030,
       "wires":[
          [
             "c62aedef.d95f3"
          ],
          [
 
          ]
       ]
    },
    {
       "id":"7a255266.e1bb5c",
       "type":"api-current-state",
       "z":"98bf1f56.6da51",
       "name":"Illuminance",
       "server":"5806b60f.c2e778",
       "outputs":2,
       "halt_if":"12",
       "halt_if_type":"num",
       "halt_if_compare":"gte",
       "override_topic":false,
       "entity_id":"sensor.canopy_motion_illuminance",
       "state_type":"num",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"data",
       "override_data":"msg",
       "x":320,
       "y":1052,
       "wires":[
          [
             "a71f5c91.d8d49",
             "7d2e5a9d.a5cdf4"
          ],
          [
             "7a24e683.1fce28"
          ]
       ]
    },
    {
       "id":"7a24e683.1fce28",
       "type":"api-current-state",
       "z":"98bf1f56.6da51",
       "name":"Light on?",
       "server":"5806b60f.c2e778",
       "outputs":2,
       "halt_if":"false",
       "halt_if_type":"bool",
       "halt_if_compare":"is",
       "override_topic":false,
       "entity_id":"light.canopy",
       "state_type":"habool",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"data",
       "override_data":"msg",
       "x":343,
       "y":1116,
       "wires":[
          [
             "a71f5c91.d8d49",
             "7d2e5a9d.a5cdf4"
          ],
          [
 
          ]
       ]
    },
    {
       "id":"4a7f5d59.9ab9e4",
       "type":"server-state-changed",
       "z":"98bf1f56.6da51",
       "name":"Cloakroom Light Switch",
       "server":"5806b60f.c2e778",
       "entityidfilter":"binary_sensor.cloakroom_light_switch",
       "entityidfiltertype":"exact",
       "outputinitially":false,
       "state_type":"habool",
       "haltifstate":"",
       "halt_if_type":"str",
       "halt_if_compare":"is",
       "outputs":1,
       "output_only_on_state_change":true,
       "x":335,
       "y":1246,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"419adaa2.312ff4",
       "type":"api-call-service",
       "z":"98bf1f56.6da51",
       "name":"Turn on cloakroom light",
       "server":"5806b60f.c2e778",
       "service_domain":"light",
       "service":"turn_on",
       "data":"{\"entity_id\":\"light.cloakroom\"}",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "x":593,
       "y":1246,
       "wires":[
          [
             "4bebff83.c7517"
          ]
       ]
    },
    {
       "id":"4bebff83.c7517",
       "type":"change",
       "z":"98bf1f56.6da51",
       "name":"cloakroom_light timer: 2.5min",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"150",
             "tot":"json"
          },
          {
             "t":"set",
             "p":"topic",
             "pt":"msg",
             "to":"mqtttimer/cloakroom_light/start",
             "tot":"str"
          },
          {
             "t":"set",
             "p":"responsePayload",
             "pt":"msg",
             "to":"off",
             "tot":"str"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":862.5,
       "y":1306,
       "wires":[
          [
             "1ef89e7e.1d25c2"
          ]
       ]
    },
    {
       "id":"1ef89e7e.1d25c2",
       "type":"subflow:94dca4da.a92a08",
       "z":"98bf1f56.6da51",
       "name":"Start timer",
       "env":[
 
       ],
       "x":1084.5,
       "y":1306,
       "wires":[
 
       ]
    },
    {
       "id":"91132fa1.3fea5",
       "type":"mqtt in",
       "z":"98bf1f56.6da51",
       "name":"",
       "topic":"mqtttimer/cloakroom_light",
       "qos":"1",
       "datatype":"auto",
       "broker":"ab404be4.584f18",
       "x":852.5,
       "y":1246,
       "wires":[
          [
             "b1435273.7c8d6"
          ]
       ]
    },
    {
       "id":"b1435273.7c8d6",
       "type":"switch",
       "z":"98bf1f56.6da51",
       "name":"off?",
       "property":"payload",
       "propertyType":"msg",
       "rules":[
          {
             "t":"eq",
             "v":"off",
             "vt":"str"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":1,
       "x":1067.5,
       "y":1246,
       "wires":[
          [
             "b25f7fb8.7e55d"
          ]
       ]
    },
    {
       "id":"b25f7fb8.7e55d",
       "type":"api-call-service",
       "z":"98bf1f56.6da51",
       "name":"Turn off cloakroom light",
       "server":"5806b60f.c2e778",
       "version":0,
       "service_domain":"light",
       "service":"turn_off",
       "data":"{\"entity_id\":\"light.cloakroom\"}",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "x":1263,
       "y":1246,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"25fe18b4.196e08",
       "type":"comment",
       "z":"98bf1f56.6da51",
       "name":"Cloakroom light",
       "info":"",
       "x":115,
       "y":1230,
       "wires":[
 
       ]
    },
    {
       "id":"126eb0e0.d78b2f",
       "type":"inject",
       "z":"257e9eaf.a9d202",
       "name":"",
       "topic":"",
       "payload":"",
       "payloadType":"date",
       "repeat":"",
       "crontab":"",
       "once":false,
       "onceDelay":0.1,
       "x":292.5,
       "y":120,
       "wires":[
          [
             "5f18f13a.52f1"
          ]
       ]
    },
    {
       "id":"2f017935.cf1bf6",
       "type":"inject",
       "z":"257e9eaf.a9d202",
       "name":"",
       "topic":"",
       "payload":"",
       "payloadType":"date",
       "repeat":"",
       "crontab":"",
       "once":false,
       "onceDelay":0.1,
       "x":311.5,
       "y":326,
       "wires":[
          [
             "6820f743.d91ec8"
          ]
       ]
    },
    {
       "id":"43124ff0.b9378",
       "type":"server-state-changed",
       "z":"98bf1f56.6da51",
       "name":"Cloakroom motion trigger",
       "server":"5806b60f.c2e778",
       "version":0,
       "entityidfilter":"binary_sensor.cloakroom_motion_occupancy",
       "entityidfiltertype":"exact",
       "outputinitially":false,
       "state_type":"habool",
       "haltifstate":"false",
       "halt_if_type":"bool",
       "halt_if_compare":"is",
       "outputs":2,
       "output_only_on_state_change":true,
       "x":155,
       "y":1307,
       "wires":[
          [
 
          ],
          [
 
          ]
       ]
    },
    {
       "id":"9ad2e14b.52a25",
       "type":"api-current-state",
       "z":"98bf1f56.6da51",
       "name":"Illuminance",
       "server":"5806b60f.c2e778",
       "outputs":2,
       "halt_if":"16",
       "halt_if_type":"num",
       "halt_if_compare":"gte",
       "override_topic":false,
       "entity_id":"sensor.cloakroom_motion_illuminance",
       "state_type":"num",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"data",
       "override_data":"msg",
       "x":365,
       "y":1307,
       "wires":[
          [
             "419adaa2.312ff4"
          ],
          [
             "c38d93e2.5d97b"
          ]
       ]
    },
    {
       "id":"c38d93e2.5d97b",
       "type":"api-current-state",
       "z":"98bf1f56.6da51",
       "name":"Light on?",
       "server":"5806b60f.c2e778",
       "outputs":2,
       "halt_if":"false",
       "halt_if_type":"bool",
       "halt_if_compare":"is",
       "override_topic":false,
       "entity_id":"light.cloakroom",
       "state_type":"habool",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"data",
       "override_data":"msg",
       "x":586,
       "y":1313,
       "wires":[
          [
             "4bebff83.c7517"
          ],
          [
 
          ]
       ]
    },
    {
       "id":"f42d8bcc.b25ec8",
       "type":"comment",
       "z":"7bb31cb3.9db904",
       "name":"PickMyPostcode",
       "info":"",
       "x":105,
       "y":56,
       "wires":[
 
       ]
    },
    {
       "id":"384f46ab.3c937a",
       "type":"link in",
       "z":"7bb31cb3.9db904",
       "name":"Process PickMyPostcode draw alert email",
       "links":[
          "f44e984d.7457b8"
       ],
       "x":61,
       "y":104,
       "wires":[
          [
             "a522d2da.7cee4"
          ]
       ]
    },
    {
       "id":"a522d2da.7cee4",
       "type":"change",
       "z":"7bb31cb3.9db904",
       "name":"Extract login url",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"$match(payload, /https:\\/\\/\\S+login\\S+\\b/).match",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":201.5,
       "y":104,
       "wires":[
          [
             "9651b3da.26092"
          ]
       ]
    },
    {
       "id":"9651b3da.26092",
       "type":"switch",
       "z":"7bb31cb3.9db904",
       "name":"Not null?",
       "property":"payload",
       "propertyType":"msg",
       "rules":[
          {
             "t":"nnull"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":1,
       "x":383.5,
       "y":104,
       "wires":[
          [
             "a7f1dff4.0fa61"
          ]
       ]
    },
    {
       "id":"fc62de78.58dab",
       "type":"inject",
       "z":"7bb31cb3.9db904",
       "name":"Main draw - 12:00",
       "topic":"https://pickmypostcode.com/",
       "payload":"",
       "payloadType":"date",
       "repeat":"",
       "crontab":"00 12 * * *",
       "once":false,
       "onceDelay":0.1,
       "x":170,
       "y":200,
       "wires":[
          [
             "4f5ba2c7.0c0d2c"
          ]
       ]
    },
    {
       "id":"83abcf82.d415e",
       "type":"inject",
       "z":"7bb31cb3.9db904",
       "name":"Video draw - 12:15",
       "topic":"https://pickmypostcode.com/video",
       "payload":"",
       "payloadType":"date",
       "repeat":"",
       "crontab":"15 12 * * *",
       "once":false,
       "onceDelay":0.1,
       "x":160,
       "y":240,
       "wires":[
          [
             "4f5ba2c7.0c0d2c"
          ]
       ]
    },
    {
       "id":"86c54ad0.9b72d8",
       "type":"inject",
       "z":"7bb31cb3.9db904",
       "name":"Survey draw - 12:30",
       "topic":"https://pickmypostcode.com/survey-draw",
       "payload":"",
       "payloadType":"date",
       "repeat":"",
       "crontab":"30 12 * * *",
       "once":false,
       "onceDelay":0.1,
       "x":160,
       "y":280,
       "wires":[
          [
             "4f5ba2c7.0c0d2c"
          ]
       ]
    },
    {
       "id":"2c4587a7.792f88",
       "type":"inject",
       "z":"7bb31cb3.9db904",
       "name":"Stackpot draw - 09:00",
       "topic":"https://pickmypostcode.com/stackpot",
       "payload":"",
       "payloadType":"date",
       "repeat":"",
       "crontab":"00 09 * * *",
       "once":false,
       "onceDelay":0.1,
       "x":150,
       "y":320,
       "wires":[
          [
             "4f5ba2c7.0c0d2c"
          ]
       ]
    },
    {
       "id":"5f0dffb2.19468",
       "type":"inject",
       "z":"7bb31cb3.9db904",
       "name":"Stackpot draw - 21:00",
       "topic":"https://pickmypostcode.com/stackpot",
       "payload":"",
       "payloadType":"date",
       "repeat":"",
       "crontab":"00 21 * * *",
       "once":false,
       "onceDelay":0.1,
       "x":150,
       "y":360,
       "wires":[
          [
             "4f5ba2c7.0c0d2c"
          ]
       ]
    },
    {
       "id":"620e59a3.991038",
       "type":"inject",
       "z":"7bb31cb3.9db904",
       "name":"Bonus draw - 12:45",
       "topic":"https://pickmypostcode.com/your-bonus",
       "payload":"",
       "payloadType":"date",
       "repeat":"",
       "crontab":"45 12 * * *",
       "once":false,
       "onceDelay":0.1,
       "x":160,
       "y":400,
       "wires":[
          [
             "4f5ba2c7.0c0d2c"
          ]
       ]
    },
    {
       "id":"8634be8c.a1a63",
       "type":"inject",
       "z":"7bb31cb3.9db904",
       "name":"Mini draw - 18:00",
       "topic":"https://pickmypostcode.com",
       "payload":"",
       "payloadType":"date",
       "repeat":"",
       "crontab":"00 18 * * *",
       "once":false,
       "onceDelay":0.1,
       "x":170,
       "y":440,
       "wires":[
          [
             "4f5ba2c7.0c0d2c"
          ]
       ]
    },
    {
       "id":"4f5ba2c7.0c0d2c",
       "type":"random",
       "z":"7bb31cb3.9db904",
       "name":"Random time - 1min to 10mins",
       "low":"60",
       "high":"600",
       "inte":"true",
       "property":"payload",
       "x":470,
       "y":320,
       "wires":[
          [
             "830232f9.17ecb"
          ]
       ]
    },
    {
       "id":"303a0b2e.6597b4",
       "type":"subflow:94dca4da.a92a08",
       "z":"7bb31cb3.9db904",
       "name":"",
       "x":890,
       "y":320,
       "wires":[
 
       ]
    },
    {
       "id":"830232f9.17ecb",
       "type":"change",
       "z":"7bb31cb3.9db904",
       "name":"set timer",
       "rules":[
          {
             "t":"set",
             "p":"responsePayload",
             "pt":"msg",
             "to":"topic",
             "tot":"msg"
          },
          {
             "t":"set",
             "p":"topic",
             "pt":"msg",
             "to":"mqtttimer/pickmypostcode/start",
             "tot":"str"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":700,
       "y":320,
       "wires":[
          [
             "303a0b2e.6597b4"
          ]
       ]
    },
    {
       "id":"38e1069.7014ffa",
       "type":"mqtt in",
       "z":"7bb31cb3.9db904",
       "name":"",
       "topic":"mqtttimer/pickmypostcode",
       "qos":"1",
       "datatype":"auto",
       "broker":"ab404be4.584f18",
       "x":121,
       "y":520,
       "wires":[
          [
             "b2c23f74.f9858"
          ]
       ]
    },
    {
       "id":"b2c23f74.f9858",
       "type":"switch",
       "z":"7bb31cb3.9db904",
       "name":"has value?",
       "property":"payload",
       "propertyType":"msg",
       "rules":[
          {
             "t":"cont",
             "v":"pickmypostcode",
             "vt":"str"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":1,
       "x":321,
       "y":520,
       "wires":[
          [
             "a991e555.5289f8",
             "280f7dc8.7b6ad2"
          ]
       ]
    },
    {
       "id":"a7f1dff4.0fa61",
       "type":"key-value-write",
       "z":"7bb31cb3.9db904",
       "store":"94e0b6b5.722ed8",
       "action":"set",
       "key":"pickmypostcode_emailloginurl",
       "keyvalue":"",
       "name":"Store URL",
       "x":557,
       "y":104,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"3dc821e9.3d7c0e",
       "type":"key-value-read",
       "z":"7bb31cb3.9db904",
       "store":"94e0b6b5.722ed8",
       "key":"pickmypostcode_emailloginurl",
       "name":"Get URL",
       "x":640,
       "y":520,
       "wires":[
          [
             "25f72e48.b84762"
          ]
       ]
    },
    {
       "id":"c65b02f2.3c1c9",
       "type":"http request",
       "z":"7bb31cb3.9db904",
       "name":"",
       "method":"POST",
       "ret":"obj",
       "paytoqs":false,
       "url":"http://orchardhouse-functions/api/pick-my-postcode/visit-draw",
       "tls":"",
       "proxy":"",
       "authType":"",
       "x":970,
       "y":520,
       "wires":[
          [
             "d50ccee9.57392"
          ]
       ]
    },
    {
       "id":"25f72e48.b84762",
       "type":"change",
       "z":"7bb31cb3.9db904",
       "name":"Prepare request",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"{\t    \"EmailLoginUrl\": payload,\t    \"DrawUrl\": drawurl\t}",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":800,
       "y":520,
       "wires":[
          [
             "c65b02f2.3c1c9"
          ]
       ]
    },
    {
       "id":"a991e555.5289f8",
       "type":"change",
       "z":"7bb31cb3.9db904",
       "name":"Get draw url",
       "rules":[
          {
             "t":"set",
             "p":"drawurl",
             "pt":"msg",
             "to":"payload",
             "tot":"msg"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":490,
       "y":520,
       "wires":[
          [
             "3dc821e9.3d7c0e"
          ]
       ]
    },
    {
       "id":"d50ccee9.57392",
       "type":"switch",
       "z":"7bb31cb3.9db904",
       "name":"StatusCode",
       "property":"statusCode",
       "propertyType":"msg",
       "rules":[
          {
             "t":"eq",
             "v":"200",
             "vt":"str"
          },
          {
             "t":"else"
          }
       ],
       "checkall":"false",
       "repair":false,
       "outputs":2,
       "x":1130,
       "y":520,
       "wires":[
          [
             "46a5993b.9d98b8",
             "bd705308.302f5",
             "da359c33.27b8f",
             "1a6bc7ae.4deb08",
             "7200e2ff.8c4f0c",
             "b3f513c1.e365b",
             "6beb1baa.de57e4",
             "2d5882ba.222c9e",
             "20f5cb74.235224"
          ],
          [
 
          ]
       ],
       "outputLabels":[
          "200",
          "Other"
       ]
    },
    {
       "id":"711d3959.7d88b8",
       "type":"mqtt out",
       "z":"7bb31cb3.9db904",
       "name":"",
       "topic":"pickmypostcode/userinfo",
       "qos":"1",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":1707,
       "y":193,
       "wires":[
 
       ]
    },
    {
       "id":"46a5993b.9d98b8",
       "type":"change",
       "z":"7bb31cb3.9db904",
       "name":"userInfo",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"payload.userInfo",
             "tot":"msg"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":1334,
       "y":193,
       "wires":[
          [
             "3e704821.0ffbc8"
          ]
       ]
    },
    {
       "id":"bd705308.302f5",
       "type":"change",
       "z":"7bb31cb3.9db904",
       "name":"survey",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"payload.drawResult.survey",
             "tot":"msg"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":1324,
       "y":273,
       "wires":[
          [
             "676b547b.7c359c"
          ]
       ]
    },
    {
       "id":"da359c33.27b8f",
       "type":"change",
       "z":"7bb31cb3.9db904",
       "name":"video",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"payload.drawResult.video",
             "tot":"msg"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":1324,
       "y":313,
       "wires":[
          [
             "a0b02b1e.f2a218"
          ]
       ]
    },
    {
       "id":"1a6bc7ae.4deb08",
       "type":"change",
       "z":"7bb31cb3.9db904",
       "name":"stackpot",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"payload.drawResult.stackpot",
             "tot":"msg"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":1334,
       "y":353,
       "wires":[
          [
             "d17a7667.39c5e8"
          ]
       ]
    },
    {
       "id":"7200e2ff.8c4f0c",
       "type":"change",
       "z":"7bb31cb3.9db904",
       "name":"bonus five",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"payload.drawResult.bonus.five",
             "tot":"msg"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":1344,
       "y":393,
       "wires":[
          [
             "bb2a8131.bac22"
          ]
       ]
    },
    {
       "id":"b3f513c1.e365b",
       "type":"change",
       "z":"7bb31cb3.9db904",
       "name":"bonus ten",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"payload.drawResult.bonus.ten",
             "tot":"msg"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":1334,
       "y":433,
       "wires":[
          [
             "34b806ac.16554a"
          ]
       ]
    },
    {
       "id":"6beb1baa.de57e4",
       "type":"change",
       "z":"7bb31cb3.9db904",
       "name":"bonus twenty",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"payload.drawResult.bonus.twenty",
             "tot":"msg"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":1344,
       "y":473,
       "wires":[
          [
             "7f5500a6.9105f"
          ]
       ]
    },
    {
       "id":"2d5882ba.222c9e",
       "type":"change",
       "z":"7bb31cb3.9db904",
       "name":"mini",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"payload.drawResult.mini",
             "tot":"msg"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":1324,
       "y":513,
       "wires":[
          [
             "5d83c059.2b75b"
          ]
       ]
    },
    {
       "id":"676b547b.7c359c",
       "type":"mqtt out",
       "z":"7bb31cb3.9db904",
       "name":"",
       "topic":"pickmypostcode/drawresult/survey",
       "qos":"1",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":1567,
       "y":273,
       "wires":[
 
       ]
    },
    {
       "id":"b27bec4d.ab1fb",
       "type":"mqtt out",
       "z":"7bb31cb3.9db904",
       "name":"",
       "topic":"pickmypostcode/drawresult/main",
       "qos":"1",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":1557,
       "y":233,
       "wires":[
 
       ]
    },
    {
       "id":"a0b02b1e.f2a218",
       "type":"mqtt out",
       "z":"7bb31cb3.9db904",
       "name":"",
       "topic":"pickmypostcode/drawresult/video",
       "qos":"1",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":1567,
       "y":313,
       "wires":[
 
       ]
    },
    {
       "id":"d17a7667.39c5e8",
       "type":"mqtt out",
       "z":"7bb31cb3.9db904",
       "name":"",
       "topic":"pickmypostcode/drawresult/stackpot",
       "qos":"1",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":1577,
       "y":353,
       "wires":[
 
       ]
    },
    {
       "id":"bb2a8131.bac22",
       "type":"mqtt out",
       "z":"7bb31cb3.9db904",
       "name":"",
       "topic":"pickmypostcode/drawresult/bonus/five",
       "qos":"1",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":1577,
       "y":393,
       "wires":[
 
       ]
    },
    {
       "id":"34b806ac.16554a",
       "type":"mqtt out",
       "z":"7bb31cb3.9db904",
       "name":"",
       "topic":"pickmypostcode/drawresult/bonus/ten",
       "qos":"1",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":1577,
       "y":433,
       "wires":[
 
       ]
    },
    {
       "id":"7f5500a6.9105f",
       "type":"mqtt out",
       "z":"7bb31cb3.9db904",
       "name":"",
       "topic":"pickmypostcode/drawresult/bonus/twenty",
       "qos":"1",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":1587,
       "y":473,
       "wires":[
 
       ]
    },
    {
       "id":"5d83c059.2b75b",
       "type":"mqtt out",
       "z":"7bb31cb3.9db904",
       "name":"",
       "topic":"pickmypostcode/drawresult/mini",
       "qos":"1",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":1557,
       "y":513,
       "wires":[
 
       ]
    },
    {
       "id":"cff616bf.5ae1b8",
       "type":"mqtt in",
       "z":"7bb31cb3.9db904",
       "name":"",
       "topic":"pickmypostcode/drawresult/#",
       "qos":"1",
       "datatype":"auto",
       "broker":"ab404be4.584f18",
       "x":129,
       "y":620,
       "wires":[
          [
             "92cebff6.0d1f8"
          ]
       ]
    },
    {
       "id":"81ec40bd.7232d",
       "type":"json",
       "z":"7bb31cb3.9db904",
       "name":"",
       "property":"payload",
       "action":"",
       "pretty":false,
       "x":510,
       "y":655,
       "wires":[
          [
             "61b1d17c.79806"
          ]
       ]
    },
    {
       "id":"b7cb10be.0ff28",
       "type":"mqtt out",
       "z":"7bb31cb3.9db904",
       "name":"pickymypostcode/drawresult/{draw}/winner",
       "topic":"",
       "qos":"1",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":1252,
       "y":634,
       "wires":[
 
       ]
    },
    {
       "id":"b52cd9a4.e00ed8",
       "type":"change",
       "z":"7bb31cb3.9db904",
       "name":"get topic and winner status",
       "rules":[
          {
             "t":"set",
             "p":"topic",
             "pt":"msg",
             "to":"topic & '/winner'",
             "tot":"jsonata"
          },
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"postcode in payload.result[]",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":902,
       "y":634,
       "wires":[
          [
             "b7cb10be.0ff28"
          ]
       ]
    },
    {
       "id":"61b1d17c.79806",
       "type":"api-current-state",
       "z":"7bb31cb3.9db904",
       "name":"Get postcode",
       "server":"5806b60f.c2e778",
       "version":1,
       "outputs":2,
       "halt_if":"unknown",
       "halt_if_type":"str",
       "halt_if_compare":"is_not",
       "override_topic":false,
       "entity_id":"sensor.pickmypostcode_postcode",
       "state_type":"str",
       "state_location":"postcode",
       "override_payload":"msg",
       "entity_location":"",
       "override_data":"none",
       "blockInputOverrides":false,
       "x":670,
       "y":655,
       "wires":[
          [
             "b52cd9a4.e00ed8"
          ],
          [
             "d8b82d1f.bd8a2"
          ]
       ],
       "outputLabels":[
          "has value",
          "unknown"
       ]
    },
    {
       "id":"28b9e50f.54056a",
       "type":"switch",
       "z":"7bb31cb3.9db904",
       "name":"winner?",
       "property":"payload",
       "propertyType":"msg",
       "rules":[
          {
             "t":"eq",
             "v":"true",
             "vt":"str"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":1,
       "x":521,
       "y":586,
       "wires":[
          [
             "85a3232.54278e"
          ]
       ]
    },
    {
       "id":"92cebff6.0d1f8",
       "type":"switch",
       "z":"7bb31cb3.9db904",
       "name":"check topic",
       "property":"topic",
       "propertyType":"msg",
       "rules":[
          {
             "t":"cont",
             "v":"winner",
             "vt":"str"
          },
          {
             "t":"else"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":2,
       "x":359,
       "y":620,
       "wires":[
          [
             "28b9e50f.54056a"
          ],
          [
             "81ec40bd.7232d"
          ]
       ],
       "outputLabels":[
          "winner",
          "otherwise"
       ]
    },
    {
       "id":"4d87f5ec.38a7ec",
       "type":"subflow:8f5573e3.e52df",
       "z":"7bb31cb3.9db904",
       "name":"",
       "x":921,
       "y":586,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"85a3232.54278e",
       "type":"change",
       "z":"7bb31cb3.9db904",
       "name":"Set winner message",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"(\t   $firstCharacter := $match(topic, /(\\b\\w)/)[2].match;\t   $remainingCharacters := $match(topic, /(\\B\\w+)/)[2].match;\t   $draw := $uppercase($firstCharacter) & $remainingCharacters;\t   {\t       \"autoremote\":{\t           \"notification\":{\t               \"id\": $notificationId,\t               \"title\":\"Pick My Postcode\",\t               \"text\": $draw & \" draw winner!\",\t               \"icon\":\"https://s3-eu-west-1.amazonaws.com/tpd/logos/5af2edeab6444c00016275df/0x0.png\",\t               \"priority\": 2,\t               \"url\": \"https://pickmypostcode.com/\"\t           },\t           \"devices\":[\"brad\"]\t       }\t   }\t)",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":714,
       "y":586,
       "wires":[
          [
             "4d87f5ec.38a7ec"
          ]
       ]
    },
    {
       "id":"3e704821.0ffbc8",
       "type":"switch",
       "z":"7bb31cb3.9db904",
       "name":"logged in?",
       "property":"payload.user.data.loggedIn",
       "propertyType":"msg",
       "rules":[
          {
             "t":"true"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":1,
       "x":1497.5,
       "y":193,
       "wires":[
          [
             "711d3959.7d88b8"
          ]
       ]
    },
    {
       "id":"b906bea9.384dd",
       "type":"mqtt out",
       "z":"7bb31cb3.9db904",
       "name":"mqtttimer/pickmypostcode",
       "topic":"mqtttimer/pickmypostcode",
       "qos":"1",
       "retain":"true",
       "broker":"ab404be4.584f18",
       "x":878.5,
       "y":472,
       "wires":[
 
       ]
    },
    {
       "id":"280f7dc8.7b6ad2",
       "type":"change",
       "z":"7bb31cb3.9db904",
       "name":"Clear payload (to stop repeated checks)",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"",
             "tot":"str"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":580.5,
       "y":472,
       "wires":[
          [
             "b906bea9.384dd"
          ]
       ]
    },
    {
       "id":"62b6f2ec.e151dc",
       "type":"comment",
       "z":"98e70926.543948",
       "name":"Pickmypostcode",
       "info":"",
       "x":770,
       "y":374,
       "wires":[
 
       ]
    },
    {
       "id":"5a4cc5b0.aec0cc",
       "type":"link in",
       "z":"98e70926.543948",
       "name":"HASS online pickmypostcode update",
       "links":[
          "fe37facc.60fd58"
       ],
       "x":871,
       "y":373,
       "wires":[
          [
             "afe4d4b6.b99d08"
          ]
       ]
    },
    {
       "id":"afe4d4b6.b99d08",
       "type":"link out",
       "z":"98e70926.543948",
       "name":"Pickmypostcode update",
       "links":[
          "bce6c365.10e8a",
          "cd2c8ca4.2899"
       ],
       "x":928.5,
       "y":373,
       "wires":[
 
       ]
    },
    {
       "id":"4ffec28.c69ba3c",
       "type":"key-value-read",
       "z":"7bb31cb3.9db904",
       "store":"94e0b6b5.722ed8",
       "key":"pickmypostcode_emailloginurl",
       "name":"Get URL",
       "x":548,
       "y":144,
       "wires":[
          [
             "8516942b.104fc8"
          ]
       ]
    },
    {
       "id":"4ca96737.5d3e18",
       "type":"inject",
       "z":"7bb31cb3.9db904",
       "name":"",
       "topic":"",
       "payload":"",
       "payloadType":"date",
       "repeat":"",
       "crontab":"",
       "once":false,
       "onceDelay":0.1,
       "x":383.5,
       "y":144,
       "wires":[
          [
             "4ffec28.c69ba3c"
          ]
       ]
    },
    {
       "id":"8516942b.104fc8",
       "type":"debug",
       "z":"7bb31cb3.9db904",
       "name":"",
       "active":true,
       "tosidebar":true,
       "console":false,
       "tostatus":false,
       "complete":"payload",
       "targetType":"msg",
       "x":713.5,
       "y":144,
       "wires":[
 
       ]
    },
    {
       "id":"d8b82d1f.bd8a2",
       "type":"link out",
       "z":"7bb31cb3.9db904",
       "name":"Pickmypostcode update",
       "links":[
          "bce6c365.10e8a",
          "cd2c8ca4.2899"
       ],
       "x":891.5,
       "y":678,
       "wires":[
 
       ],
       "l":true
    },
    {
       "id":"cd2c8ca4.2899",
       "type":"link in",
       "z":"7bb31cb3.9db904",
       "name":"Pickmypostcode update",
       "links":[
          "afe4d4b6.b99d08",
          "d8b82d1f.bd8a2"
       ],
       "x":440,
       "y":261,
       "wires":[
          [
             "c425005c.a4ba8"
          ]
       ],
       "l":true
    },
    {
       "id":"c425005c.a4ba8",
       "type":"change",
       "z":"7bb31cb3.9db904",
       "name":"10s",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"10",
             "tot":"num"
          },
          {
             "t":"set",
             "p":"topic",
             "pt":"msg",
             "to":"https://pickmypostcode.com",
             "tot":"str"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":616.5,
       "y":261,
       "wires":[
          [
             "830232f9.17ecb"
          ]
       ]
    },
    {
       "id":"4ab3a577.fe35cc",
       "type":"inject",
       "z":"7bb31cb3.9db904",
       "name":"",
       "topic":"",
       "payload":"",
       "payloadType":"date",
       "repeat":"",
       "crontab":"",
       "once":false,
       "onceDelay":0.1,
       "x":477,
       "y":215,
       "wires":[
          [
             "c425005c.a4ba8"
          ]
       ]
    },
    {
       "id":"4b03010b.6fb63",
       "type":"inject",
       "z":"7bb31cb3.9db904",
       "name":"Healthcheck - every 1 hour",
       "topic":"",
       "payload":"",
       "payloadType":"date",
       "repeat":"3600",
       "crontab":"",
       "once":true,
       "onceDelay":"60",
       "x":148.5,
       "y":722,
       "wires":[
          [
             "eb38e9e8.79bb38",
             "1ca100ea.87553f",
             "9c13dc6e.02a82",
             "3975373f.9d60f8",
             "38172c80.e28ca4",
             "19ca583c.8bb848",
             "7a209d53.35b3b4",
             "b0d3c0d6.22497",
             "dae40e7d.37cbe"
          ]
       ]
    },
    {
       "id":"eb38e9e8.79bb38",
       "type":"api-current-state",
       "z":"7bb31cb3.9db904",
       "name":"Get postcode",
       "server":"5806b60f.c2e778",
       "version":1,
       "outputs":2,
       "halt_if":"unknown",
       "halt_if_type":"str",
       "halt_if_compare":"is_not",
       "override_topic":false,
       "entity_id":"sensor.pickmypostcode_postcode",
       "state_type":"str",
       "state_location":"postcode",
       "override_payload":"msg",
       "entity_location":"",
       "override_data":"none",
       "blockInputOverrides":false,
       "x":421,
       "y":722,
       "wires":[
          [
 
          ],
          [
             "6b801e3b.929d1"
          ]
       ],
       "outputLabels":[
          "has value",
          "unknown"
       ]
    },
    {
       "id":"84279e11.145ae",
       "type":"join",
       "z":"7bb31cb3.9db904",
       "name":"",
       "mode":"custom",
       "build":"string",
       "property":"payload",
       "propertyType":"msg",
       "key":"topic",
       "joiner":"\\n",
       "joinerType":"str",
       "accumulate":false,
       "timeout":"2",
       "count":"",
       "reduceRight":false,
       "reduceExp":"",
       "reduceInit":"",
       "reduceInitType":"num",
       "reduceFixup":"",
       "x":1948.5,
       "y":720,
       "wires":[
          [
             "5d96969d.0606c8"
          ]
       ]
    },
    {
       "id":"6b801e3b.929d1",
       "type":"change",
       "z":"7bb31cb3.9db904",
       "name":"",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"Postcode not set",
             "tot":"str"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":607.5,
       "y":719,
       "wires":[
          [
             "84279e11.145ae"
          ]
       ]
    },
    {
       "id":"3add1506.1b17aa",
       "type":"api-current-state",
       "z":"7bb31cb3.9db904",
       "name":"Main last visited",
       "server":"5806b60f.c2e778",
       "version":1,
       "outputs":1,
       "halt_if":"",
       "halt_if_type":"str",
       "halt_if_compare":"is_not",
       "override_topic":false,
       "entity_id":"sensor.pickmypostcode_main_last_visited",
       "state_type":"str",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"",
       "override_data":"none",
       "blockInputOverrides":false,
       "x":656,
       "y":777,
       "wires":[
          [
             "6e33b5e3.2518dc"
          ]
       ],
       "outputLabels":[
          "has value"
       ]
    },
    {
       "id":"1ca100ea.87553f",
       "type":"change",
       "z":"7bb31cb3.9db904",
       "name":"Main",
       "rules":[
          {
             "t":"set",
             "p":"topic",
             "pt":"msg",
             "to":"Main",
             "tot":"str"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":401.5,
       "y":800,
       "wires":[
          [
             "3add1506.1b17aa",
             "5927ca9a.a54994"
          ]
       ]
    },
    {
       "id":"9c13dc6e.02a82",
       "type":"change",
       "z":"7bb31cb3.9db904",
       "name":"Survey",
       "rules":[
          {
             "t":"set",
             "p":"topic",
             "pt":"msg",
             "to":"Survey",
             "tot":"str"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":411,
       "y":894,
       "wires":[
          [
             "8a5b8f8a.2fac5",
             "7541ec2.7a4e714"
          ]
       ]
    },
    {
       "id":"3975373f.9d60f8",
       "type":"change",
       "z":"7bb31cb3.9db904",
       "name":"Stackpot",
       "rules":[
          {
             "t":"set",
             "p":"topic",
             "pt":"msg",
             "to":"Stackpot",
             "tot":"str"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":411,
       "y":1000,
       "wires":[
          [
             "2382d926.ac4d76",
             "b1feb01b.af477"
          ]
       ]
    },
    {
       "id":"38172c80.e28ca4",
       "type":"change",
       "z":"7bb31cb3.9db904",
       "name":"Video",
       "rules":[
          {
             "t":"set",
             "p":"topic",
             "pt":"msg",
             "to":"Video",
             "tot":"str"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":401,
       "y":1107,
       "wires":[
          [
             "c3f8d58c.fab4d8",
             "e7a2f50b.1cb308"
          ]
       ]
    },
    {
       "id":"19ca583c.8bb848",
       "type":"change",
       "z":"7bb31cb3.9db904",
       "name":"Bonus",
       "rules":[
          {
             "t":"set",
             "p":"topic",
             "pt":"msg",
             "to":"Bonus",
             "tot":"str"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":401,
       "y":1175,
       "wires":[
          [
             "6c081667.338dc8"
          ]
       ]
    },
    {
       "id":"8a5b8f8a.2fac5",
       "type":"api-current-state",
       "z":"7bb31cb3.9db904",
       "name":"Survey last visited",
       "server":"5806b60f.c2e778",
       "version":1,
       "outputs":1,
       "halt_if":"",
       "halt_if_type":"str",
       "halt_if_compare":"is_not",
       "override_topic":false,
       "entity_id":"sensor.pickmypostcode_survey_last_visited",
       "state_type":"str",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"",
       "override_data":"none",
       "blockInputOverrides":false,
       "x":647,
       "y":871,
       "wires":[
          [
             "6e33b5e3.2518dc"
          ]
       ],
       "outputLabels":[
          "has value"
       ]
    },
    {
       "id":"2382d926.ac4d76",
       "type":"api-current-state",
       "z":"7bb31cb3.9db904",
       "name":"Stackpot last visited",
       "server":"5806b60f.c2e778",
       "version":1,
       "outputs":1,
       "halt_if":"",
       "halt_if_type":"str",
       "halt_if_compare":"is_not",
       "override_topic":false,
       "entity_id":"sensor.pickmypostcode_stackpot_last_visited",
       "state_type":"str",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"",
       "override_data":"none",
       "blockInputOverrides":false,
       "x":636,
       "y":975,
       "wires":[
          [
             "6e33b5e3.2518dc"
          ]
       ],
       "outputLabels":[
          "has value"
       ]
    },
    {
       "id":"c3f8d58c.fab4d8",
       "type":"api-current-state",
       "z":"7bb31cb3.9db904",
       "name":"Video last visited",
       "server":"5806b60f.c2e778",
       "version":1,
       "outputs":1,
       "halt_if":"",
       "halt_if_type":"str",
       "halt_if_compare":"is_not",
       "override_topic":false,
       "entity_id":"sensor.pickmypostcode_video_last_visited",
       "state_type":"str",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"",
       "override_data":"none",
       "blockInputOverrides":false,
       "x":646,
       "y":1077,
       "wires":[
          [
             "6e33b5e3.2518dc"
          ]
       ],
       "outputLabels":[
          "has value"
       ]
    },
    {
       "id":"6c081667.338dc8",
       "type":"api-current-state",
       "z":"7bb31cb3.9db904",
       "name":"Bonus last visited",
       "server":"5806b60f.c2e778",
       "version":1,
       "outputs":1,
       "halt_if":"",
       "halt_if_type":"str",
       "halt_if_compare":"is_not",
       "override_topic":false,
       "entity_id":"sensor.pickmypostcode_bonus_last_visited",
       "state_type":"str",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"",
       "override_data":"none",
       "blockInputOverrides":false,
       "x":646,
       "y":1175,
       "wires":[
          [
             "6e33b5e3.2518dc"
          ]
       ],
       "outputLabels":[
          "has value"
       ]
    },
    {
       "id":"6e33b5e3.2518dc",
       "type":"moment",
       "z":"7bb31cb3.9db904",
       "name":"",
       "topic":"",
       "input":"payload",
       "inputType":"msg",
       "inTz":"Europe/London",
       "adjAmount":0,
       "adjType":"days",
       "adjDir":"add",
       "format":"date",
       "locale":"POSIX",
       "output":"payload",
       "outputType":"msg",
       "outTz":"Europe/London",
       "x":984.5,
       "y":872,
       "wires":[
          [
             "3cb09c2f.0eb8d4"
          ]
       ]
    },
    {
       "id":"3cb09c2f.0eb8d4",
       "type":"function",
       "z":"7bb31cb3.9db904",
       "name":"Time difference from now (hours)",
       "func":"var differenceMilliseconds = Date.now() - msg.payload;\nvar differenceHours = differenceMilliseconds / 3600000;\nmsg.payload = differenceHours;\nreturn msg;",
       "outputs":1,
       "noerr":0,
       "x":1253.5,
       "y":872,
       "wires":[
          [
             "41f68308.eb473c"
          ]
       ]
    },
    {
       "id":"41f68308.eb473c",
       "type":"switch",
       "z":"7bb31cb3.9db904",
       "name":">25hrs?",
       "property":"payload",
       "propertyType":"msg",
       "rules":[
          {
             "t":"gt",
             "v":"25",
             "vt":"num"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":1,
       "x":1481.5,
       "y":872,
       "wires":[
          [
             "9e85de1e.e300d"
          ]
       ]
    },
    {
       "id":"9e85de1e.e300d",
       "type":"change",
       "z":"7bb31cb3.9db904",
       "name":"Draw last visted message",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"topic & \" draw last visited \" & $round($number(payload)) & \" hours ago.\"",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":1682,
       "y":872,
       "wires":[
          [
             "84279e11.145ae"
          ]
       ]
    },
    {
       "id":"5d96969d.0606c8",
       "type":"change",
       "z":"7bb31cb3.9db904",
       "name":"Set healthcheck warning message",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"(\t  {\t       \"autoremote\":{\t           \"notification\":{\t               \"id\": \"pmp_hc_warn\",\t               \"title\":\"Pick My Postcode\",\t               \"text\": payload,\t               \"icon\": \"https://cdn2.iconfinder.com/data/icons/freecns-cumulus/32/519791-101_Warning-128.png\"\t           },\t           \"devices\":[\"brad\"]\t       }\t   }\t)",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":2168,
       "y":720,
       "wires":[
          [
             "17746e48.441f52"
          ]
       ]
    },
    {
       "id":"17746e48.441f52",
       "type":"subflow:8f5573e3.e52df",
       "z":"7bb31cb3.9db904",
       "name":"",
       "x":2405,
       "y":720,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"3b85882d.586338",
       "type":"debug",
       "z":"7bb31cb3.9db904",
       "name":"",
       "active":true,
       "tosidebar":true,
       "console":false,
       "tostatus":false,
       "complete":"true",
       "targetType":"full",
       "x":1098.5,
       "y":368,
       "wires":[
 
       ]
    },
    {
       "id":"20f5cb74.235224",
       "type":"change",
       "z":"7bb31cb3.9db904",
       "name":"main",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"payload.drawResult.main",
             "tot":"msg"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":1324,
       "y":233,
       "wires":[
          [
             "b27bec4d.ab1fb"
          ]
       ]
    },
    {
       "id":"5927ca9a.a54994",
       "type":"api-current-state",
       "z":"7bb31cb3.9db904",
       "name":"Main last draw",
       "server":"5806b60f.c2e778",
       "version":1,
       "outputs":1,
       "halt_if":"",
       "halt_if_type":"str",
       "halt_if_compare":"is_not",
       "override_topic":false,
       "entity_id":"sensor.pickmypostcode_main_last_draw",
       "state_type":"str",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"",
       "override_data":"none",
       "blockInputOverrides":false,
       "x":655,
       "y":824,
       "wires":[
          [
             "4af4131c.e7436c"
          ]
       ],
       "outputLabels":[
          "has value"
       ]
    },
    {
       "id":"4af4131c.e7436c",
       "type":"moment",
       "z":"7bb31cb3.9db904",
       "name":"",
       "topic":"",
       "input":"payload",
       "inputType":"msg",
       "inTz":"Europe/London",
       "adjAmount":0,
       "adjType":"days",
       "adjDir":"add",
       "format":"date",
       "locale":"POSIX",
       "output":"payload",
       "outputType":"msg",
       "outTz":"Europe/London",
       "x":987,
       "y":1228,
       "wires":[
          [
             "477637f4.9ecaa8"
          ]
       ]
    },
    {
       "id":"477637f4.9ecaa8",
       "type":"function",
       "z":"7bb31cb3.9db904",
       "name":"Time difference from now (hours)",
       "func":"var differenceMilliseconds = Date.now() - msg.payload;\nvar differenceHours = differenceMilliseconds / 3600000;\nmsg.payload = differenceHours;\nreturn msg;",
       "outputs":1,
       "noerr":0,
       "x":1256,
       "y":1228,
       "wires":[
          [
             "dce90d25.48ce2"
          ]
       ]
    },
    {
       "id":"7541ec2.7a4e714",
       "type":"api-current-state",
       "z":"7bb31cb3.9db904",
       "name":"Survey last draw",
       "server":"5806b60f.c2e778",
       "version":1,
       "outputs":1,
       "halt_if":"",
       "halt_if_type":"str",
       "halt_if_compare":"is_not",
       "override_topic":false,
       "entity_id":"sensor.pickmypostcode_survey_last_draw",
       "state_type":"str",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"",
       "override_data":"none",
       "blockInputOverrides":false,
       "x":648,
       "y":924,
       "wires":[
          [
             "4af4131c.e7436c"
          ]
       ],
       "outputLabels":[
          "has value"
       ]
    },
    {
       "id":"b1feb01b.af477",
       "type":"api-current-state",
       "z":"7bb31cb3.9db904",
       "name":"Stackpot last draw",
       "server":"5806b60f.c2e778",
       "version":1,
       "outputs":1,
       "halt_if":"",
       "halt_if_type":"str",
       "halt_if_compare":"is_not",
       "override_topic":false,
       "entity_id":"sensor.pickmypostcode_stackpot_last_draw",
       "state_type":"str",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"",
       "override_data":"none",
       "blockInputOverrides":false,
       "x":646,
       "y":1027,
       "wires":[
          [
             "37ccb48e.1f8a8c"
          ]
       ],
       "outputLabels":[
          "has value"
       ]
    },
    {
       "id":"e7a2f50b.1cb308",
       "type":"api-current-state",
       "z":"7bb31cb3.9db904",
       "name":"Video last draw",
       "server":"5806b60f.c2e778",
       "version":1,
       "outputs":1,
       "halt_if":"",
       "halt_if_type":"str",
       "halt_if_compare":"is_not",
       "override_topic":false,
       "entity_id":"sensor.pickmypostcode_video_last_draw",
       "state_type":"str",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"",
       "override_data":"none",
       "blockInputOverrides":false,
       "x":657,
       "y":1128,
       "wires":[
          [
             "4af4131c.e7436c"
          ]
       ],
       "outputLabels":[
          "has value"
       ]
    },
    {
       "id":"73ed8358.7b79fc",
       "type":"api-current-state",
       "z":"7bb31cb3.9db904",
       "name":"Bonus five last draw",
       "server":"5806b60f.c2e778",
       "version":1,
       "outputs":1,
       "halt_if":"",
       "halt_if_type":"str",
       "halt_if_compare":"is_not",
       "override_topic":false,
       "entity_id":"sensor.pickmypostcode_bonus_five_last_draw",
       "state_type":"str",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"",
       "override_data":"none",
       "blockInputOverrides":false,
       "x":636,
       "y":1227,
       "wires":[
          [
             "4af4131c.e7436c"
          ]
       ],
       "outputLabels":[
          "has value"
       ]
    },
    {
       "id":"e3522a87.f0f138",
       "type":"api-current-state",
       "z":"7bb31cb3.9db904",
       "name":"Bonus ten last draw",
       "server":"5806b60f.c2e778",
       "version":1,
       "outputs":1,
       "halt_if":"",
       "halt_if_type":"str",
       "halt_if_compare":"is_not",
       "override_topic":false,
       "entity_id":"sensor.pickmypostcode_bonus_ten_last_draw",
       "state_type":"str",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"",
       "override_data":"none",
       "blockInputOverrides":false,
       "x":648,
       "y":1276,
       "wires":[
          [
             "4af4131c.e7436c"
          ]
       ],
       "outputLabels":[
          "has value"
       ]
    },
    {
       "id":"7d3657dd.2f8cf8",
       "type":"api-current-state",
       "z":"7bb31cb3.9db904",
       "name":"Bonus twenty last draw",
       "server":"5806b60f.c2e778",
       "version":1,
       "outputs":1,
       "halt_if":"",
       "halt_if_type":"str",
       "halt_if_compare":"is_not",
       "override_topic":false,
       "entity_id":"sensor.pickmypostcode_bonus_twenty_last_draw",
       "state_type":"str",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"",
       "override_data":"none",
       "blockInputOverrides":false,
       "x":630,
       "y":1324,
       "wires":[
          [
             "4af4131c.e7436c"
          ]
       ],
       "outputLabels":[
          "has value"
       ]
    },
    {
       "id":"7a209d53.35b3b4",
       "type":"change",
       "z":"7bb31cb3.9db904",
       "name":"Bonus five",
       "rules":[
          {
             "t":"set",
             "p":"topic",
             "pt":"msg",
             "to":"%C2%A35 bonus",
             "tot":"str"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":418,
       "y":1227,
       "wires":[
          [
             "73ed8358.7b79fc"
          ]
       ]
    },
    {
       "id":"b0d3c0d6.22497",
       "type":"change",
       "z":"7bb31cb3.9db904",
       "name":"Bonus ten",
       "rules":[
          {
             "t":"set",
             "p":"topic",
             "pt":"msg",
             "to":"%C2%A310 bonus",
             "tot":"str"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":407,
       "y":1276,
       "wires":[
          [
             "e3522a87.f0f138"
          ]
       ]
    },
    {
       "id":"dae40e7d.37cbe",
       "type":"change",
       "z":"7bb31cb3.9db904",
       "name":"Bonus twenty",
       "rules":[
          {
             "t":"set",
             "p":"topic",
             "pt":"msg",
             "to":"%C2%A320 bonus",
             "tot":"str"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":424,
       "y":1324,
       "wires":[
          [
             "7d3657dd.2f8cf8"
          ]
       ]
    },
    {
       "id":"37ccb48e.1f8a8c",
       "type":"moment",
       "z":"7bb31cb3.9db904",
       "name":"",
       "topic":"",
       "input":"payload",
       "inputType":"msg",
       "inTz":"Europe/London",
       "adjAmount":0,
       "adjType":"days",
       "adjDir":"add",
       "format":"date",
       "locale":"POSIX",
       "output":"payload",
       "outputType":"msg",
       "outTz":"Europe/London",
       "x":983,
       "y":1027,
       "wires":[
          [
             "20dd4a47.46e786"
          ]
       ]
    },
    {
       "id":"20dd4a47.46e786",
       "type":"function",
       "z":"7bb31cb3.9db904",
       "name":"Time difference from now (hours)",
       "func":"var differenceMilliseconds = Date.now() - msg.payload;\nvar differenceHours = differenceMilliseconds / 3600000;\nmsg.payload = differenceHours;\nreturn msg;",
       "outputs":1,
       "noerr":0,
       "x":1252,
       "y":1027,
       "wires":[
          [
             "fadce528.70d028"
          ]
       ]
    },
    {
       "id":"fadce528.70d028",
       "type":"switch",
       "z":"7bb31cb3.9db904",
       "name":">13hrs?",
       "property":"payload",
       "propertyType":"msg",
       "rules":[
          {
             "t":"gt",
             "v":"13",
             "vt":"num"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":1,
       "x":1480,
       "y":1027,
       "wires":[
          [
             "3ebc70cf.75f6e"
          ]
       ]
    },
    {
       "id":"3ebc70cf.75f6e",
       "type":"change",
       "z":"7bb31cb3.9db904",
       "name":"Draw results old message",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"topic & \" draw results over \" & $round($number(payload)) & \" hours old.\"",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":1683,
       "y":1122,
       "wires":[
          [
             "84279e11.145ae"
          ]
       ]
    },
    {
       "id":"dce90d25.48ce2",
       "type":"switch",
       "z":"7bb31cb3.9db904",
       "name":">25hrs?",
       "property":"payload",
       "propertyType":"msg",
       "rules":[
          {
             "t":"gt",
             "v":"25",
             "vt":"num"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":1,
       "x":1481,
       "y":1228,
       "wires":[
          [
             "3ebc70cf.75f6e"
          ]
       ]
    },
    {
       "id":"162f30b1.058e0f",
       "type":"api-current-state",
       "z":"98bf1f56.6da51",
       "name":"Porch light on?",
       "server":"5806b60f.c2e778",
       "version":"1",
       "outputs":2,
       "halt_if":"false",
       "halt_if_type":"bool",
       "halt_if_compare":"is",
       "override_topic":false,
       "entity_id":"light.porch_group",
       "state_type":"habool",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"data",
       "override_data":"msg",
       "blockInputOverrides":false,
       "x":548,
       "y":585,
       "wires":[
          [
             "4db58b2b.54a334"
          ],
          [
 
          ]
       ]
    },
    {
       "id":"307667a1.61e918",
       "type":"api-call-service",
       "z":"98bf1f56.6da51",
       "name":"Turn on kitchen light",
       "server":"5806b60f.c2e778",
       "version":1,
       "service_domain":"light",
       "service":"turn_on",
       "entityId":"light.kitchen_ceiling_group",
       "data":"{\t   \"brightness_pct\":100,\t   \"transition\":1,\t   \"color_temp\":$flowContext('kitchen_colour_temp')\t}",
       "dataType":"jsonata",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "mustacheAltTags":false,
       "x":595,
       "y":1467,
       "wires":[
          [
             "a8df925c.55e18"
          ]
       ]
    },
    {
       "id":"c827ac74.911cf",
       "type":"api-call-service",
       "z":"98bf1f56.6da51",
       "name":"Turn off kitchen light",
       "server":"5806b60f.c2e778",
       "version":"1",
       "service_domain":"light",
       "service":"turn_off",
       "entityId":"light.kitchen_ceiling_group",
       "data":"",
       "dataType":"json",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "mustacheAltTags":false,
       "x":1204,
       "y":1552,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"d0d83c51.423ef",
       "type":"server-state-changed",
       "z":"98bf1f56.6da51",
       "name":"Kitchen Light Switch",
       "server":"5806b60f.c2e778",
       "version":1,
       "entityidfilter":"binary_sensor.kitchen_light_switch",
       "entityidfiltertype":"exact",
       "outputinitially":false,
       "state_type":"habool",
       "haltifstate":"",
       "halt_if_type":"str",
       "halt_if_compare":"is",
       "outputs":1,
       "output_only_on_state_change":true,
       "x":325,
       "y":1422,
       "wires":[
          [
             "307667a1.61e918"
          ]
       ]
    },
    {
       "id":"db40e987.a3aae8",
       "type":"server-state-changed",
       "z":"98bf1f56.6da51",
       "name":"Kitchen Motion 1 trigger",
       "server":"5806b60f.c2e778",
       "version":1,
       "entityidfilter":"binary_sensor.kitchen_motion_1_occupancy",
       "entityidfiltertype":"exact",
       "outputinitially":false,
       "state_type":"habool",
       "haltifstate":"true",
       "halt_if_type":"bool",
       "halt_if_compare":"is",
       "outputs":2,
       "output_only_on_state_change":true,
       "x":143,
       "y":1473,
       "wires":[
          [
             "245cb860.647428"
          ],
          [
 
          ]
       ]
    },
    {
       "id":"245cb860.647428",
       "type":"api-current-state",
       "z":"98bf1f56.6da51",
       "name":"Illuminance",
       "server":"5806b60f.c2e778",
       "version":1,
       "outputs":2,
       "halt_if":"10",
       "halt_if_type":"num",
       "halt_if_compare":"lt",
       "override_topic":false,
       "entity_id":"sensor.kitchen_motion_1_illuminance",
       "state_type":"num",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"data",
       "override_data":"msg",
       "blockInputOverrides":false,
       "x":343,
       "y":1473,
       "wires":[
          [
             "307667a1.61e918"
          ],
          [
             "adf08145.47efa"
          ]
       ]
    },
    {
       "id":"66903333.b1aa9c",
       "type":"server-state-changed",
       "z":"98bf1f56.6da51",
       "name":"Kitchen Motion 2 trigger",
       "server":"5806b60f.c2e778",
       "version":1,
       "entityidfilter":"binary_sensor.kitchen_motion_2_occupancy",
       "entityidfiltertype":"exact",
       "outputinitially":false,
       "state_type":"habool",
       "haltifstate":"true",
       "halt_if_type":"bool",
       "halt_if_compare":"is",
       "outputs":2,
       "output_only_on_state_change":true,
       "x":144,
       "y":1528,
       "wires":[
          [
             "9ba99db3.2ec5a"
          ],
          [
 
          ]
       ]
    },
    {
       "id":"9ba99db3.2ec5a",
       "type":"api-current-state",
       "z":"98bf1f56.6da51",
       "name":"Illuminance",
       "server":"5806b60f.c2e778",
       "version":1,
       "outputs":2,
       "halt_if":"6",
       "halt_if_type":"num",
       "halt_if_compare":"lt",
       "override_topic":false,
       "entity_id":"sensor.kitchen_motion_2_illuminance",
       "state_type":"num",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"data",
       "override_data":"msg",
       "blockInputOverrides":false,
       "x":342,
       "y":1527,
       "wires":[
          [
             "307667a1.61e918"
          ],
          [
             "adf08145.47efa"
          ]
       ]
    },
    {
       "id":"275a47b5.9fd4c8",
       "type":"server-state-changed",
       "z":"98bf1f56.6da51",
       "name":"Kitchen Motion 3 trigger",
       "server":"5806b60f.c2e778",
       "version":1,
       "entityidfilter":"binary_sensor.kitchen_motion_3_occupancy",
       "entityidfiltertype":"exact",
       "outputinitially":false,
       "state_type":"habool",
       "haltifstate":"true",
       "halt_if_type":"bool",
       "halt_if_compare":"is",
       "outputs":2,
       "output_only_on_state_change":true,
       "x":145,
       "y":1580,
       "wires":[
          [
             "28d03129.1e9a7e"
          ],
          [
 
          ]
       ]
    },
    {
       "id":"28d03129.1e9a7e",
       "type":"api-current-state",
       "z":"98bf1f56.6da51",
       "name":"Illuminance",
       "server":"5806b60f.c2e778",
       "version":1,
       "outputs":2,
       "halt_if":"6",
       "halt_if_type":"num",
       "halt_if_compare":"lt",
       "override_topic":false,
       "entity_id":"sensor.kitchen_motion_3_illuminance",
       "state_type":"num",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"data",
       "override_data":"msg",
       "blockInputOverrides":false,
       "x":342,
       "y":1578,
       "wires":[
          [
             "307667a1.61e918"
          ],
          [
             "adf08145.47efa"
          ]
       ]
    },
    {
       "id":"adf08145.47efa",
       "type":"api-current-state",
       "z":"98bf1f56.6da51",
       "name":"Light on?",
       "server":"5806b60f.c2e778",
       "version":1,
       "outputs":2,
       "halt_if":"true",
       "halt_if_type":"bool",
       "halt_if_compare":"is",
       "override_topic":false,
       "entity_id":"light.kitchen_ceiling_group",
       "state_type":"habool",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"data",
       "override_data":"msg",
       "blockInputOverrides":false,
       "x":586,
       "y":1534,
       "wires":[
          [
             "a8df925c.55e18"
          ],
          [
 
          ]
       ]
    },
    {
       "id":"a8df925c.55e18",
       "type":"change",
       "z":"98bf1f56.6da51",
       "name":"kitchen_ceiling_light timer: 5min",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"300",
             "tot":"json"
          },
          {
             "t":"set",
             "p":"topic",
             "pt":"msg",
             "to":"mqtttimer/kitchen_ceiling_light/start",
             "tot":"str"
          },
          {
             "t":"set",
             "p":"responsePayload",
             "pt":"msg",
             "to":"off",
             "tot":"str"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":899.5,
       "y":1467,
       "wires":[
          [
             "28e65df4.571a82"
          ]
       ]
    },
    {
       "id":"28e65df4.571a82",
       "type":"subflow:94dca4da.a92a08",
       "z":"98bf1f56.6da51",
       "name":"Start timer",
       "env":[
 
       ],
       "x":1157.5,
       "y":1467,
       "wires":[
 
       ]
    },
    {
       "id":"9d208462.13e108",
       "type":"mqtt in",
       "z":"98bf1f56.6da51",
       "name":"",
       "topic":"mqtttimer/kitchen_ceiling_light",
       "qos":"1",
       "datatype":"auto",
       "broker":"ab404be4.584f18",
       "x":805.5,
       "y":1552,
       "wires":[
          [
             "ee0bc367.63d25"
          ]
       ]
    },
    {
       "id":"c08386ea.c987e8",
       "type":"comment",
       "z":"98bf1f56.6da51",
       "name":"Kitchen lights",
       "info":"",
       "x":105,
       "y":1420,
       "wires":[
 
       ]
    },
    {
       "id":"ee0bc367.63d25",
       "type":"switch",
       "z":"98bf1f56.6da51",
       "name":"off?",
       "property":"payload",
       "propertyType":"msg",
       "rules":[
          {
             "t":"eq",
             "v":"off",
             "vt":"str"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":1,
       "x":1018.5,
       "y":1552,
       "wires":[
          [
             "c827ac74.911cf"
          ]
       ]
    },
    {
       "id":"22fc9461.18bc7c",
       "type":"mqtt in",
       "z":"98bf1f56.6da51",
       "name":"",
       "topic":"zigbee2mqtt/kitchen_dimmer",
       "qos":"2",
       "datatype":"json",
       "broker":"ab404be4.584f18",
       "x":167.5,
       "y":1661,
       "wires":[
          [
             "2d22e03a.296f"
          ]
       ]
    },
    {
       "id":"2d22e03a.296f",
       "type":"change",
       "z":"98bf1f56.6da51",
       "name":"Get button & action",
       "rules":[
          {
             "t":"set",
             "p":"button",
             "pt":"msg",
             "to":"$match(payload.action, /^\\w+/).match",
             "tot":"jsonata"
          },
          {
             "t":"set",
             "p":"action",
             "pt":"msg",
             "to":"$match(payload.action, /[^-]+$/).match",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":427.5,
       "y":1661,
       "wires":[
          [
             "2b97d37e.12e58c"
          ]
       ]
    },
    {
       "id":"2b97d37e.12e58c",
       "type":"switch",
       "z":"98bf1f56.6da51",
       "name":"",
       "property":"button",
       "propertyType":"msg",
       "rules":[
          {
             "t":"eq",
             "v":"on",
             "vt":"str"
          },
          {
             "t":"eq",
             "v":"off",
             "vt":"str"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":2,
       "x":605.5,
       "y":1661,
       "wires":[
          [
             "9dbf4d5d.8bca6"
          ],
          [
             "d14b0bb3.861ad8"
          ]
       ]
    },
    {
       "id":"9dbf4d5d.8bca6",
       "type":"api-call-service",
       "z":"98bf1f56.6da51",
       "name":"Turn on kitchen light",
       "server":"5806b60f.c2e778",
       "version":1,
       "service_domain":"light",
       "service":"turn_on",
       "entityId":"light.kitchen_ceiling_group",
       "data":"{\t   \"brightness_pct\":100,\t   \"transition\":1,\t   \"color_temp\":$flowContext('kitchen_colour_temp')\t}",
       "dataType":"jsonata",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "mustacheAltTags":false,
       "x":802,
       "y":1630,
       "wires":[
          [
             "a8df925c.55e18"
          ]
       ]
    },
    {
       "id":"d14b0bb3.861ad8",
       "type":"api-call-service",
       "z":"98bf1f56.6da51",
       "name":"Turn off kitchen light",
       "server":"5806b60f.c2e778",
       "version":"1",
       "service_domain":"light",
       "service":"turn_off",
       "entityId":"light.kitchen_ceiling_group",
       "data":"",
       "dataType":"json",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "mustacheAltTags":false,
       "x":803,
       "y":1688,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"dcb69002.33b99",
       "type":"inject",
       "z":"3e06a286.f1fcfe",
       "name":"",
       "topic":"",
       "payload":"",
       "payloadType":"date",
       "repeat":"",
       "crontab":"",
       "once":false,
       "onceDelay":0.1,
       "x":115,
       "y":642,
       "wires":[
          [
             "1be89b60.ae2185"
          ]
       ]
    },
    {
       "id":"1be89b60.ae2185",
       "type":"change",
       "z":"3e06a286.f1fcfe",
       "name":"",
       "rules":[
          {
             "t":"set",
             "p":"fluxSettings",
             "pt":"msg",
             "to":"{\"DayKelvin\":6100,\"NightKelvin\":2000,\"SunriseKelvin\":3500,\"DawnKelvin\":2000,\"SunsetKelvin\":3000,\"DuskKelvin\":3500,\"SunriseOverride\":\"06:00:00\"}",
             "tot":"json"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":309,
       "y":645,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"db009aa1.708698",
       "type":"comment",
       "z":"98e70926.543948",
       "name":"Home assistant",
       "info":"",
       "x":770,
       "y":417,
       "wires":[
 
       ]
    },
    {
       "id":"bbe1bd76.e0083",
       "type":"link in",
       "z":"98e70926.543948",
       "name":"HASS online Home assistant",
       "links":[
          "fe37facc.60fd58"
       ],
       "x":871,
       "y":416,
       "wires":[
          [
             "6faf452d.e93ffc"
          ]
       ]
    },
    {
       "id":"1c214d24.5b9163",
       "type":"api-call-service",
       "z":"98e70926.543948",
       "name":"Start kitchen_flux",
       "server":"5806b60f.c2e778",
       "version":1,
       "service_domain":"switch",
       "service":"turn_on",
       "entityId":"switch.kitchen_flux",
       "data":"",
       "dataType":"json",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "mustacheAltTags":false,
       "x":1299,
       "y":416,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"fe633f2b.0f693",
       "type":"trigger-state",
       "z":"98bf1f56.6da51",
       "name":"",
       "server":"5806b60f.c2e778",
       "entityid":"light.kitchen_colour_temp",
       "entityidfiltertype":"exact",
       "debugenabled":false,
       "constraints":[
 
       ],
       "constraintsmustmatch":"all",
       "outputs":2,
       "customoutputs":[
 
       ],
       "outputinitially":true,
       "state_type":"str",
       "x":198,
       "y":1773,
       "wires":[
          [
             "1eb87740.34e449"
          ],
          [
 
          ]
       ]
    },
    {
       "id":"1eb87740.34e449",
       "type":"change",
       "z":"98bf1f56.6da51",
       "name":"Colour temp",
       "rules":[
          {
             "t":"set",
             "p":"kitchen_colour_temp",
             "pt":"flow",
             "to":"data.event.new_state.attributes.color_temp",
             "tot":"msg"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":620.0001907348633,
       "y":1766.0006008148193,
       "wires":[
          [
             "84af2f76.1d621"
          ]
       ]
    },
    {
       "id":"84af2f76.1d621",
       "type":"api-current-state",
       "z":"98bf1f56.6da51",
       "name":"Light on?",
       "server":"5806b60f.c2e778",
       "version":1,
       "outputs":2,
       "halt_if":"true",
       "halt_if_type":"bool",
       "halt_if_compare":"is",
       "override_topic":false,
       "entity_id":"light.kitchen_ceiling_group",
       "state_type":"habool",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"data",
       "override_data":"msg",
       "blockInputOverrides":false,
       "x":800.0001068115234,
       "y":1795.0001831054688,
       "wires":[
          [
             "442751d9.8dcb5"
          ],
          [
 
          ]
       ]
    },
    {
       "id":"442751d9.8dcb5",
       "type":"api-call-service",
       "z":"98bf1f56.6da51",
       "name":"Set kitchen colour_temp",
       "server":"5806b60f.c2e778",
       "version":1,
       "service_domain":"light",
       "service":"turn_on",
       "entityId":"light.kitchen_ceiling_group",
       "data":"{\t   \"brightness_pct\": 100,\t   \"transition\": 20,\t   \"color_temp\": $flowContext('kitchen_colour_temp')\t}",
       "dataType":"jsonata",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "mustacheAltTags":false,
       "x":1004.000114440918,
       "y":1793.0001831054688,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"6faf452d.e93ffc",
       "type":"api-call-service",
       "z":"98e70926.543948",
       "name":"Turn on kitchen colour temp light",
       "server":"5806b60f.c2e778",
       "version":"1",
       "service_domain":"light",
       "service":"turn_on",
       "entityId":"light.kitchen_colour_temp",
       "data":"",
       "dataType":"json",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "mustacheAltTags":false,
       "x":1044,
       "y":416,
       "wires":[
          [
             "1c214d24.5b9163"
          ]
       ]
    },
    {
       "id":"9ec03763.e0b548",
       "type":"switch",
       "z":"257e9eaf.a9d202",
       "name":"Check current door code",
       "property":"payload",
       "propertyType":"msg",
       "rules":[
          {
             "t":"neq",
             "v":"#:(file)::door_access_code",
             "vt":"flow"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":1,
       "x":309.00001525878906,
       "y":656.0000038146973,
       "wires":[
          [
             "217394d2.4a1e1c"
          ]
       ]
    },
    {
       "id":"22484754.340f98",
       "type":"server-state-changed",
       "z":"98bf1f56.6da51",
       "name":"Cloakroom Light Switch",
       "server":"5806b60f.c2e778",
       "version":0,
       "entityidfilter":"binary_sensor.cloakroom_light_switch",
       "entityidfiltertype":"exact",
       "outputinitially":false,
       "state_type":"habool",
       "haltifstate":"",
       "halt_if_type":"str",
       "halt_if_compare":"is",
       "outputs":1,
       "output_only_on_state_change":true,
       "x":451,
       "y":1200,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"3de877cc.8a6c18",
       "type":"api-call-service",
       "z":"98bf1f56.6da51",
       "name":"Turn on cloakroom light",
       "server":"5806b60f.c2e778",
       "version":1,
       "service_domain":"light",
       "service":"toggle",
       "entityId":"light.cloakroom",
       "data":"",
       "dataType":"json",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "mustacheAltTags":false,
       "x":693,
       "y":1200,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"c3b08ed5.4bed7",
       "type":"server-state-changed",
       "z":"a127b200.23554",
       "name":"Cloakroom motion",
       "server":"5806b60f.c2e778",
       "version":1,
       "entityidfilter":"binary_sensor.cloakroom_motion_occupancy",
       "entityidfiltertype":"exact",
       "outputinitially":false,
       "state_type":"habool",
       "haltifstate":"true",
       "halt_if_type":"bool",
       "halt_if_compare":"is",
       "outputs":2,
       "output_only_on_state_change":true,
       "x":159.00000381469727,
       "y":137.00000762939453,
       "wires":[
          [
             "6879d2c0.f8dd0c"
          ],
          [
 
          ]
       ]
    },
    {
       "id":"60a0c66e.506ea8",
       "type":"server-state-changed",
       "z":"a127b200.23554",
       "name":"Cloakroom Light Switch",
       "server":"5806b60f.c2e778",
       "version":1,
       "entityidfilter":"binary_sensor.cloakroom_light_switch",
       "entityidfiltertype":"exact",
       "outputinitially":false,
       "state_type":"habool",
       "haltifstate":"",
       "halt_if_type":"str",
       "halt_if_compare":"is",
       "outputs":1,
       "output_only_on_state_change":true,
       "x":149.00000381469727,
       "y":82.00000762939453,
       "wires":[
          [
             "bcde4987.305438"
          ]
       ]
    },
    {
       "id":"8bd32955.3e1988",
       "type":"mqtt out",
       "z":"a127b200.23554",
       "name":"SwitchOperated MQTT",
       "topic":"statemachine/Cloakroom/SwitchOperated",
       "qos":"2",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":569.7142753601074,
       "y":82.00002861022949,
       "wires":[
 
       ]
    },
    {
       "id":"bcde4987.305438",
       "type":"change",
       "z":"a127b200.23554",
       "name":"set msg.payload",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"true",
             "tot":"bool"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":361.71428298950195,
       "y":81.71429824829102,
       "wires":[
          [
             "8bd32955.3e1988"
          ]
       ]
    },
    {
       "id":"6879d2c0.f8dd0c",
       "type":"api-render-template",
       "z":"a127b200.23554",
       "name":"set payload",
       "server":"5806b60f.c2e778",
       "template":"{\n    \"luminosity\": {{ states('sensor.cloakroom_motion_illuminance') }},\n    \"doorOpen\": {{ 'true' if states('sensor.cloakroom_door') == 'on' else 'false' }}\n}",
       "resultsLocation":"payload",
       "resultsLocationType":"msg",
       "templateLocation":"template",
       "templateLocationType":"msg",
       "x":360.71428298950195,
       "y":137.14288711547852,
       "wires":[
          [
             "773ef670.3d5b68"
          ]
       ]
    },
    {
       "id":"773ef670.3d5b68",
       "type":"mqtt out",
       "z":"a127b200.23554",
       "name":"MotionDetectedInCloakroom MQTT",
       "topic":"statemachine/Cloakroom/MotionDetectedInCloakroom",
       "qos":"2",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":609.0000038146973,
       "y":137.00000381469727,
       "wires":[
 
       ]
    },
    {
       "id":"2e3db99b.5f1326",
       "type":"server-state-changed",
       "z":"a127b200.23554",
       "name":"Hall motion 3",
       "server":"5806b60f.c2e778",
       "version":1,
       "entityidfilter":"binary_sensor.hall_motion_3_occupancy",
       "entityidfiltertype":"exact",
       "outputinitially":false,
       "state_type":"habool",
       "haltifstate":"true",
       "halt_if_type":"bool",
       "halt_if_compare":"is",
       "outputs":2,
       "output_only_on_state_change":true,
       "x":178.00000381469727,
       "y":189.00000381469727,
       "wires":[
          [
             "65ea2283.1e996c"
          ],
          [
 
          ]
       ]
    },
    {
       "id":"65ea2283.1e996c",
       "type":"api-render-template",
       "z":"a127b200.23554",
       "name":"set payload",
       "server":"5806b60f.c2e778",
       "template":"{\n    \"doorOpen\": {{ 'false' if states('sensor.cloakroom_door') == 'on' else 'true' }}\n}",
       "resultsLocation":"payload",
       "resultsLocationType":"msg",
       "templateLocation":"template",
       "templateLocationType":"msg",
       "x":363.00000381469727,
       "y":190.00000381469727,
       "wires":[
          [
             "d6119e56.a77da"
          ]
       ]
    },
    {
       "id":"d6119e56.a77da",
       "type":"mqtt out",
       "z":"a127b200.23554",
       "name":"MotionDetectedByHallway3 MQTT",
       "topic":"statemachine/Cloakroom/MotionDetectedByHallway3",
       "qos":"2",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":610.0000038146973,
       "y":190.00000381469727,
       "wires":[
 
       ]
    },
    {
       "id":"55212cbd.376694",
       "type":"mqtt in",
       "z":"a127b200.23554",
       "name":"Cloakroom MQTT",
       "topic":"statemachine/Cloakroom",
       "qos":"1",
       "datatype":"utf8",
       "broker":"ab404be4.584f18",
       "x":159.71428298950195,
       "y":243.57144832611084,
       "wires":[
          [
             "e93e674a.b9d9a8"
          ]
       ]
    },
    {
       "id":"e93e674a.b9d9a8",
       "type":"change",
       "z":"a127b200.23554",
       "name":"set service",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"{\t  'service': 'turn_' & payload\t}",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":359.7143020629883,
       "y":244.00005722045898,
       "wires":[
          [
             "e5982456.710c68"
          ]
       ]
    },
    {
       "id":"e5982456.710c68",
       "type":"api-call-service",
       "z":"a127b200.23554",
       "name":"switch cloakroom light",
       "server":"5806b60f.c2e778",
       "version":1,
       "service_domain":"light",
       "service":"",
       "entityId":"light.cloakroom",
       "data":"",
       "dataType":"json",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "mustacheAltTags":false,
       "x":565.7143135070801,
       "y":244.00005531311035,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"1efec10c.6c3dff",
       "type":"comment",
       "z":"a127b200.23554",
       "name":"Cloakroom light",
       "info":"",
       "x":92,
       "y":39,
       "wires":[
 
       ]
    },
    {
       "id":"186a8e4e.df88b2",
       "type":"change",
       "z":"98bf1f56.6da51",
       "name":"Min Colour temp",
       "rules":[
          {
             "t":"set",
             "p":"kitchen_colour_temp",
             "pt":"flow",
             "to":"data.attributes.min_mireds",
             "tot":"msg"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":612.0001678466797,
       "y":1828.285901069641,
       "wires":[
          [
             "84af2f76.1d621"
          ]
       ]
    },
    {
       "id":"88141958.853648",
       "type":"inject",
       "z":"98bf1f56.6da51",
       "name":"Between 6am and 3pm",
       "topic":"",
       "payload":"",
       "payloadType":"date",
       "repeat":"",
       "crontab":"*/30 6-14 * * *",
       "once":false,
       "onceDelay":0.1,
       "x":156.7142791748047,
       "y":1828.1429061889648,
       "wires":[
          [
             "4bcbfbfa.8f3e64"
          ]
       ]
    },
    {
       "id":"4bcbfbfa.8f3e64",
       "type":"api-current-state",
       "z":"98bf1f56.6da51",
       "name":"kitchen_colour_temp",
       "server":"5806b60f.c2e778",
       "version":1,
       "outputs":1,
       "halt_if":"",
       "halt_if_type":"str",
       "halt_if_compare":"is",
       "override_topic":false,
       "entity_id":"light.kitchen_colour_temp",
       "state_type":"str",
       "state_location":"payload",
       "override_payload":"msg",
       "entity_location":"data",
       "override_data":"msg",
       "blockInputOverrides":false,
       "x":396.7142791748047,
       "y":1828.142903327942,
       "wires":[
          [
             "186a8e4e.df88b2"
          ]
       ]
    },
    {
       "id":"823e1213.29a64",
       "type":"change",
       "z":"98bf1f56.6da51",
       "name":"Set travis created message",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"(\t   {\t       \"autoremote\":{\t           \"notification\":{\t               \"id\": \"hall_motion_2_illuminance\",\t               \"title\":\"Hall Motion 2 Illuminance\",\t               \"text\":payload,\t               \"icon\":\"https://www.home-assistant.io/images/components/alexa/alexa-108x108.png\"\t           },\t           \"devices\":[\"brad\"]\t \t       }\t\t   }\t)",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":381,
       "y":638,
       "wires":[
          [
             "2d280fa9.e7a35"
          ]
       ]
    },
    {
       "id":"2d280fa9.e7a35",
       "type":"subflow:8f5573e3.e52df",
       "z":"98bf1f56.6da51",
       "name":"",
       "x":620,
       "y":638,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"b9829d9.3cb246",
       "type":"inject",
       "z":"257e9eaf.a9d202",
       "name":"Every 30 mins",
       "topic":"",
       "payload":"",
       "payloadType":"date",
       "repeat":"1800",
       "crontab":"",
       "once":false,
       "onceDelay":0.1,
       "x":664.8055038452148,
       "y":358.15477180480957,
       "wires":[
          [
             "4efa80f3.3866a"
          ]
       ]
    },
    {
       "id":"4e4da1b0.4ca63",
       "type":"mqtt out",
       "z":"257e9eaf.a9d202",
       "name":"Enable Status",
       "topic":"enable/status",
       "qos":"0",
       "retain":"true",
       "broker":"ab404be4.584f18",
       "x":1469.009880065918,
       "y":461.02775859832764,
       "wires":[
 
       ]
    },
    {
       "id":"4efa80f3.3866a",
       "type":"change",
       "z":"257e9eaf.a9d202",
       "name":"GET",
       "rules":[
          {
             "t":"set",
             "p":"method",
             "pt":"msg",
             "to":"GET",
             "tot":"str"
          },
          {
             "t":"set",
             "p":"retry",
             "pt":"msg",
             "to":"0",
             "tot":"num"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":826.0098876953125,
       "y":358.02777099609375,
       "wires":[
          [
             "43922fda.5c825"
          ]
       ]
    },
    {
       "id":"43922fda.5c825",
       "type":"api-current-state",
       "z":"257e9eaf.a9d202",
       "name":"Current Password Integer",
       "server":"5806b60f.c2e778",
       "version":0,
       "outputs":1,
       "halt_if":"",
       "halt_if_type":"str",
       "halt_if_compare":"is",
       "override_topic":true,
       "entity_id":"input_number.enable_current_password_integer",
       "state_type":"num",
       "state_location":"currentInteger",
       "override_payload":"msg",
       "entity_location":"data",
       "override_data":"msg",
       "x":1019.0098876953125,
       "y":381.02777099609375,
       "wires":[
          [
             "a29d71c5.2785f"
          ]
       ]
    },
    {
       "id":"a29d71c5.2785f",
       "type":"subflow:c26c68e9.a7fd88",
       "z":"257e9eaf.a9d202",
       "name":"",
       "env":[
 
       ],
       "x":1241.0098876953125,
       "y":381.02777099609375,
       "wires":[
          [
             "5e40b7d7.899608"
          ]
       ]
    },
    {
       "id":"5e40b7d7.899608",
       "type":"mqtt out",
       "z":"257e9eaf.a9d202",
       "name":"Enable Status",
       "topic":"enable/status",
       "qos":"0",
       "retain":"true",
       "broker":"ab404be4.584f18",
       "x":1441.0098876953125,
       "y":381.02777099609375,
       "wires":[
 
       ]
    },
    {
       "id":"17cd2aed.f006f5",
       "type":"mqtt in",
       "z":"257e9eaf.a9d202",
       "name":"Set status",
       "topic":"enable/status/set",
       "qos":"0",
       "datatype":"utf8",
       "broker":"ab404be4.584f18",
       "x":684.0098419189453,
       "y":404.0277795791626,
       "wires":[
          [
             "97b883f2.72b46"
          ]
       ]
    },
    {
       "id":"97b883f2.72b46",
       "type":"change",
       "z":"257e9eaf.a9d202",
       "name":"PUT",
       "rules":[
          {
             "t":"set",
             "p":"method",
             "pt":"msg",
             "to":"PUT",
             "tot":"str"
          },
          {
             "t":"set",
             "p":"headers",
             "pt":"msg",
             "to":"{\"Content-Type\":\"application/json\"}",
             "tot":"json"
          },
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"{\"status\":payload}",
             "tot":"jsonata"
          },
          {
             "t":"set",
             "p":"retry",
             "pt":"msg",
             "to":"0",
             "tot":"num"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":826.0098876953125,
       "y":404.02777099609375,
       "wires":[
          [
             "43922fda.5c825"
          ]
       ]
    },
    {
       "id":"817a5f9f.f0993",
       "type":"tuya-local",
       "z":"2c5b3241.37838e",
       "devName":"dehumidifer",
       "devIp":"192.168.0.99",
       "devId":"481760282cf4326f4838",
       "devKey":"5124a52eb4fcea61",
       "protocolVer":"3.3",
       "renameSchema":"",
       "filterCB":"",
       "x":1527.7596549987793,
       "y":784.5277328491211,
       "wires":[
          [
             "47a81d35.bda484"
          ]
       ]
    },
    {
       "id":"28f7dfcc.77788",
       "type":"comment",
       "z":"a127b200.23554",
       "name":"Summerhouse light",
       "info":"",
       "x":104.0099105834961,
       "y":315.02777099609375,
       "wires":[
 
       ]
    },
    {
       "id":"78c14c89.8c0a74",
       "type":"server-state-changed",
       "z":"a127b200.23554",
       "name":"Summerhouse door",
       "server":"5806b60f.c2e778",
       "version":1,
       "entityidfilter":"binary_sensor.summer_house_door",
       "entityidfiltertype":"exact",
       "outputinitially":false,
       "state_type":"habool",
       "haltifstate":"",
       "halt_if_type":"str",
       "halt_if_compare":"is",
       "outputs":1,
       "output_only_on_state_change":true,
       "x":155.00991821289062,
       "y":361.02777099609375,
       "wires":[
          [
             "862ec84a.faacd8"
          ]
       ]
    },
    {
       "id":"efcbe286.9874d",
       "type":"api-render-template",
       "z":"a127b200.23554",
       "name":"set payload",
       "server":"5806b60f.c2e778",
       "template":"{\n    \"luminosity\": {{ states('sensor.summer_house_door_illuminance') }}\n}",
       "resultsLocation":"payload",
       "resultsLocationType":"msg",
       "templateLocation":"template",
       "templateLocationType":"msg",
       "x":561.0099029541016,
       "y":335.0277633666992,
       "wires":[
          [
             "202721a.d960cde",
             "3d7292e0.00d3ee"
          ]
       ]
    },
    {
       "id":"202721a.d960cde",
       "type":"mqtt out",
       "z":"a127b200.23554",
       "name":"DoorOpen MQTT",
       "topic":"statemachine/Summerhouse/DoorOpen",
       "qos":"2",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":761.0098419189453,
       "y":335.0277786254883,
       "wires":[
 
       ]
    },
    {
       "id":"862ec84a.faacd8",
       "type":"switch",
       "z":"a127b200.23554",
       "name":"Open/closed?",
       "property":"payload",
       "propertyType":"msg",
       "rules":[
          {
             "t":"true"
          },
          {
             "t":"else"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":2,
       "x":371.8035888671875,
       "y":361.11112213134766,
       "wires":[
          [
             "efcbe286.9874d"
          ],
          [
             "645bd110.85d51"
          ]
       ],
       "outputLabels":[
          "Open",
          "Closed"
       ]
    },
    {
       "id":"645bd110.85d51",
       "type":"mqtt out",
       "z":"a127b200.23554",
       "name":"DoorClosed MQTT",
       "topic":"statemachine/Summerhouse/DoorClosed",
       "qos":"2",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":583.0098876953125,
       "y":383.02777099609375,
       "wires":[
 
       ]
    },
    {
       "id":"3b3f9fae.f502d",
       "type":"subflow:8f5573e3.e52df",
       "z":"a127b200.23554",
       "name":"",
       "x":1105.0098876953125,
       "y":287.02777099609375,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"3d7292e0.00d3ee",
       "type":"change",
       "z":"a127b200.23554",
       "name":"Set home assistant offline message",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"(\t   $restarted := $flowContext(\"restarted\");\t   $notificationId := \"summerhouselux\";\t   {\t       \"autoremote\":{\t           \"notification\":{\t               \"id\": $notificationId,\t               \"title\":\"Summerhouse\",\t               \"text\":payload.luminosity\t           },\t           \"devices\":[\"brad\"]\t \t       }\t\t   }\t\t)",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":855.0098876953125,
       "y":287.02777099609375,
       "wires":[
          [
             "3b3f9fae.f502d"
          ]
       ]
    },
    {
       "id":"7a8a794b.d55b08",
       "type":"mqtt in",
       "z":"a127b200.23554",
       "name":"Summerhouse MQTT",
       "topic":"statemachine/Summerhouse",
       "qos":"1",
       "datatype":"utf8",
       "broker":"ab404be4.584f18",
       "x":165.00991821289062,
       "y":441.02777099609375,
       "wires":[
          [
             "75c09ce9.52b724"
          ]
       ]
    },
    {
       "id":"75c09ce9.52b724",
       "type":"change",
       "z":"a127b200.23554",
       "name":"set service",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"{\t  'service': 'turn_' & payload\t}",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":363.00993728637695,
       "y":441.4563798904419,
       "wires":[
          [
             "2fc63e41.e9f272"
          ]
       ]
    },
    {
       "id":"2fc63e41.e9f272",
       "type":"api-call-service",
       "z":"a127b200.23554",
       "name":"switch summerhouse light",
       "server":"5806b60f.c2e778",
       "version":1,
       "service_domain":"light",
       "service":"",
       "entityId":"light.summer_house_internal",
       "data":"",
       "dataType":"json",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "mustacheAltTags":false,
       "x":602.0099487304688,
       "y":441.45637798309326,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"d8abeef0.70455",
       "type":"split",
       "z":"2c5b3241.37838e",
       "name":"",
       "splt":"\\n",
       "spltType":"str",
       "arraySplt":1,
       "arraySpltType":"len",
       "stream":false,
       "addname":"key",
       "x":1838.8054161071777,
       "y":266.5178346633911,
       "wires":[
          [
             "1c667c2c.3035a4"
          ]
       ]
    },
    {
       "id":"3f797418.daba1c",
       "type":"change",
       "z":"2c5b3241.37838e",
       "name":"Get dps object",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"payload.dps",
             "tot":"msg"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":1672.8074493408203,
       "y":266.57340240478516,
       "wires":[
          [
             "d8abeef0.70455"
          ]
       ]
    },
    {
       "id":"10017111.45cb7f",
       "type":"mqtt out",
       "z":"2c5b3241.37838e",
       "name":"",
       "topic":"",
       "qos":"0",
       "retain":"true",
       "broker":"ab404be4.584f18",
       "x":2509.8054790496826,
       "y":266.19440960884094,
       "wires":[
 
       ]
    },
    {
       "id":"4cd5ef30.df929",
       "type":"change",
       "z":"2c5b3241.37838e",
       "name":"",
       "rules":[
          {
             "t":"set",
             "p":"topic",
             "pt":"msg",
             "to":"\"tuya/dehumidifier/\" & key",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":2363.8095932006836,
       "y":266.6825361251831,
       "wires":[
          [
             "10017111.45cb7f"
          ]
       ]
    },
    {
       "id":"ebd4aa82.5c2488",
       "type":"mqtt in",
       "z":"2c5b3241.37838e",
       "name":"",
       "topic":"tuya/dehumidifier/+/set",
       "qos":"0",
       "datatype":"utf8",
       "broker":"ab404be4.584f18",
       "x":124.80156230926514,
       "y":266.93849754333496,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"caf1dd1b.1d7f8",
       "type":"change",
       "z":"2c5b3241.37838e",
       "name":"",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"{\t    \"set\": payload,\t    \"dps\": $number(topic)\t}",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":1301.8014831542969,
       "y":266.93848037719727,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"1c667c2c.3035a4",
       "type":"mapper",
       "z":"2c5b3241.37838e",
       "name":"key mapper",
       "property":"key",
       "map":[
          {
             "search":"1",
             "replace":"power"
          },
          {
             "search":"2",
             "replace":"humidity_target"
          },
          {
             "search":"4",
             "replace":"fan"
          },
          {
             "search":"5",
             "replace":"mode"
          },
          {
             "search":"6",
             "replace":"humidity"
          },
          {
             "search":"7",
             "replace":"temperature"
          },
          {
             "search":"10",
             "replace":"flap"
          },
          {
             "search":"12",
             "replace":"ioniser"
          },
          {
             "search":"15",
             "replace":"uv"
          },
          {
             "search":"101",
             "replace":"temperature_target"
          }
       ],
       "passthrough":false,
       "x":1993.8116760253906,
       "y":266.6586751937866,
       "wires":[
          [
             "2181c6ee.7fc7ba"
          ]
       ]
    },
    {
       "id":"2181c6ee.7fc7ba",
       "type":"mapper",
       "z":"2c5b3241.37838e",
       "name":"payload mapper",
       "property":"payload",
       "map":[
          {
             "search":"Auto",
             "replace":"auto"
          },
          {
             "search":"Heater",
             "replace":"heating"
          },
          {
             "search":"Dehumidity",
             "replace":"drying"
          },
          {
             "search":"Fan",
             "replace":"fan"
          },
          {
             "search":"Low",
             "replace":"low"
          },
          {
             "search":"Medium",
             "replace":"medium"
          },
          {
             "search":"High",
             "replace":"high"
          }
       ],
       "passthrough":true,
       "x":2181.9940338134766,
       "y":267.0277462005615,
       "wires":[
          [
             "4cd5ef30.df929",
             "f9274296.02e7b"
          ]
       ]
    },
    {
       "id":"3746bd2e.cf23f2",
       "type":"inject",
       "z":"2c5b3241.37838e",
       "name":"",
       "topic":"",
       "payload":"request",
       "payloadType":"str",
       "repeat":"",
       "crontab":"",
       "once":false,
       "onceDelay":0.1,
       "x":1356.6944198608398,
       "y":713.9047594070435,
       "wires":[
          [
             "817a5f9f.f0993"
          ]
       ]
    },
    {
       "id":"c5f0ce1b.29fee",
       "type":"server-state-changed",
       "z":"98e70926.543948",
       "name":"",
       "server":"5806b60f.c2e778",
       "version":1,
       "entityidfilter":"uk_coronavirus",
       "entityidfiltertype":"substring",
       "outputinitially":false,
       "state_type":"str",
       "haltifstate":"",
       "halt_if_type":"str",
       "halt_if_compare":"is",
       "outputs":1,
       "output_only_on_state_change":true,
       "x":156.8035888671875,
       "y":788.5000076293945,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"65c4af5c.a7f22",
       "type":"api-render-template",
       "z":"98e70926.543948",
       "name":"",
       "server":"5806b60f.c2e778",
       "template":"{\n    \"luminosity\": {{ states('sensor.summer_house_door_illuminance') }}\n    \"confirmed\": {{ states('sensor.uk_coronavirus_confirmed') }},\n    \"current\": {{ states('sensor.uk_coronavirus_current') }},\n    \"deaths\": {{ states('sensor.uk_coronavirus_deaths') }},\n    \"recovered\": {{ states('sensor.uk_coronavirus_recovered') }},\n}",
       "resultsLocation":"payload",
       "resultsLocationType":"msg",
       "templateLocation":"template",
       "templateLocationType":"msg",
       "x":1299.805576324463,
       "y":787.2598514556885,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"17c7f98d.669756",
       "type":"mapper",
       "z":"2c5b3241.37838e",
       "name":"topic mapper",
       "property":"topic",
       "map":[
          {
             "search":"power",
             "replace":"1"
          },
          {
             "search":"humidity_target",
             "replace":"2"
          },
          {
             "search":"fan",
             "replace":"4"
          },
          {
             "search":"mode",
             "replace":"5"
          },
          {
             "search":"flap",
             "replace":"10"
          },
          {
             "search":"ioniser",
             "replace":"12"
          },
          {
             "search":"uv",
             "replace":"15"
          },
          {
             "search":"temperature_target",
             "replace":"101"
          }
       ],
       "passthrough":false,
       "x":902.0099411010742,
       "y":267.02771377563477,
       "wires":[
          [
             "6a5e007b.da473"
          ]
       ]
    },
    {
       "id":"e6ee135e.0dfd6",
       "type":"change",
       "z":"2c5b3241.37838e",
       "name":"set topic & payload",
       "rules":[
          {
             "t":"set",
             "p":"topic",
             "pt":"msg",
             "to":"$match(topic, /(?:tuya\\/dehumidifier\\/)(\\w*)(.*)/).groups[0]",
             "tot":"jsonata"
          },
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"(\t    payload in [\"true\", \"false\"]\t        ? payload = \"true\"\t            ? true\t            : false\t        : $contains(payload, /[\\d\\.]+/)\t            ? $round($number(payload))\t            : payload\t)",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":349.8115348815918,
       "y":267.14087104797363,
       "wires":[
          [
             "f1bcd79b.07cd48"
          ]
       ]
    },
    {
       "id":"6a5e007b.da473",
       "type":"mapper",
       "z":"2c5b3241.37838e",
       "name":"payload mapper",
       "property":"payload",
       "map":[
          {
             "search":"heat",
             "replace":"Heater"
          },
          {
             "search":"dry",
             "replace":"Dehumidity"
          },
          {
             "search":"fan_only",
             "replace":"Fan"
          },
          {
             "search":"auto",
             "replace":"Auto"
          },
          {
             "search":"low",
             "replace":"Low"
          },
          {
             "search":"medium",
             "replace":"Medium"
          },
          {
             "search":"high",
             "replace":"High"
          }
       ],
       "passthrough":true,
       "x":1093.5337448120117,
       "y":267.02777576446533,
       "wires":[
          [
             "caf1dd1b.1d7f8"
          ]
       ]
    },
    {
       "id":"f9274296.02e7b",
       "type":"switch",
       "z":"2c5b3241.37838e",
       "name":"power state",
       "property":"key",
       "propertyType":"msg",
       "rules":[
          {
             "t":"eq",
             "v":"power",
             "vt":"str"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":1,
       "x":2367.1429138183594,
       "y":215.7321548461914,
       "wires":[
          [
             "4a9c9791.1f1ff8"
          ]
       ]
    },
    {
       "id":"4a9c9791.1f1ff8",
       "type":"change",
       "z":"2c5b3241.37838e",
       "name":"",
       "rules":[
          {
             "t":"set",
             "p":"#:(file)::power",
             "pt":"flow",
             "to":"payload",
             "tot":"msg"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":2541.9823608398438,
       "y":215.34919834136963,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"f1bcd79b.07cd48",
       "type":"switch",
       "z":"2c5b3241.37838e",
       "name":"power",
       "property":"topic",
       "propertyType":"msg",
       "rules":[
          {
             "t":"eq",
             "v":"power",
             "vt":"str"
          },
          {
             "t":"else"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":2,
       "x":523.0516395568848,
       "y":267.13292932510376,
       "wires":[
          [
             "8d47fe7e.7d9e6"
          ],
          [
             "17c7f98d.669756"
          ]
       ]
    },
    {
       "id":"8d47fe7e.7d9e6",
       "type":"switch",
       "z":"2c5b3241.37838e",
       "name":"changed?",
       "property":"payload",
       "propertyType":"msg",
       "rules":[
          {
             "t":"neq",
             "v":"#:(file)::power",
             "vt":"flow"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":1,
       "x":662.0536003112793,
       "y":228.13490676879883,
       "wires":[
          [
             "17c7f98d.669756"
          ]
       ]
    },
    {
       "id":"47a81d35.bda484",
       "type":"change",
       "z":"2c5b3241.37838e",
       "name":"Get dps object",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"payload.dps",
             "tot":"msg"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":1455.706787109375,
       "y":556.2847290039062,
       "wires":[
          [
             "5514b871.6597a8"
          ]
       ]
    },
    {
       "id":"5514b871.6597a8",
       "type":"split",
       "z":"2c5b3241.37838e",
       "name":"",
       "splt":"\\n",
       "spltType":"str",
       "arraySplt":1,
       "arraySpltType":"len",
       "stream":false,
       "addname":"dps",
       "x":1620.7066955566406,
       "y":556.2847604751587,
       "wires":[
          [
             "fa0a5880.cd3088"
          ]
       ]
    },
    {
       "id":"7a21e347.630f6c",
       "type":"mapper",
       "z":"2c5b3241.37838e",
       "name":"payload mapper",
       "property":"payload",
       "map":[
          {
             "search":"Auto",
             "replace":"auto"
          },
          {
             "search":"Heater",
             "replace":"heating"
          },
          {
             "search":"Dehumidity",
             "replace":"drying"
          },
          {
             "search":"Fan",
             "replace":"fan"
          },
          {
             "search":"Low",
             "replace":"low"
          },
          {
             "search":"Medium",
             "replace":"medium"
          },
          {
             "search":"High",
             "replace":"high"
          }
       ],
       "passthrough":true,
       "x":2430.7067337036133,
       "y":323.78468227386475,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"fa0a5880.cd3088",
       "type":"switch",
       "z":"2c5b3241.37838e",
       "name":"",
       "property":"dps",
       "propertyType":"msg",
       "rules":[
          {
             "t":"eq",
             "v":"1",
             "vt":"num"
          },
          {
             "t":"eq",
             "v":"2",
             "vt":"num"
          },
          {
             "t":"eq",
             "v":"4",
             "vt":"num"
          },
          {
             "t":"eq",
             "v":"5",
             "vt":"num"
          },
          {
             "t":"eq",
             "v":"6",
             "vt":"num"
          },
          {
             "t":"eq",
             "v":"7",
             "vt":"num"
          },
          {
             "t":"eq",
             "v":"10",
             "vt":"num"
          },
          {
             "t":"eq",
             "v":"12",
             "vt":"num"
          },
          {
             "t":"eq",
             "v":"15",
             "vt":"num"
          },
          {
             "t":"eq",
             "v":"101",
             "vt":"num"
          }
       ],
       "checkall":"false",
       "repair":false,
       "outputs":10,
       "x":1739.1964416503906,
       "y":556.7311859130859,
       "wires":[
          [
             "2c7fbbed.1f4444"
          ],
          [
             "1a0038ee.f47e37"
          ],
          [
             "d9047967.611f68"
          ],
          [
             "102e6f96.122a3"
          ],
          [
             "409ab2a1.c5169c"
          ],
          [
             "36e9f93a.2726e6"
          ],
          [
             "4c25300a.d8364"
          ],
          [
             "cb085e00.97095"
          ],
          [
             "7dc92b79.6225d4"
          ],
          [
             "e6433d76.c4f48"
          ]
       ],
       "l":false
    },
    {
       "id":"53f4feec.a0235",
       "type":"api-call-service",
       "z":"2c5b3241.37838e",
       "name":"power: on",
       "server":"5806b60f.c2e778",
       "version":1,
       "service_domain":"input_boolean",
       "service":"turn_on",
       "entityId":"input_boolean.dehumidifier_power",
       "data":"",
       "dataType":"json",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "mustacheAltTags":false,
       "x":2745.448797225952,
       "y":291.7509889602661,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"a793d83f.4b5318",
       "type":"switch",
       "z":"2c5b3241.37838e",
       "name":"power?",
       "property":"payload",
       "propertyType":"msg",
       "rules":[
          {
             "t":"true"
          },
          {
             "t":"else"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":2,
       "x":2586.703733444214,
       "y":313.94596767425537,
       "wires":[
          [
             "53f4feec.a0235"
          ],
          [
             "404570de.a5bcc"
          ]
       ]
    },
    {
       "id":"404570de.a5bcc",
       "type":"api-call-service",
       "z":"2c5b3241.37838e",
       "name":"power: off",
       "server":"5806b60f.c2e778",
       "version":1,
       "service_domain":"input_boolean",
       "service":"turn_off",
       "entityId":"input_boolean.dehumidifier_power",
       "data":"",
       "dataType":"json",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "mustacheAltTags":false,
       "x":2745.7065753936768,
       "y":332.5346841812134,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"ae26c8f4.dba708",
       "type":"debug",
       "z":"2c5b3241.37838e",
       "name":"",
       "active":true,
       "tosidebar":true,
       "console":false,
       "tostatus":false,
       "complete":"false",
       "x":401.69898223876953,
       "y":713.2391309738159,
       "wires":[
 
       ]
    },
    {
       "id":"310453b3.d1370c",
       "type":"api-call-service",
       "z":"2c5b3241.37838e",
       "name":"target_humidity: set",
       "server":"5806b60f.c2e778",
       "version":1,
       "service_domain":"input_number",
       "service":"set_value",
       "entityId":"input_number.dehumidifier_target_humidity",
       "data":"{\"value\": $number(payload)}",
       "dataType":"jsonata",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "mustacheAltTags":false,
       "x":2301.7036056518555,
       "y":413.54906845092773,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"d9047967.611f68",
       "type":"mapper",
       "z":"2c5b3241.37838e",
       "name":"fan speed",
       "property":"payload",
       "map":[
          {
             "search":"Low",
             "replace":"Sleep"
          },
          {
             "search":"Medium",
             "replace":"Normal"
          },
          {
             "search":"High",
             "replace":"Turbo"
          }
       ],
       "passthrough":false,
       "x":1914.4564208984375,
       "y":470.03475761413574,
       "wires":[
          [
             "a5e113ba.4e809"
          ]
       ]
    },
    {
       "id":"ecbc2b45.d3aa18",
       "type":"api-call-service",
       "z":"2c5b3241.37838e",
       "name":"fan: set",
       "server":"5806b60f.c2e778",
       "version":1,
       "service_domain":"input_select",
       "service":"select_option",
       "entityId":"input_select.dehumidifier_fan",
       "data":"{\"value\": payload}",
       "dataType":"jsonata",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "mustacheAltTags":false,
       "x":2250.453598022461,
       "y":467.30410957336426,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"102e6f96.122a3",
       "type":"mapper",
       "z":"2c5b3241.37838e",
       "name":"mode",
       "property":"payload",
       "map":[
          {
             "search":"Auto",
             "replace":"Smart"
          },
          {
             "search":"Heater",
             "replace":"Heater"
          },
          {
             "search":"Dehumidity",
             "replace":"Dehumidifier"
          },
          {
             "search":"Fan",
             "replace":"Air purifier"
          }
       ],
       "passthrough":false,
       "x":1909.4565773010254,
       "y":515.0347604751587,
       "wires":[
          [
             "a2a08856.f22078"
          ]
       ]
    },
    {
       "id":"a82af42.7048c08",
       "type":"api-call-service",
       "z":"2c5b3241.37838e",
       "name":"mode: set",
       "server":"5806b60f.c2e778",
       "version":1,
       "service_domain":"input_select",
       "service":"select_option",
       "entityId":"input_select.dehumidifier_mode",
       "data":"{\"value\": payload}",
       "dataType":"jsonata",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "mustacheAltTags":false,
       "x":2246.9564208984375,
       "y":511.2847270965576,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"409ab2a1.c5169c",
       "type":"mqtt out",
       "z":"2c5b3241.37838e",
       "name":"humidity",
       "topic":"tuya/dehumidifier/humidity",
       "qos":"0",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":2080.7065620422363,
       "y":567.534725189209,
       "wires":[
 
       ]
    },
    {
       "id":"2c7fbbed.1f4444",
       "type":"mqtt out",
       "z":"2c5b3241.37838e",
       "name":"power",
       "topic":"tuya/dehumidifier/power",
       "qos":"0",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":2056.956718444824,
       "y":365.03468132019043,
       "wires":[
 
       ]
    },
    {
       "id":"36e9f93a.2726e6",
       "type":"mqtt out",
       "z":"2c5b3241.37838e",
       "name":"temperature",
       "topic":"tuya/dehumidifier/temperature",
       "qos":"0",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":2071.956787109375,
       "y":626.2847290039062,
       "wires":[
 
       ]
    },
    {
       "id":"4c25300a.d8364",
       "type":"change",
       "z":"2c5b3241.37838e",
       "name":"flap",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"",
             "tot":"str"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":2075.4537391662598,
       "y":671.5526237487793,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"cb085e00.97095",
       "type":"mqtt out",
       "z":"2c5b3241.37838e",
       "name":"ioniser",
       "topic":"tuya/dehumidifier/ioniser",
       "qos":"0",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":2074.456787109375,
       "y":706.2847290039062,
       "wires":[
 
       ]
    },
    {
       "id":"7dc92b79.6225d4",
       "type":"mqtt out",
       "z":"2c5b3241.37838e",
       "name":"uv",
       "topic":"tuya/dehumidifier/uv",
       "qos":"0",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":2066.956787109375,
       "y":755.0347290039062,
       "wires":[
 
       ]
    },
    {
       "id":"a5e113ba.4e809",
       "type":"mqtt out",
       "z":"2c5b3241.37838e",
       "name":"fan",
       "topic":"tuya/dehumidifier/fan",
       "qos":"0",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":2073.206787109375,
       "y":468.7846984863281,
       "wires":[
 
       ]
    },
    {
       "id":"5496a84e.91cc58",
       "type":"mqtt in",
       "z":"2c5b3241.37838e",
       "name":"fan",
       "topic":"tuya/dehumidifier/fan",
       "qos":"0",
       "datatype":"auto",
       "broker":"ab404be4.584f18",
       "x":2145.4588623046875,
       "y":467.81994438171387,
       "wires":[
          [
             "ecbc2b45.d3aa18"
          ]
       ],
       "l":false
    },
    {
       "id":"a2a08856.f22078",
       "type":"mqtt out",
       "z":"2c5b3241.37838e",
       "name":"mode",
       "topic":"tuya/dehumidifier/mode",
       "qos":"0",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":2070.706787109375,
       "y":510.0346984863281,
       "wires":[
 
       ]
    },
    {
       "id":"29a5086.8a23ef8",
       "type":"mqtt in",
       "z":"2c5b3241.37838e",
       "name":"mode",
       "topic":"tuya/dehumidifier/mode",
       "qos":"0",
       "datatype":"auto",
       "broker":"ab404be4.584f18",
       "x":2146.6989421844482,
       "y":507.8174657821655,
       "wires":[
          [
             "a82af42.7048c08",
             "479c5858.c84df8"
          ]
       ],
       "l":false
    },
    {
       "id":"1a0038ee.f47e37",
       "type":"mqtt out",
       "z":"2c5b3241.37838e",
       "name":"target_humidity",
       "topic":"tuya/dehumidifier/target_humidity",
       "qos":"0",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":2071.9567260742188,
       "y":417.5346431732178,
       "wires":[
 
       ]
    },
    {
       "id":"c0617e7e.1c85e",
       "type":"mqtt in",
       "z":"2c5b3241.37838e",
       "name":"target_humidity",
       "topic":"tuya/dehumidifier/target_humidity",
       "qos":"0",
       "datatype":"auto",
       "broker":"ab404be4.584f18",
       "x":2172.95654296875,
       "y":416.5773820877075,
       "wires":[
          [
             "310453b3.d1370c"
          ]
       ],
       "l":false
    },
    {
       "id":"e6433d76.c4f48",
       "type":"mqtt out",
       "z":"2c5b3241.37838e",
       "name":"target_temperature",
       "topic":"tuya/dehumidifier/target_temperature",
       "qos":"0",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":2068.206787109375,
       "y":807.5347290039062,
       "wires":[
 
       ]
    },
    {
       "id":"67d13a46.7566d4",
       "type":"mqtt in",
       "z":"2c5b3241.37838e",
       "name":"target_temperature",
       "topic":"tuya/dehumidifier/target_temperature",
       "qos":"0",
       "datatype":"auto",
       "broker":"ab404be4.584f18",
       "x":2182.9489431381226,
       "y":804.0674333572388,
       "wires":[
          [
             "e4860701.3df2f8"
          ]
       ],
       "l":false
    },
    {
       "id":"e4860701.3df2f8",
       "type":"api-call-service",
       "z":"2c5b3241.37838e",
       "name":"target_temperature: set",
       "server":"5806b60f.c2e778",
       "version":1,
       "service_domain":"input_number",
       "service":"set_value",
       "entityId":"input_number.dehumidifier_target_temperature",
       "data":"{\"value\": $number(payload)}",
       "dataType":"jsonata",
       "mergecontext":"",
       "output_location":"",
       "output_location_type":"none",
       "mustacheAltTags":false,
       "x":2329.456787109375,
       "y":802.5347290039062,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"95d058f5.6046d8",
       "type":"server-state-changed",
       "z":"2c5b3241.37838e",
       "name":"dehumidifier_fan",
       "server":"5806b60f.c2e778",
       "version":1,
       "entityidfilter":"input_select.dehumidifier_fan",
       "entityidfiltertype":"exact",
       "outputinitially":false,
       "state_type":"str",
       "haltifstate":"",
       "halt_if_type":"str",
       "halt_if_compare":"is",
       "outputs":1,
       "output_only_on_state_change":true,
       "x":106.00447082519531,
       "y":418.6607151031494,
       "wires":[
          [
             "dc2a2e42.ae229"
          ]
       ]
    },
    {
       "id":"dc2a2e42.ae229",
       "type":"mqtt out",
       "z":"2c5b3241.37838e",
       "name":"tuya/dehumidifier/fan/set",
       "topic":"tuya/dehumidifier/fan/set",
       "qos":"0",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":532.2619552612305,
       "y":415.2504587173462,
       "wires":[
 
       ]
    },
    {
       "id":"67b1296c.a03f78",
       "type":"server-state-changed",
       "z":"2c5b3241.37838e",
       "name":"dehumidifier_mode",
       "server":"5806b60f.c2e778",
       "version":1,
       "entityidfilter":"input_select.dehumidifier_mode",
       "entityidfiltertype":"exact",
       "outputinitially":false,
       "state_type":"str",
       "haltifstate":"",
       "halt_if_type":"str",
       "halt_if_compare":"is",
       "outputs":1,
       "output_only_on_state_change":true,
       "x":117.51239013671875,
       "y":470.0346984863281,
       "wires":[
          [
             "4a037c49.497624"
          ]
       ]
    },
    {
       "id":"4a037c49.497624",
       "type":"mqtt out",
       "z":"2c5b3241.37838e",
       "name":"tuya/dehumidifier/mode/set",
       "topic":"tuya/dehumidifier/mode/set",
       "qos":"0",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":541.2624206542969,
       "y":468.7846870422363,
       "wires":[
 
       ]
    },
    {
       "id":"1eecd515.3405fb",
       "type":"server-state-changed",
       "z":"2c5b3241.37838e",
       "name":"dehumidifier_target_humidity",
       "server":"5806b60f.c2e778",
       "version":1,
       "entityidfilter":"input_number.dehumidifier_target_humidity",
       "entityidfiltertype":"exact",
       "outputinitially":false,
       "state_type":"num",
       "haltifstate":"",
       "halt_if_type":"str",
       "halt_if_compare":"is",
       "outputs":1,
       "output_only_on_state_change":true,
       "x":147.51239013671875,
       "y":526.2847290039062,
       "wires":[
          [
             "eb97f14e.ca655"
          ]
       ]
    },
    {
       "id":"eb97f14e.ca655",
       "type":"mqtt out",
       "z":"2c5b3241.37838e",
       "name":"tuya/dehumidifier/target_humidity/set",
       "topic":"tuya/dehumidifier/target_humidity/set",
       "qos":"0",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":576.2624130249023,
       "y":522.5347909927368,
       "wires":[
 
       ]
    },
    {
       "id":"a67edb9.7235828",
       "type":"server-state-changed",
       "z":"2c5b3241.37838e",
       "name":"dehumidifier_target_temperature",
       "server":"5806b60f.c2e778",
       "version":1,
       "entityidfilter":"input_number.dehumidifier_target_temperature",
       "entityidfiltertype":"exact",
       "outputinitially":false,
       "state_type":"num",
       "haltifstate":"",
       "halt_if_type":"str",
       "halt_if_compare":"is",
       "outputs":1,
       "output_only_on_state_change":true,
       "x":157.51239013671875,
       "y":580.034761428833,
       "wires":[
          [
             "6ee70d8c.d2e5d4"
          ]
       ]
    },
    {
       "id":"6ee70d8c.d2e5d4",
       "type":"mqtt out",
       "z":"2c5b3241.37838e",
       "name":"tuya/dehumidifier/target_temperature/set",
       "topic":"tuya/dehumidifier/target_temperature/set",
       "qos":"0",
       "retain":"false",
       "broker":"ab404be4.584f18",
       "x":597.5124053955078,
       "y":578.784761428833,
       "wires":[
 
       ]
    },
    {
       "id":"c0a174d8.ca3378",
       "type":"mqtt in",
       "z":"2c5b3241.37838e",
       "name":"",
       "topic":"tuya/dehumidifier/+/set",
       "qos":"0",
       "datatype":"utf8",
       "broker":"ab404be4.584f18",
       "x":176.26239013671875,
       "y":811.2847290039062,
       "wires":[
          [
             "ab2a1cc5.238ea"
          ]
       ]
    },
    {
       "id":"ab2a1cc5.238ea",
       "type":"change",
       "z":"2c5b3241.37838e",
       "name":"set topic & payload",
       "rules":[
          {
             "t":"set",
             "p":"topic",
             "pt":"msg",
             "to":"$match(topic, /(?:tuya\\/dehumidifier\\/)(\\w*)(.*)/).groups[0]",
             "tot":"jsonata"
          },
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"(\t    payload in [\"true\", \"false\"]\t        ? payload = \"true\"\t            ? true\t            : false\t        : $contains(payload, /[\\d\\.]+/)\t            ? $round($number(payload))\t            : payload\t)",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":401.2723627090454,
       "y":811.4871025085449,
       "wires":[
          [
             "d55bac81.98a7b"
          ]
       ]
    },
    {
       "id":"375ed4ba.73b3bc",
       "type":"switch",
       "z":"2c5b3241.37838e",
       "name":"power",
       "property":"topic",
       "propertyType":"msg",
       "rules":[
          {
             "t":"eq",
             "v":"power",
             "vt":"str"
          },
          {
             "t":"else"
          }
       ],
       "checkall":"true",
       "repair":false,
       "outputs":2,
       "x":922.5123901367188,
       "y":503.7847423553467,
       "wires":[
          [
 
          ],
          [
 
          ]
       ]
    },
    {
       "id":"d55bac81.98a7b",
       "type":"switch",
       "z":"2c5b3241.37838e",
       "name":"",
       "property":"dps",
       "propertyType":"msg",
       "rules":[
          {
             "t":"eq",
             "v":"power",
             "vt":"num"
          },
          {
             "t":"eq",
             "v":"target_humidity",
             "vt":"num"
          },
          {
             "t":"eq",
             "v":"fan",
             "vt":"num"
          },
          {
             "t":"eq",
             "v":"mode",
             "vt":"num"
          },
          {
             "t":"eq",
             "v":"flap",
             "vt":"num"
          },
          {
             "t":"eq",
             "v":"ioniser",
             "vt":"num"
          },
          {
             "t":"eq",
             "v":"uv",
             "vt":"num"
          },
          {
             "t":"eq",
             "v":"target_temperature",
             "vt":"num"
          }
       ],
       "checkall":"false",
       "repair":false,
       "outputs":8,
       "x":546.2623882293701,
       "y":811.2847709655762,
       "wires":[
          [
             "d0865825.dcd8a8"
          ],
          [
             "978681c7.bd5f"
          ],
          [
             "62a6880e.fa4958"
          ],
          [
             "ff584ea.b1254b"
          ],
          [
             "3e218bc0.a64d04"
          ],
          [
             "d2ab4444.5024a8"
          ],
          [
             "7a774e42.d0082"
          ],
          [
             "45fa33af.9ccf8c"
          ]
       ],
       "l":false
    },
    {
       "id":"6940e54f.ba397c",
       "type":"comment",
       "z":"2c5b3241.37838e",
       "name":"dehumidifier dps value mappings",
       "info":"dps values\n\n1 - power\n2 - target humidity\n4 - fan\n5 - mode\n6 - humidity\n7 - temperature\n10 - flap\n12 - ioniser\n15 - uv\n101 - target temperature",
       "x":1007.2992324829102,
       "y":434.8958730697632,
       "wires":[
 
       ]
    },
    {
       "id":"e0e4c25f.e22a1",
       "type":"change",
       "z":"2c5b3241.37838e",
       "name":"",
       "rules":[
          {
             "t":"set",
             "p":"payload",
             "pt":"msg",
             "to":"{\t    \"set\": payload,\t    \"dps\": dps\t}",
             "tot":"jsonata"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":1336.262306213379,
       "y":786.2847728729248,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"d0865825.dcd8a8",
       "type":"change",
       "z":"2c5b3241.37838e",
       "name":"power",
       "rules":[
          {
             "t":"set",
             "p":"dps",
             "pt":"msg",
             "to":"1",
             "tot":"num"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":692.2569751739502,
       "y":687.3834018707275,
       "wires":[
          [
             "e0e4c25f.e22a1"
          ]
       ]
    },
    {
       "id":"978681c7.bd5f",
       "type":"change",
       "z":"2c5b3241.37838e",
       "name":"target_humidity",
       "rules":[
          {
             "t":"set",
             "p":"dps",
             "pt":"msg",
             "to":"2",
             "tot":"num"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":722.5123920440674,
       "y":720.0347290039062,
       "wires":[
          [
             "e0e4c25f.e22a1"
          ]
       ]
    },
    {
       "id":"62a6880e.fa4958",
       "type":"change",
       "z":"2c5b3241.37838e",
       "name":"fan",
       "rules":[
          {
             "t":"set",
             "p":"dps",
             "pt":"msg",
             "to":"4",
             "tot":"num"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":691.2623634338379,
       "y":753.7847690582275,
       "wires":[
          [
             "55d9976f.0d9348"
          ]
       ]
    },
    {
       "id":"ff584ea.b1254b",
       "type":"change",
       "z":"2c5b3241.37838e",
       "name":"mode",
       "rules":[
          {
             "t":"set",
             "p":"dps",
             "pt":"msg",
             "to":"5",
             "tot":"num"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":687.5123920440674,
       "y":785.0347290039062,
       "wires":[
          [
             "c04a1a1a.0befe8"
          ]
       ]
    },
    {
       "id":"3e218bc0.a64d04",
       "type":"change",
       "z":"2c5b3241.37838e",
       "name":"flap",
       "rules":[
          {
             "t":"set",
             "p":"dps",
             "pt":"msg",
             "to":"10",
             "tot":"num"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":686.2623920440674,
       "y":821.2847290039062,
       "wires":[
          [
 
          ]
       ]
    },
    {
       "id":"d2ab4444.5024a8",
       "type":"change",
       "z":"2c5b3241.37838e",
       "name":"ioniser",
       "rules":[
          {
             "t":"set",
             "p":"dps",
             "pt":"msg",
             "to":"12",
             "tot":"num"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":686.2623920440674,
       "y":858.7847290039062,
       "wires":[
          [
             "e0e4c25f.e22a1"
          ]
       ]
    },
    {
       "id":"7a774e42.d0082",
       "type":"change",
       "z":"2c5b3241.37838e",
       "name":"uv",
       "rules":[
          {
             "t":"set",
             "p":"dps",
             "pt":"msg",
             "to":"15",
             "tot":"num"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":688.7623920440674,
       "y":893.7847290039062,
       "wires":[
          [
             "e0e4c25f.e22a1"
          ]
       ]
    },
    {
       "id":"45fa33af.9ccf8c",
       "type":"change",
       "z":"2c5b3241.37838e",
       "name":"target_temperature",
       "rules":[
          {
             "t":"set",
             "p":"dps",
             "pt":"msg",
             "to":"101",
             "tot":"num"
          }
       ],
       "action":"",
       "property":"",
       "from":"",
       "to":"",
       "reg":false,
       "x":728.7623920440674,
       "y":930.0347290039062,
       "wires":[
          [
             "e0e4c25f.e22a1"
          ]
       ]
    },
    {
       "id":"55d9976f.0d9348",
       "type":"mapper",
       "z":"2c5b3241.37838e",
       "name":"fan speed",
       "property":"payload",
       "map":[
          {
             "search":"Sleep",
             "replace":"Low"
          },
          {
             "search":"Normal",
             "replace":"Medium"
          },
          {
             "search":"Turbo",
             "replace":"High"
          }
       ],
       "passthrough":false,
       "x":828.7623596191406,
       "y":753.7847700119019,
       "wires":[
          [
             "e0e4c25f.e22a1"
          ]
       ]
    },
    {
       "id":"c04a1a1a.0befe8",
       "type":"mapper",
       "z":"2c5b3241.37838e",
       "name":"mode",
       "property":"payload",
       "map":[
          {
             "search":"Smart",
             "replace":"Auto"
          },
          {
             "search":"Heater",
             "replace":"Heater"
          },
          {
             "search":"Dehumidifier",
             "replace":"Dehumidity"
          },
          {
             "search":"Air purifier",
             "replace":"Fan"
          }
       ],
       "passthrough":false,
       "x":818.7623634338379,
       "y":785.0347709655762,
       "wires":[
          [
             "e0e4c25f.e22a1"
          ]
       ]
    },
    {
       "id":"479c5858.c84df8",
       "type":"debug",
       "z":"2c5b3241.37838e",
       "name":"",
       "active":true,
       "tosidebar":true,
       "console":false,
       "tostatus":false,
       "complete":"false",
       "x":2257.919319152832,
       "y":599.6254959106445,
       "wires":[
 
       ]
    }
 ]